    	OPT	O+,W-
	OUTPUT	demo.PRG

	CLR.L 	-(SP)			* PASSE EN MODE SUPERVISEUR
	MOVE.W 	#$20,-(SP)
	TRAP 	#1
	ADDQ.L 	#6,SP
	LEA	PILE,SP
	CLR.B 	$FF8260		* ON MET LA BASSE RESOLUTION
	DC.W	$A00A	souris out
	CLR.B	PHY+3
	CLR.B	LOG+3
	
	BSR 	MUSIKON
**********************************	
	MOVE.W	#$2700,SR
	MOVE.L	#HARD,$502		* ALT+HELP HS
	BSR	INTER_ON
	BCLR	#3,$FFFA17
	MOVE.L	$70,OLDVBL
	MOVE.L	#VBL,$70
	MOVE.W	#$2300,SR
***********************************************
CPU	MACRO
	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	\@
	MOVE.W	#\1,$FFFF8240.W
\@
	ENDM	
LOOP
	CLR.W	SYNC
VSYNC	TST.W	SYNC
	BEQ.S	VSYNC

	CMPI.B	#$39,$FFFFFC02.W
	BEQ	INTER_OFF
	CMPI.B	#$3B,$FFFFFC02.W
	BNE.S	PAS_PAUSE
PAUSE	CMPI.B	#$3C,$FFFFFC02.W
	BNE.S	PAUSE
	BRA.S	LOOP
PAS_PAUSE
	CPU	$7
	MOVE	#5000,D0
WAIT	DBRA	D0,WAIT
	CPU	$70
	BSR	TRIDI
	CLR	$FFFF8240.W

	MOVE.L	PHY,D0
	MOVE.L	LOG,PHY
	MOVE.L	D0,LOG
	LSR	#8,D0
	MOVE.L	D0,$FFFF8200.W
	BRA	LOOP
SYNC	DS.W	1
**********************************
INTER_ON MOVE.L $120,ANCHBL
	MOVE.L	$10.W,OLD10        
        MOVE.B  $FFFA09,D0
        MOVE.B  D0,ANCA09
        ANDI.B  #$DF,D0
        MOVE.B  D0,$FFFA09
        MOVE.B  $FFFA07,D0
        MOVE.B  D0,ANCA07
        ANDI.B  #$FE,D0
        MOVE.B  D0,$FFFA07
        LEA     HBL,A0
        MOVE.L  A0,$120
        MOVE.B  $FFFA07,D0
        ORI.B   #1,D0
        MOVE.B  D0,$FFFA07
        MOVE.B  $FFFA13,D0
        ORI.B   #1,D0
        MOVE.B  D0,$FFFA13
        RTS
OLDVBL	DC.L		0
***********************************************
INTER_OFF 
	MOVE.B ANCA09,D0
	MOVE.L	OLDVBL,$70
        MOVE.B  D0,$FFFA09
        MOVE.B  ANCA07,D0
        MOVE.B  D0,$FFFA07
        MOVE.B  ANCHBL,$120
       	MOVE.B	#$8,$FFFC02	     *SOURIS R‚TABLIE
	MOVE.W	#0,$FFFF8240.W
	MOVE.W	#$777,D0
	MOVEQ.L	#14,D1
	LEA	$FF8242,A0
BAFFPAL	MOVE.W	D0,(A0)+
	DBRA	D1,BAFFPAL
	BSR	MUSIKOFF
	MOVE.L	$44E.W,D0
	LSR	#8,D0
	MOVE.L	D0,$FFFF8200.W
	MOVE.L	$44E.W,A0
	MOVE.L	#7999,D0
BCLSFIN	CLR.L	(A0)+
	DBRA	D0,BCLSFIN	
	CLR.W -(SP)
	TRAP #1
***********************************************
VBL	MOVEM.L	D0-A6,-(SP)
	MOVE.B	#0,$FFFFFA1B.W
	MOVE.L	#HBL,$120.W
	MOVE.B	#1,$FFFFFA21.W
	MOVE.B	#8,$FFFFFA1B.W
	MOVEM.L	PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	MOVE.W	#$FFFF,SYNC
	JSR	MUSIK+8
	MOVEM.L	(SP)+,D0-A6	
	RTE
***********************************************
MUSIKOFF
	MOVEQ.L	#0,D0
	JSR	MUSIK
	RTS
***********************************************	
MUSIKON
	MOVEQ.L	#1,D0
	JSR	MUSIK
	RTS
***********************************************	
HBL	
	MOVE.B	#0,$FFFFFA1B.W
*	MOVE.L	#OVERSCAN_DOWN,$120.W
*	MOVE.B	#20,$FFFFFA21.W
*	MOVE.B	#8,$FFFFFA1B.W
	RTE	
HARD	RTS
**********************************			
TRIDI	MOVE.L	PHY,A6
	LEA	SINUS_TAB,A0	TAB SINUS
	LEA	XYZ,A1		COOR DU LOGO
	MOVE	(A1)+,D5		NBRE POINTS
.CALC_3D	MOVE	(A1)+,D0		X
	MOVE	(A1)+,D1		Y
	MOVE	(A1)+,D2		Z

** ROTAION AUTOUR AXE X
	MOVE	X_ROT(PC),D7
	MOVE.B	(A0,D7),D6		SIN
	MOVE.B	(A0,D7),D7		COS
	EXT	D6
	EXT	D7
	MOVE	D1,D3
	MOVE	D2,D4
	MULS	D7,D1		Y*COS
	MULS	D6,D4		Z*SIN
	SUB	D4,D1
	ASR	#7,D1		D1=Y
	MULS	D6,D3
	MULS	D7,D2
	ADD	D3,D2
	ASR	#7,D2		D2=Z
	
** ROTAION AUTOUR AXE Y
	MOVE	Y_ROT(PC),D7
	MOVE.B	(A0,D7),D6
	MOVE.B	64(A0,D7),D7
	EXT	D6
	EXT	D7
	MOVE	D0,D3
	MOVE	D2,D4
	MULS	D7,D0
	MULS	D6,D4
	ADD	D4,D0
	ASR	#7,D0		D0=X
	MULS	D6,D3
	MULS	D7,D2
	SUB	D3,D2
	ASR	#7,D2		D2=Z
	
** ROTATION AUTOUR AXE Z
	MOVE	Z_ROT(PC),D7
	MOVE.B	(A0,D7),D6
	MOVE.B	64(A0,D7),D7
	EXT	D6
	EXT	D7
	MOVE	D0,D3
	MOVE	D1,D4
	MULS	D7,D0
	MULS	D6,D4
	SUB	D4,D0
	ASR	#7,D0		D0=X
	MULS	D6,D3
	MULS	D7,D1
	ADD	D3,D1
	ASR	#7,D1		D1=Y

*** ESPACE => PLAN
	TST	D2		SI Z=0 ALORS Z=1
	BNE.S	.ZDIFF0
	ADDQ	#1,D2
.ZDIFF0

	MULS	#30,D0
	MULS	#30,D1
	DIVS	D2,D0
	DIVS	D2,D1
	

** ADDITIONNE LES COOR DU CENTRE DE L'ECRAN
	ADD	#159,D0
	ADD	#99,D1

	MOVE	D0,D7		AFFICHAGE DU POINT
	NOT	D7
	AND	#15,D7
	AND	#$FFF0,D0
	LSR	D0
	MOVEQ	#0,D3
	BSET	D7,D3
	MULU	#160,D1
	ADD	D0,D1
	OR	D3,(A6,D1)

	DBRA	D5,.CALC_3D
	RTS
**********************************			
**********************************			
********** SECTION DATA **********
**********************************			
	EVEN	
PHY	DC.L	SCREEN+255
LOG	DC.L	SCREEN+32255
MUSIK	*INCBIN	*.MUS
	DCB.W	10,$4E75
PAL
	dc.w	$0000,$0040,$0755,$0300,$0500,$0700,$0310,$0530
	dc.w	$0750,$0770,$0017,$0037,$0057,$0377,$0577,$0777

X_ROT	DC.W	100
Y_ROT	DC.W	0
Z_ROT	DC.W	50

SINUS_TAB
	DC.B	0,3,6,9,12,15,$12,$15
	DC.L	$181B1E21,$24272A2D
	DC.L	$30333639,$3B3E4143
	DC.L	$46494B4E,$50525557
	DC.L	$595B5E60,$62646667
	DC.L	$696B6C6E,$70717274

	DC.L	$75767778,$797A7B7B
	DC.L	$7C7D7D7E,$7E7E7E7E
	DC.L	$7E7E7E7E,$7E7E7D7D
	DC.L	$7C7B7B7A,$79787776
	DC.L	$75747271,$706E6C6B
	DC.L	$69676664,$62605E5B
	
	DC.L	$59575552,$504E4B49
	DC.L	$4643413E,$3B393633
	DC.L	$302D2A27,$24211E1B
	DC.L	$1815120F,$0C090603
	DC.L	$00FDFAF7,$F4F1EEEB
	DC.L	$E8E5E2DF,$DCD9D6D3
	DC.L	$D0CDCAC7,$C5C2BFBD
	DC.L	$BAB7B5B2,$B0AEABA9
	DC.L	$A7A5A2A0,$9E9C9A99
	DC.L	$97959492,$908F8E8C
	DC.L	$8B8A8383,$82828282
	
	DC.L	$82828282,$82828383
	DC.L	$84858586,$8788898A
	DC.L	$8B8C8E8F,$90929495
	DC.L	$97999A9C,$9EA0A2A5
	DC.L	$A7A9ABAE,$B0B2B5B7
	DC.L	$BABDBFC2,$C5C7CACD
	DC.L	$D0D3D6D9,$DCDFE2E5
	DC.L	$E8EBEEF1,$F4F7FAFD
COSINUS
	DC.B	0,3,6,9,12,15,$12,$15
	DC.L	$181B1E21,$24272A2D
	DC.L	$30333639,$3B3E4143
	DC.L	$46494B4E,$50525557
	DC.L	$595B5E60,$62646667
	DC.L	$696B6C6E,$70717274
	DC.L	$75767778,$797A7B7B
	DC.L	$7C7D7D7E,$7E7E7E7E

XYZ
*	COOR DU LOGO
	DC.W	8-1		8 POINTS
	
	DC.W	-64,-64,-64		X,Y,Z
	DC.W	64,-64,-64
	DC.W	64,64,-64
	DC.W	-64,64,-64
	DC.W	-64,-64,64
	DC.W	64,-64,64
	DC.W	64,64,64
	DC.W	-64,64,64
	
*********************************
*********** SECTION BSS *********
*********************************
	SECTION	BSS
	DS.L	500
PILE
OLD10	DS.L	1
ANCHBL  	DS.L    1
ANCVBL  	DS.L    1
ANCA09  	DS.B    1
ANCA07  	DS.B    1
SCREEN	DS.B	64256
