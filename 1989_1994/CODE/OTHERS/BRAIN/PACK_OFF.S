***************************************************************************
* TRANSFORMATION D'UNE ZONE SIGNEE PACKEE EN UN NOMBRE ASCII AVEC SIGNE
* (C) DENIS NARDEAU LE 22/11/1991.
***************************************************************************
	SECTION TEXT

	LEA	ZPACK,A0	ZONE PACKEE DU NOMBRE A CONVERTIR
	LEA	NOMBRE,A1	ADRESSE DE LA VARIABLE DE RESULTAT

	MOVEM.L	D0-D2/A0-A1,-(A7)	SAUVER LES REGISTRES

	MOVE.L	(A0),D0		TRANSFERT DU NOMBRE PACKE DANS D0
	MOVE.B	D0,D2		DERNIER CHIFFRE PLUS LE SIGNE DANS D2
	
	ORI.B	#$F0,D0		MASQUER LE SIGNE
	CMPI.B	#$FC,D0		SIGNE POSITIF ?
	BNE.S	NEGATIF		NON, TRAITEMENT NEGATIF

	MOVE.B	#'+',(A1)	OUI, METTRE LE SIGNE '+' DANS LA VARIABLE DE RETOUR
	BRA.S	DEPACK		CONTINUER PLUS LOIN

NEGATIF:
	MOVE.B	#'-',(A1)	METTRE LE SIGNE '-' DANS LA VARIABLE DE RETOUR
DEPACK:
	MOVE.B	D2,D0		RESTAURER LA VALEUR INITIALE DU NOMBRE DANS D0
	MOVE.B	(A1),(A1)+	SE POSITIONNER UN OCTET PLUS LOIN DANS LA VARIABLE

UNPACK:
	ROL.L	#4,D0		ROTATION A GAUCHE D'UN OCTET DANS D0

	CMP.B	D0,D2		COMPARER CHIFFRE ACTUEL / VALEUR REFERENCE
	BEQ.S	DEPACKED	OUI, ON A FINI LE DEPACKAGE. OUF !!!

	MOVE.B	D0,D1		SINON, TRANSFERT DE D0 DANS D1

	ORI.B	#$F0,D1		MASQUER LE QUARTET DE GAUCHE SUR 'F'
	SUBI.B	#$F0,D1		MISE A ZERO BINAIRE DU QUARTET DE GAUCHE
	ORI.B	#$30,D1		MASQUER SUR VALEUR ASCII DES CHIFFRES 0 A 9

UNPACK_2:
	MOVE.B	D1,(A1)+	TRANSFERT DU CHIFFRE DEPACKE DANS LA VARIABLE
	BRA.S	UNPACK		BOUCLER...

DEPACKED:
	MOVEM.L	D0-D2/A0-A1,-(A7)	RESTAURER LES REGISTRES

	CLR.W	-(A7)
	MOVE.W	#$4C,-(A7)
	TRAP	#1		QUITTER

	SECTION DATA

ZPACK:	DC.L $1234567C
	
NOMBRE:	DS.L 2

	END