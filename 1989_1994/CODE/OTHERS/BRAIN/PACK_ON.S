***************************************************************************
* TRANSFORMATION D'UN CHIFFRE ASCII EN DCB PACKE SIGNE.
* (C) DENIS NARDEAU LE 22/11/1991.
***************************************************************************
	SECTION TEXT

	LEA	NOMBRE,A0	VALEUR ASCII DU CHIFFRE A CONVERTIR
	LEA	ZPACK,A1	ADRESSE DE LA ZONE DE RESULTAT

	MOVEM.L	D0-D7/A0-A6,-(A7)	SAUVER LES REGISTRES

	MOVEQ	#0,D1		RAZ DE D1

	CMPI.B	#'0',(A0)	LE 1ER OCTET EST-IL UN SIGNE ?
	BGE.S	NO_SIGN		NON PAS DE SIGNE, ALORS ON CONTINUE...

	MOVE.B	(A0)+,D0	TRANSFERT D'UN OCTET DANS D0
	CMPI.B	#'-',D0		SIGNE MOINS ?
	BEQ.S	NEGATIF		OUI, ALORS TRAITEMENT NEGATIF
NO_SIGN:
	ORI.B	#$C,D1		METTRE "C" DANS 1ER OCTET DE D1
	BRA.S	PACK		BRANCHEMENT ROUTINE PRINCIPALE...
NEGATIF:
	ORI.B	#$D,D1		METTRE "D" DANS 1ER OCTET DE D1
PACK:
	TST.B	(A0)		FIN DU NOMBRE ?
	BEQ.S	PACKED		OUI, ALORS ON QUITTE !
	MOVE.B	(A0)+,D0	TRANSFERT L'OCTET SUIVANT DANS D0
	EORI.B	#'0',D0		MASQUER (XOR) SUR LA VALEUR ASCII DE 0 A 9
	ROL.L	#4,D1		ROTATION D'UN QUARTET SUR LA GAUCHE DANS D1
	OR.B	D0,D1		TRANSFERT DU QUARTET DANS D1 (ZERO AU DEPART)
	BRA.S	PACK		BOUCLER...
PACKED:
	ROL.L	#4,D1		UNE ROTATION EN PLUS POUR TRANSFERER LE SIGNE
	MOVE.L	D1,(A1)		TRANSFERT DU NOMBRE PACKE DANS ZPACK

	MOVEM.L	D0-D7/A0-A6,-(A7)	RESTAURER LES REGISTRES

	CLR.W	-(A7)
	MOVE.W	#$4C,-(A7)
	TRAP	#1			QUITTER

	SECTION DATA

NOMBRE:	DC.B "-1234567"

ZPACK:	DC.L 0

	END