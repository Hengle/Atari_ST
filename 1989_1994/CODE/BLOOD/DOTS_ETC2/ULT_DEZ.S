MAIN	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP

	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
	MOVE.L	#FIN,$014.W
	MOVE.L	#FIN,$01C.W

	MOVE.L	#BUF,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN2
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN3
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN4
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN5
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN6
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN7
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN8

	MOVE.L	#VBL_DêB,$70.W

	MOVE.L	SCREEN1,A0
	MOVE	#36-1,D7
	LEA	DEZPIC+34,A1
.PIPO	REPT	10
	MOVE.L	(A1)+,(A0)+
	ENDR
	LEA	160-10*4(A0),A0
	LEA	160-10*4(A1),A1
	DBF	D7,.PIPO

	MOVEQ	#15,D4
MOD	LEA	BUF_SPR,A0
	MOVE.L	SCREEN1,A1
	MOVE	#36-1,D7
.COP	REPT	12
	MOVE.L	(A1)+,(A0)+
	ENDR
	LEA	160-12*4(A1),A1
	DBF	D7,.COP
	MOVE.L	A0,MOD+2
	MOVEQ	#3,D6
	MOVEQ	#0,D5
.PL	
	MOVE.L	SCREEN1,A1
	ADD	D5,A1
	MOVE	#36-1,D7
.SHIFT
N	SET	0
	REPT	12
	ROXR	N(A1)
N	SET	N+8
	ENDR
	LEA	160(A1),A1
	DBF	D7,.SHIFT
	ADDQ	#2,D5
	DBF	D6,.PL

	;MOVE.L	D4,-(SP)
	;MOVE	#7,-(SP)
	;TRAP	#1
	;ADDQ	#2,SP
	;MOVE.L	(SP)+,D4

	DBF	D4,MOD

BOUCLE	BRA.S	BOUCLE

	MOVE.L	SCREEN1,A0
	MOVE	#7999,D7
.EF_LAST	CLR.L	(A0)+
	DBF	D7,.EF_LAST

	MOVE.L	#VBL,$70.W
J	BRA.S	J
FIN	MOVE.L	4.W,A0
	JMP	(A0)

VBL_DêB	MOVEM.L	D0-A6,-(SP)
	MOVEM.L	DEZPIC+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	CMPI	#90,TIME
	BGT.S	NO1
	LEA	DEZPIC+34+160-64,A1
	MOVE.L	SCREEN2,A0
	LEA	12*8(A0),A0
MOD1	LEA	-160*80(A0),A0
	MOVE	#77-1,D7
.AF1
;N	SET	0
;	REPT	8
;	MOVE	(A1)+,N+2(A0)
;N	SET	N+8
;	ENDR
	MOVEM.L	(A1),D0-D6/A2-A6
	MOVEM.L	D0-D6/A2-A6,(A0)
	MOVEM.L	12*4(A1),D0-D3
	MOVEM.L	D0-D3,12*4(A0)

	LEA	160(A0),A0
	LEA	160(A1),A1
	DBF	D7,.AF1
NO1	TST	MOD1+2
	BEQ.S	.NO2
	ADD	#160,MOD1+2
.NO2
POUET
	CMPI	#30,TIME
	BLE.S	NO1B
	LEA	DEZPIC+34+160*94,A1
	MOVE.L	SCREEN2,A0
MOD2	LEA	160*200(A0),A0
	MOVE	#106-1,D7
.AF1
	MOVEM.L	(A1),D0-D6/A2-A6
	MOVEM.L	D0-D6/A2-A6,(A0)
	MOVEM.L	12*4(A1),D0-D3
	MOVEM.L	D0-D3,12*4(A0)

	LEA	160(A0),A0
	LEA	160(A1),A1
	DBF	D7,.AF1
	CMPI	#160*94,MOD2+2
	BEQ.S	.NO2
	SUB	#160,MOD2+2
	BRA.S	NO1B
.NO2	MOVE.L	#VBL_TRANSIT,$70.W
	CLR	TIME
NO1B
KEUD	MOVE.B	SCREEN2+1,$FFFF8201.W
	MOVE.B	SCREEN2+2,$FFFF8203.W
	MOVE.L	SCREEN2,D0
	MOVE.L	SCREEN4,SCREEN2
	MOVE.L	D0,SCREEN4

	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	.NO_TIME
	ST	$FFFF8240.W
.NO_TIME	
	ADDQ	#1,TIME
	MOVEM.L	(SP)+,D0-A6
	RTE
TIME	DC	0
COPY
	MOVE	#199,D7
.C	MOVEM.L	(A0),D0-D6/A2-A6
	MOVEM.L	D0-D6/A2-A6,(A1)

	MOVEM.L	12*4(A0),D0-D6/A2-A6
	MOVEM.L	D0-D6/A2-A6,12*4(A1)

	MOVEM.L	12*4*2(A0),D0-D6/A2-A6
	MOVEM.L	D0-D6/A2-A6,12*4*2(A1)

	MOVEM.L	12*4*3(A0),D0-D3
	MOVEM.L	D0-D3,12*4*3(A1)
	LEA	160(A0),A0
	LEA	160(A1),A1
	DBF	D7,.C
	RTS
VBL_TRANSIT
	MOVEM.L	D0-A6,-(SP)
	CMPI	#1,TIME
	BNE.S	.PAS1
	LEA	BUF_SPR,A0
	LEA	DEZPIC+34,A1
	JSR	COPY
.PAS1
	CMPI	#2,TIME
	BNE.S	.PAS2
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN1,A1
	JSR	COPY
.PAS2
	CMPI	#3,TIME
	BNE.S	.PAS3
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN2,A1
	JSR	COPY
.PAS3
	CMPI	#4,TIME
	BNE.S	.PAS4
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN3,A1
	JSR	COPY
.PAS4
	CMPI	#5,TIME
	BNE.S	.PAS5
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN5,A1
	JSR	COPY
.PAS5
	CMPI	#6,TIME
	BNE.S	.PAS6
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN6,A1
	JSR	COPY
.PAS6
	CMPI	#7,TIME
	BNE.S	.PAS7
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN7,A1
	JSR	COPY
.PAS7
	CMPI	#8,TIME
	BNE.S	.PAS8
	MOVE.L	SCREEN4,A0
	MOVE.L	SCREEN8,A1
	JSR	COPY
.PAS8
	CMPI	#9,TIME
	BNE.S	.PAS9
	MOVE.L	#VBL,$70.W
.PAS9	MOVEM.L	(SP)+,D0-A6
	ADDQ	#1,TIME
	RTE

VBL
	MOVEM.L	D0-A6,-(SP)
	MOVEM.L	DEZPIC+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	LEA	CRB,A0
MOD_CRB	EQU	*+2
	LEA	0(A0),A0
	CMPI	#$1234,(A0)
	BNE.S	.ROULE
	CLR	MOD_CRB
	LEA	CRB,A0
.ROULE	MOVE	(A0)+,D0	X
	MOVE	(A0),D1	Y
	MOVE.L	SCREEN1,A0
	ADD	#80,D1
	MULS	#160,D1
	ADD	D1,A0
	LEA	HELP_X,A1
	LEA	HELP_X2,A2
	ADD	#120,D0
	ADD	D0,D0
	ADD	(A2,D0.W),A0
	ADD	D0,D0
	LEA	DEZPIC+34,A2
	ADD.L	(A1,D0.W),A2
	
	MOVEQ	#36-1,D7
.AF_SPR
N	SET	0
	REPT	6
	MOVEM.W	(A2)+,D0-D3
	MOVE	D0,D4
	OR	D1,D0
	OR	D2,D0
	OR	D3,D0
	NOT	D0
	AND	D0,N(A0)
	AND	D0,N+2(A0)
	AND	D0,N+4(A0)
	AND	D0,N+6(A0)
	OR	D4,N(A0)
	OR	D1,N+2(A0)
	OR	D2,N+4(A0)
	OR	D3,N+6(A0)
N	SET	N+8
	ENDR
	LEA	160(A0),A0
	DBF	D7,.AF_SPR
	
	ADDQ	#4,MOD_CRB
	
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W

	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	SCREEN3,SCREEN2
	MOVE.L	SCREEN4,SCREEN3
	MOVE.L	SCREEN5,SCREEN4
	MOVE.L	SCREEN6,SCREEN5
	MOVE.L	SCREEN7,SCREEN6
	MOVE.L	SCREEN8,SCREEN7
	MOVE.L	D0,SCREEN8
	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	.E
	ST	$FFFF8240.W
.E
	MOVEM.L	(SP)+,D0-A6
	RTE

	DATA
DEZPIC	INCBIN	DESIGN.PI1
CRB	INCBIN	ULT.CRB
	DCB	10,$1234
HELP_X
	REPT	20
	DC.L	0
	DC.L	1*1728
	DC.L	2*1728
	DC.L	3*1728
	DC.L	4*1728
	DC.L	5*1728
	DC.L	6*1728
	DC.L	7*1728
	DC.L	8*1728
	DC.L	9*1728
	DC.L	10*1728
	DC.L	11*1728
	DC.L	12*1728
	DC.L	13*1728
	DC.L	14*1728
	DC.L	15*1728
	ENDR

HELP_X2
N	SET	0
	REPT	20
	DCB	16,N
N	SET	N+8
	ENDR

	BSS
	DS.B	256
BUF	DS.B	32000*8
SCREEN1	DS.L	1
SCREEN2	DS.L	1
SCREEN3	DS.L	1
SCREEN4	DS.L	1
SCREEN5	DS.L	1
SCREEN6	DS.L	1
SCREEN7	DS.L	1
SCREEN8	DS.L	1
*
BUF_SPR	EQU	SCREEN1-32000
;BUF_SPR	DS.L	12*36*16
