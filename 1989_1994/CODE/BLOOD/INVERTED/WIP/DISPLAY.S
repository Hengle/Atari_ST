
	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ	#6,SP
	
	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP
	
	LEA	ADR_PAL,A0
	LEA	BUF_PAL,A1
	MOVEQ	#128-1,D0
COP1	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBF	D0,COP1

	LEA	BUF_PAL,A0
	LEA	NEW_PAL,A1
	MOVE	#256-1,D4
TRANSFO_PAL	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVE.B	#%00000111,D0
	MOVE.B	(A0)+,D1	R
	MOVE.B	(A0)+,D2	V
	MOVE.B	(A0)+,D3	B
	AND	D0,D1
	AND	D0,D2
	AND	D0,D3
	MOVE.B	D1,(A1)+
	MOVE.B	D3,(A1)
	LSL	#4,D2
	OR.B	D2,(A1)+
	DBF	D4,TRANSFO_PAL

IMAGE	;INCBIN	MANSION.TGA
ADR_PAL = IMAGE+18
ADR_IMG = ADR_PAL+768

	BSS
BUF_PAL	DS.B	768
NEW_PAL	DS.B	256*2
