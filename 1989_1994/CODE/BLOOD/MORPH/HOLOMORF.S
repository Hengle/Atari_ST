MAIN	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP

	BSR	INIT_SYSTEME
	LEA	PIC,A0
	BSR	DECOMP_PC1
	NOP

SWAPEC	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS

INIT_SYSTEME	CLR.B	$FFFF8260.W

	MOVE.L	#BUFFER,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADDI.L	#32000,D0
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS

	;A0=ADRESSE DE L'IMAGE
DECOMP_PC1	MOVEM.L	D0-A6,-(SP)

	LEA	34(A0),A0
	MOVE.L	SCREEN1,A2
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVEQ	#0,D5
	MOVE.L	A2,A1
RETOUR	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0	;OCTET DE COMMANDE
	BGE.S	RECOP_INTEGRALE
	NEG.B	D0
	MOVE.B	D0,PUT_INC
	MOVE.B	(A0)+,D1
	BTST	#0,D7
	BNE.S	.COPY2	
.COPY	MOVE.B	D1,(A1)+
	SUBQ.W	#1,D0
	BLT.S	.END
.COPY2	MOVE.B	D1,(A1)+
	ADDQ.W	#6,A1
	DBRA	D0,.COPY
.END	BRA.S	REFLEXION

RECOP_INTEGRALE	MOVE.B	D0,PUT_INC
	BTST	#0,D7
	BNE.S	.COPY2	
.COPY	MOVE.B	(A0)+,(A1)+
	SUBQ.W	#1,D0
	BLT.S	.END
.COPY2	MOVE.B	(A0)+,(A1)+
	ADDQ.W	#6,A1
	DBRA	D0,.COPY
.END
REFLEXION
PUT_INC = *+3
	ADDI.B	#$12,D7
	ADDQ.W	#1,D7
	CMPI.B	#40,D7
	BNE.S	PAS_PLAN_SUIV	
	ADDQ.W	#2,A2
	ADDQ.W	#2,D6
	CMPI.W	#8,D6
	BLT.S	PAS_RETOUR_PLAN_1
	LEA	160-8(A2),A2
	ADDQ.W	#1,D5	;UNE LIGNE DE PLUS
	MOVEQ	#0,D6
PAS_RETOUR_PLAN_1
	MOVE.L	A2,A1
	MOVEQ	#0,D7
PAS_PLAN_SUIV	CMPI.W	#200,D5	
	BLT	RETOUR
	MOVEM.L	(SP)+,D0-A6
	RTS

PIC	INCBIN	hololog.pc1

	SECTION	BSS
	DS.B	256
BUFFER	DS.B	64000
SCREEN1	DS.L	1
SCREEN2	DS.L	1