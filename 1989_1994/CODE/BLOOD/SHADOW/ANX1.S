MAIN	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP

	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
	MOVE.L	#FIN,$014.W
	MOVE.L	#FIN,$01C.W

	MOVE.L	#BUF,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN2

	MOVE.L	SCREEN1,A1
	LEA	160*80+48(A1),A1
	MOVE.L	SCREEN2,A2
	LEA	160*80+48(A2),A2
	LEA	MSG1,A0
	MOVE	#43-1,D7
COPTI
N	SET	0
	REPT	13
	MOVE	(A0),N(A1)
	MOVE	(A0)+,N(A2)
N	SET	N+8
	ENDR
	LEA	160(A1),A1
	LEA	160(A2),A2
	DBF	D7,COPTI	
	

	MOVE.L	#VBL,$70.W
J	BRA.S	J
FIN	MOVE.L	4.W,A0
	JMP	(A0)
PAL_INIT	DC	$011,$011,$722,$050,$0,$500,$272,$102
PAL_FIN	DC	$011,$777,$772,$050,$272,$520,$101,$304
TIME_MSG	DC	0
MINIFADE	DC	$011,$111,$222,$333,$444,$555,$666,$777
	DC	$1234
T_F	DC	3
VBL	MOVEM.L	D0-A6,-(SP)
	MOVEM.L	PAL_INIT,D0-D3
	MOVEM.L	D0-D3,$FFFF8240.W
	CMPI	#250,TIME_MSG
	BLE.S	.DD
	MOVEM.L	PAL_FIN,D0-D3
	MOVEM.L	D0-D3,$FFFF8240.W
.DD

	CMPI	#500,TIME_MSG
	BLE.S	.ZZZ

	LEA	MINIFADE,A0
MDF2	EQU	*+2
	LEA	0(A0),A0
	CMPI	#$1234,2(A0)
	BEQ.S	.R2
	SUBQ	#1,T_F
	BNE.S	.R2
	MOVE	#3,T_F
	ADDQ	#2,MDF2
.R2	MOVE	(A0),$FFFF8240.W

.ZZZ
	CMPI	#50,TIME_MSG
	BLE.S	.ZZ
	LEA	MINIFADE,A0
MDF	EQU	*+2
	LEA	0(A0),A0
	CMPI	#$1234,2(A0)
	BEQ.S	.R
	SUBQ	#1,T_F
	BNE.S	.R
	MOVE	#3,T_F
	ADDQ	#2,MDF
.R	MOVE	(A0),$FFFF8242.W

.ZZ	MOVE.L	SCREEN1,A0
MODMDK	LEA	160*199(A0),A0
MODMDK2	MOVE	#1-1,D7
	BLT.S	.OOPS
	LEA	FLOWER-6*5*5,A1
.PIPO	
N	SET	0
	REPT	5
	MOVE.L	(A1)+,N(A0)
	MOVE	(A1)+,N+4(A0)
N	SET	N+8
	ENDR
	LEA	160(A0),A0
	DBF	D7,.PIPO

	CMPI	#150,TIME_MSG
	BLE.S	.RIEN_A_FOUTRE
	ADD	#160,MODMDK+2
	SUBQ	#1,MODMDK2+2
	BRA.S	.OK
.RIEN_A_FOUTRE	
	CMPI	#92,MODMDK2+2
	BEQ.S	.OK
	SUB	#160,MODMDK+2
	ADDQ	#1,MODMDK2+2
.OK
.OOPS
	CMPI	#250,TIME_MSG
	BLE.S	OOPSB

	MOVE.L	SCREEN1,A0
	LEA	96(A0),A0
MODMDK2B	MOVE	#1-1,D7
	BLT.S	OOPSB
	LEA	CACTUS,A1
MODMDKB	LEA	79*6*4(A1),A1
.PIPOB
N	SET	0
	REPT	4
	MOVE.L	(A1)+,N(A0)
	MOVE	(A1)+,N+4(A0)
N	SET	N+8
	ENDR
	LEA	160(A0),A0
	DBF	D7,.PIPOB

	CMPI	#250+79,TIME_MSG
	BGT.S	.STOP
	ADDQ	#1,MODMDK2B+2
	SUB	#6*4,MODMDKB+2
.STOP
	TST	MODMDK2B+2
	BEQ.S	.STOP2
	CMPI	#250+79+50,TIME_MSG
	BLE.S	.STOP2
	SUBQ	#1,MODMDK2B+2
	ADD	#6*4,MODMDKB+2
.STOP2


OOPSB	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	MOVEM.L	(SP)+,D0-A6
	ADDQ	#1,TIME_MSG
	RTE

	DATA
CACTUS	INCBIN	CACTUS.GFX
	DCB	3*5*5
FLOWER	INCBIN	FLOWER.GFX
	DCB	3*5*5
MSG1	INCBIN	TEXTE1.GFX

	BSS
	DS.B	256
BUF	DS.B	64000
SCREEN1	DS.L	1
SCREEN2	DS.L	1



