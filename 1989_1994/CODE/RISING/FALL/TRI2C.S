	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
	MOVE.L	#FIN,$014.W


	LEA	CODE,A0
	LEA	TABLE,A1

	MOVE.L	A0,(A1)+
	MOVE.L	#8,D0
	MOVE	#$C440,(A0)+
	MOVE	#$8550,(A0)+
	MOVE	#$4E75,(A0)+
	MOVE.L	A0,(A1)+
	MOVE.L	#8,D0
	MOVE	#$8150,(A0)+
	MOVE	#$8568,(A0)+
	MOVE	D0,(A0)+
	MOVE	#$4E75,(A0)+

	MOVE	#17,D7
	MOVE	#-1,D6
DOCODE	
	MOVE.L	A0,(A1)+

	MOVE.L	#8,D0
	ADDQ	#1,D6
	MOVE	D6,D1
	MOVE	#$8150,(A0)+
DOMOVE	MOVE	#$3141,(A0)+
	MOVE	D0,(A0)+
	ADDQ	#8,D0
	DBF	D1,DOMOVE
	MOVE	#$8568,(A0)+
	MOVE	D0,(A0)+
	MOVE	#$4E75,(A0)+
	DBF	D7,DOCODE



	
	MOVE.L	#P,$70.W
J	JMP	J
P
;	MOVE	#5000,D0
;F	DBF	D0,F

	ST	$FFFF8240.W

*valable pour face 1
	LEA	MINI_TABLO,A6
**
	LEA	t_points,a0
	MOVE	2(A0),D0	Y1
	MOVE	2+4(A0),D1	Y2
	MOVE	2+4*2(A0),D2	Y3
	MOVE	2+4*3(A0),D3	Y4
	JSR	TRIE_MAX
**
;	CMP	D0,D1
;	BNE.S	NO0
;	;D0=D1<>Y1=Y2
;	
;NO0	CMP	D0,D2
;	BNE.S	NO1
;	
;NO1	CMP	D0,D3
;	BNE.S	NO2
;
;NO2	CMP	D1,D2
;	BNE.S	NO3
;
;NO3	CMP	D1,D3
;	BNE.S	NO4
;	
;NO4	CMP	D2,D3
;	BNE.S	ALL_IS_OK
**
ALL_IS_OK	MOVE	D4,4*2*2-2(A6)
	MOVE	D4,4*4*2-2(A6)
	MOVE	D5,3*4(A6)
	MOVE	D5,7*4(A6)
	JSR	TRIE_MIN
	MOVE	D4,2(A6)
	MOVE	D4,4*4+2(A6)
	MOVE	D5,(A6)
	MOVE	D5,4*4(A6)
**
	LEA	t_points,a0
	MOVE	(A0),D0	X1
	MOVE	4(A0),D1	X2
	MOVE	4*2(A0),D2	X3
	MOVE	4*3(A0),D3	X4
	ADDQ.L	#2,A0
	JSR	TRIE_MAX
	MOVE	D4,4*4+4(A6)
	MOVE	D4,4*4+8(A6)
	MOVE	D5,4*4+6(A6)
	MOVE	D5,4*4+10(A6)
	JSR	TRIE_MIN
	MOVE	D4,4(A6)
	MOVE	D4,8(A6)
	MOVE	D5,6(A6)
	MOVE	D5,10(A6)

	MOVE	#$222,$FFFF8240.W

	LEA	ADR_RTS,A4
	LEA	MINI_TABLO,A6
;	MOVE	2(A6),D0	Y_MIN
;	MOVE	D0,D1
;	MULU	#160,D0
;	MOVE	D0,MODY
;	MULU	#?;D1
;	MOVE	D1,MOD_Y_LECTURE_TAB

	MOVE	#2-1,D7	D5/D6/D7 LIBRES
CALC	lea	TAB,A3
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVE	(A6)+,D0
	MOVE	(A6)+,D4
	MOVE	(A6)+,D2
	MOVE	(A6)+,D3
	
	MOVE	D4,D1
;	ADD	D4,D4
	ADD	D4,D4
	ADD	D4,A3

;	MOVE	#-200,D0	X_DEP
;	MOVE	#200,D2	X_FIN
;
;	MOVE	#0,D1	Y_DEP
;	MOVE	#200,D3	Y_FIN=>(D3-D1) MOTS INSCRITS

	JSR	CALCUL
	DBF	D7,CALC

	MOVE	#2-1,D7	D5/D6/D7 LIBRES
_CALC	lea	TAB2,A3
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVE	(A6)+,D0
	MOVE	(A6)+,D4
	MOVE	(A6)+,D2
	MOVE	(A6)+,D3
	
	MOVE	D4,D1
;	ADD	D4,D4
	ADD	D4,D4
	ADD	D4,A3

;	MOVE	#-200,D0	X_DEP
;	MOVE	#200,D2	X_FIN
;
;	MOVE	#0,D1	Y_DEP
;	MOVE	#200,D3	Y_FIN=>(D3-D1) MOTS INSCRITS

	JSR	CALCUL
	DBF	D7,_CALC
	MOVE	#$555,$FFFF8240.W

	MOVE.L	$44E.W,A6
	LEA	TABLE1,A2
	LEA	TABLE2,A3
	LEA	TAB,A5
	MOVE.L	#$FFFFFFFF,D1
	MOVE	#199,D3
ICI	MOVE.L	A6,A0
	LEA	TABLE,A4
	MOVE	(A5),D6
	MOVE	D6,D5
	MOVE	400(A5),D7
	MOVE	D7,D4
	TST	D6
	BNE.S	Q
	BRA.S	Y
Q	TST	D7
	BEQ.S	Y
	LSR	#4,D7
	LSR	#4,D6
	SUB	D6,D7	DELTA X
;	LSR	#4,D7	D7=>DETERMINE ROUT A APPELER
	LSL	#2,D7

;	SUBQ	#1,D5
	ADD	D5,D5	x3*4 ( x3<x1 )
	ADD	D5,D5
	MOVE	(A2,D5.W),D0	motif
	ADD	2(A2,D5.W),A0
;	SUBQ	#1,D4
	ADD	D4,D4	x1*4 ( ancien x )
	ADD	D4,D4
	MOVE	(A3,D4.W),D2	motif

	MOVE.L	(A4,D7.W),A4
	JSR	(A4)
Y	LEA	160(A6),A6
	ADDQ	#2,A5
	DBF	D3,ICI
	SF	$FFFF8240.W
	RTE
;FLAG	DC	0
TRIE_MAX	CMP	D0,D1
	BGT.S	AD1_WIN_A
;	BLT.S	AD0_WIN_A
;	ADDQ	#1,FLAG1
AD0_WIN_A	CMP	D2,D0
	BGT.S	AD0_WIN_B
;	BLT.S	AD2_WIN_A
;	ADDQ	#1,FLAG2
AD2_WIN_A	CMP	D3,D2
	BGT.S	AD2_WIN_B
;	BLT.S	AD3_WIN_A
;	ADDQ	#1,FLAG3
AD3_WIN_A	MOVE	D3,D4
;	TST	FLAG3
;	BNE.S	OK0
;	TST	FLAG2
;	BNE.S	OK1
;	TST	FLAG1
;	BNE.S	OK2
;	;4 Y EGAUX=> PROB
;	MOVE	#$700,$FFFF8240.W
;	JMP	FIN
;OK2	;D3=D2=D1
;OK1	;D3=D2
;	MOVE	4*3(A0),D6
;	SUB	4*2(A0),D6
;	B
OK0	MOVE	4*3(A0),D5
	RTS
AD2_WIN_B	MOVE	D2,D4
	MOVE	4*2(A0),D5
	RTS
AD0_WIN_B	CMP	D3,D0
	BGT.S	AD0_WIN_C
AD3_WIN_B	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
AD0_WIN_C	MOVE	D0,D4
	MOVE	(A0),D5
	RTS
AD1_WIN_A	CMP	D2,D1
	BGT.S	AD1_WIN_B
AD2_WIN_C	CMP	D3,D2
	BGT.S	AD2_WIN_B
	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
AD1_WIN_B	CMP	D3,D1
	BGT.S	AD1_WIN_C
	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
AD1_WIN_C	MOVE	D1,D4
	MOVE	4(A0),D5
	RTS


TRIE_MIN	CMP	D0,D1
	BLT.S	D1_WIN_A
D0_WIN_A	CMP	D2,D0
	BLT.S	D0_WIN_B
D2_WIN_A	CMP	D3,D2
	BLT.S	D2_WIN_B
D3_WIN_A	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
D2_WIN_B	MOVE	D2,D4
	MOVE	4*2(A0),D5
	RTS
D0_WIN_B	CMP	D3,D0
	BLT.S	D0_WIN_C
D3_WIN_B	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
D0_WIN_C	MOVE	D0,D4
	MOVE	(A0),D5
	RTS
D1_WIN_A	CMP	D2,D1
	BLT.S	D1_WIN_B
D2_WIN_C	CMP	D3,D2
	BLT.S	D2_WIN_B
	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
D1_WIN_B	CMP	D3,D1
	BLT.S	D1_WIN_C
	MOVE	D3,D4
	MOVE	4*3(A0),D5
	RTS
D1_WIN_C	MOVE	D1,D4
	MOVE	4(A0),D5
	RTS

t_points
;	DC	160,1
;	DC	100,2
;	DC	100,50
;	DC	2,51

	DC	160,1
	DC	1,100
	DC	160,199
	DC	319,100
	
;	DC	1,199
;	DC	1,1
;	DC	319,199
;	DC	319,1

;	DC	0,0
;	DC	0,0
;	DC	0,0
;	DC	0,0




CALCUL	LEA	ADR_RTS,A4
	MOVEQ	#0,D4
	CMP	D0,D2
	BGT.S	D2_P_G
	EXG.L	D0,D2
	BRA	OTHER
D2_P_G	SUB.W	D0,D2	DELTA X
	SUB.W	D1,D3	DELTA Y
	BNE.S	NON_NUL
	RTS
NON_NUL
	MOVE	D2,D4

	ASL	#7,D4	*128
;	EXT.L	D4
	DIVS.W	D3,D4	*X(+1)=(DX/DY)+X
	MOVE	#9,D2
	EXT.L	d4
	ASL.L	D2,D4
	
	ADD	D3,D3
	ADD	D3,D3
	NEG	D3
	SWAP	D4
	
;	ADD	D0,D0
;	ADD	D0,D0
	SUB	D1,D1
	JMP	(A4,D3)

	REPT	201
	MOVE	D0,(A3)+
	ADDX.L	D4,D0
	ENDR
ADR_RTS
	RTS

OTHER	LEA	ADR_RTS2,A4
	SUB.W	D0,D2	DELTA X
	SUB.W	D1,D3	DELTA Y
	BNE.S	NON_NUL2
	RTS
NON_NUL2
	MOVE	D3,D5
	ADD	D5,D5
	ADD	D5,A3
	MOVE	D2,D4
	
	ASL	#7,D4	*128
;	EXT.L	D4
	DIVS.W	D3,D4	*X(+1)=(DX/DY)+X
	MOVE	#9,D2
	EXT.L	d4
	ASL.L	D2,D4
	
	ADD	D3,D3
	ADD	D3,D3
	NEG	D3
	SWAP	D4
	
;	ADD	D0,D0
;	ADD	D0,D0
	SUB	D1,D1
	JMP	(A4,D3)

	REPT	201
	MOVE	D0,-(A3)
	ADDX.L	D4,D0
	ENDR
ADR_RTS2
	RTS

MINI_TABLO	DS.L	8
TAB	DS	200
TAB2	DS	200
TABE	DC.L	$99999999,0,0,0

FIN	MOVE.L	4.W,A0
	JMP	(A0)


TABLE1
N	SET	0
	REPT	20
	DC	%1111111111111111,N
	DC	%0111111111111111,N
	DC	%0011111111111111,N
	DC	%0001111111111111,N
	DC	%0000111111111111,N
	DC	%0000011111111111,N
	DC	%0000001111111111,N
	DC	%0000000111111111,N
	DC	%0000000011111111,N
	DC	%0000000001111111,N
	DC	%0000000000111111,N
	DC	%0000000000011111,N
	DC	%0000000000001111,N
	DC	%0000000000000111,N
	DC	%0000000000000011,N
	DC	%0000000000000001,N
N	SET	N+8
	ENDR

TABLE2
N	SET	0
	REPT	20
;	DC	%0000000000000000,N
	DC	%1000000000000000,N
	DC	%1100000000000000,N
	DC	%1110000000000000,N
	DC	%1111000000000000,N
	DC	%1111100000000000,N
	DC	%1111110000000000,N
	DC	%1111111000000000,N
	DC	%1111111100000000,N
	DC	%1111111110000000,N
	DC	%1111111111000000,N
	DC	%1111111111100000,N
	DC	%1111111111110000,N
	DC	%1111111111111000,N
	DC	%1111111111111100,N
	DC	%1111111111111110,N
	DC	%1111111111111111,N
N	SET	N+8
	ENDR


	BSS
TABLE	DS.L	20
CODE	DS.B	900
