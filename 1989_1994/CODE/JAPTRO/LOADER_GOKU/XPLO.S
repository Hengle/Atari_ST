main
	clr.l	-(sp)
	move.w	#$20,-(sp)
	trap	#1
	addq.l	#6,sp

	MOVE.L	#FIN,$8.W
	MOVE.L	#FIN,$C.W
	MOVE.L	#FIN,$10.W
	MOVE.L	#FIN,$14.W
	MOVE.L	#FIN,$18.W
	MOVE.L	#FIN,$1c.W
	MOVE.L	#FIN,$20.W

	CLR	-(SP)
	move.l	#-1,-(sp)
	move.l	#-1,-(sp)
	move.w	#5,-(sp)
	trap	#14
	lea.l	12(sp),sp

	move.l	#BUFFERSCR,d0
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#32000,d0
	move.l	d0,SCREEN2

	MOVE	#$777,$FFFF8242.W
	MOVE	#$777,$FFFF8250.W

	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)
***
	LEA	TABLE,A0
	LEA	GLZ1,A1
UN_DE_PLUS	CMPI	#$9999,(A1)
	BEQ.S	FINITO
	MOVE.L	A1,(A0)+
LOOP	CMPI	#$4E75,(A1)+
	BEQ.S	UN_DE_PLUS
	BRA.S	LOOP
FINITO	
***

	MOVE.L	SCREEN1,A0
	LEA	TABLE,A1
	MOVE.L	(A1),A1
	MOVEM.L	(A1),D0-D7
	JSR	8*4(A1)
	
	LEA	TABLE+4,A1
	MOVE.L	A1,SAVEA1

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	CLR.B	$FFFFFA13.W
	CLR.B	$FFFFFA15.W
	
	MOVE.L	#VBL_IR,$70.W
	MOVE.L	#TB0_IR,$120.W
	CLR.B	$FFFFFA1B.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W

J	BRA.S	J
SAVEA1	DC.L	0
SAVEA1C	DC.L	0
TB0_IR	
	MOVE	#$001,$FFFF8240.W
	CLR.B	$FFFFFA1B.W
	BCLR	#0,$FFFFFA0F.W
	RTE	
VBL_IR
	CLR.B	$FFFFFA1B.W
	MOVE.L	#TB0_IR,$120.W
;	MOVE.B	#159,$FFFFFA21.W
;	MOVE.B	#8,$FFFFFA1B.W
	SF	$FFFF8240.W
*
	CMPI.B	#$F,$FFFFFC02.W
	BEQ	PAUSE
	
	MOVE.L	SCREEN1,A0
	MOVE.L	SAVEA1,A1
	MOVE.L	(A1)+,A2
	TST.L	-4(A1)
	BNE.S	ROULB
	LEA	TABLE,A1
	MOVE.L	(A1)+,A2
ROULB	MOVEM.L	(A2),D0-D7
	JSR	8*4(A2)
	MOVE.L	A1,SAVEA1
DOO	
*

PAUSE	CMPI.B	#$39,$FFFFFC02.W
	BEQ.S	FIN
	RTE
FIN	MOVE.L	4.W,A0
	JMP	(A0)

	DATA
GLZ1	INCBIN	XPLO.DAT
	DC	$9999

	BSS
SCREEN2	DS.L	1
SCREEN1	DS.L	1
	DS.B	256
BUFFERSCR	DS.B	64000
TABLE	DS.L	200
