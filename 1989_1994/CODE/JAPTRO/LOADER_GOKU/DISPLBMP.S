; 000 356 777 070 201 734 723 612 210 421 532 643 754 765 004 126
;      
;      
;      xxxxxxxxxxxxxxxx


 ;dc.b %11100000,0,0,0,0

; dc.b %01100000,%10100000,%11000000

;000 = xxxxx000x000x000
;356 = xxxxx011x101x110 = $60,$A0,$C0 => INVERSES DANS LE FICHIER
; IE SS LA FORME $C0,$A0,$60....
;777 = xxxxx111x111x111 = $E0E0E000 au format BMP ( E0=%11100000 )
;070
;201
;734
;723
;612
;210
;421
;532
;643
;754
;765
;004
;126

	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ	#6,SP
	
	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP
	
	LEA	IMG+54,A0	D‚but palette
	LEA	PALETTE,A1
	MOVE	#16-1,D7
CREE_PALETTE	MOVEQ	#0,D4
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVE	#%11100000,D4
	MOVE.B	(A0)+,D0	R
	MOVE.B	(A0)+,D1	V
	MOVE.B	(A0)+,D2	B
	MOVE.B	(A0)+,D3	INUTILISEE
	AND.B	D4,D0	ON VIRE TOUT...
	AND.B	D4,D1
	AND.B	D4,D2
	LSR.B	#5,D0
	LSR.B	#5,D2
	LSR.B	#1,D1
	MOVEQ	#0,D3
	OR.B	D0,D3
	OR.B	D1,D3
	MOVE.B	D2,(A1)+
	MOVE.B	D3,(A1)+
	DBF	D7,CREE_PALETTE
FINI1	NOP

	MOVEM.L	PALETTE,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	LEA	IMG+1082-4,A0	DEBUT IMAGE? ESSAI...
	LEA	TABLE_RT,A1
	MOVEQ	#0,D5
	MOVE.L	$44E.W,A4
	MOVE.L	A4,A3
	LEA	32000-160(A3),A3
	LEA	-160(A4),A4
	MOVE	#%1000000000000000,D1
GO	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	CMPI.B	#15,D0
	BLE.S	OK
	MOVE	#$700,$FFFF8240.W
JU	BRA.S	JU
OK	ADD	D0,D0
	ADD	D0,D0
	LEA	(A1,D0.W),A2
	MOVE.L	(A2),A2
	JSR	(A2)
	LSR	#1,D1
	BNE.S	GO
	MOVE	#%1000000000000000,D1
	ADDQ	#8,A3

	ADDQ	#8,D5
	CMPI	#160,D5
	BNE.S	ROOL
	MOVEQ	#0,D5
	LEA	-320(A3),A3
ROOL	
	CMP.L	A4,A3
	BNE.S	GO

	MOVE	#$001,$FFFF8240.W
FINI2	NOP
	BRA.S	FINI2
	
RT_0	OR	D1,(A3)	0001
RT_00	RTS
RT_1	OR	D1,2(A3)	0010
	RTS
RT_2	OR	D1,(A3)	0011
	OR	D1,2(A3)
	RTS
RT_3	OR	D1,4(A3)	0100
	RTS
RT_4	OR	D1,4(A3)	0101
	OR	D1,(A3)
	RTS
RT_5	OR	D1,4(A3)	0110
	OR	D1,2(A3)
	RTS
RT_6	OR	D1,4(A3)	0111
	OR	D1,2(A3)
	OR	D1,(A3)
	RTS
RT_7	OR	D1,6(A3)	1000
	RTS
RT_8	OR	D1,6(A3)	1001
	OR	D1,(A3)
	RTS
RT_9	OR	D1,6(A3)	1010
	OR	D1,2(A3)
	RTS
RT_10	OR	D1,6(A3)	1011
	OR	D1,2(A3)
	OR	D1,(A3)
	RTS
RT_11	OR	D1,6(A3)	1100
	OR	D1,4(A3)
	RTS
RT_12	OR	D1,6(A3)	1101
	OR	D1,4(A3)
	OR	D1,(A3)
	RTS
RT_13	OR	D1,6(A3)	1110
	OR	D1,4(A3)
	OR	D1,2(A3)
	RTS
RT_14	OR	D1,6(A3)	1111
	OR	D1,4(A3)
	OR	D1,2(A3)
	OR	D1,(A3)
	RTS

IMG	INCBIN	MADOKA_4.BMP
TABLE_RT
	DC.L	RT_00
	DC.L	RT_0
	DC.L	RT_1
	DC.L	RT_2
	DC.L	RT_3
	DC.L	RT_4
	DC.L	RT_5
	DC.L	RT_6
	DC.L	RT_7
	DC.L	RT_8
	DC.L	RT_9
	DC.L	RT_10
	DC.L	RT_11
	DC.L	RT_12
	DC.L	RT_13
	DC.L	RT_14
	;DC.L	RT_14

	BSS
	
PALETTE	DS.W	16
	DS.B	50000