	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ	#6,SP
	
	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.L	#FINI,$008.W
	MOVE.L	#FINI,$00C.W
	MOVE.L	#FINI,$010.W
	MOVE.L	#FINI,$014.W
	
	MOVEM.L	IMG+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	LEA	IMG+34,A0
	MOVE.L	$44E.W,A1
	MOVE	#3999,D0
AF	MOVE.L	(A0),(A1)
	ADDQ	#8,A0
	ADDQ	#8,A1
	DBF	D0,AF

	LEA	BUF,A6
	MOVE	#8-1,D7
AGAIN	MOVE.L	$44E.W,A5
	MOVE	#3999,D6
COP	MOVE.L	(A5),(A6)+
	ADDQ	#8,A5
	DBF	D6,COP
	MOVE.L	$44E.W,A0
	JSR	DêCALE_BIG_SPRITE
	MOVE.L	$44E.W,A0
	JSR	DêCALE_BIG_SPRITE
	MOVE.L	$44E.W,A0
	CLR.L	(A0)+
	CLR.L	(A0)+
	DBF	D7,AGAIN

	MOVE.L	#BUFFER,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADD.L	#32000,D0
	MOVE.L	D0,SCREEN2

	LEA	CODE,A0
	MOVEQ	#0,D2
	MOVEQ	#0,D4
	MOVE	#20-1,D3
DO2	MOVE.L	D2,D0
	MOVE.L	D4,D5
	MOVE	#199,D1
DO	MOVE	#$2368,(A0)+
	MOVE	D5,(A0)+
	MOVE	D0,(A0)+
	ADD	#160,D0
	ADD	#80,D5
	DBF	D1,DO
	ADDQ	#8,D2
	ADDQ	#4,D4
	DBF	D3,DO2
	MOVE	#$4E75,(A0)

	MOVE.L	#VBL_SPR,$70.W

J	BRA.S	J
FINI	MOVE.L	4.W,A0
	JMP	(A0)
VBL_SPR
	MOVE	#$101,$FFFF8240.W
	LEA	BUF,A0
MOD_BUF	EQU	*+2
	ADDA.L	#0,A0
	MOVE.L	SCREEN2,A1
MOD_ECR	EQU	*+2
	LEA	0(A1),A1
	JSR	CODE+6*200*5
;N	SET	0
;	REPT	4000
;	MOVE.L	(A0)+,N(A1)
;N	SET	N+8
;	ENDR

	;ADD.L	#16000,MOD_BUF
	CMPI.L	#16000*8,MOD_BUF
	BNE.S	.R
	CLR.L	MOD_BUF
	ADDQ	#8,MOD_ECR
.R
	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	.NOTI
	ST	$FFFF8240.W
.NOTI	MOVE.L	SCREEN1,D7
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D7,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTE


DêCALE_BIG_SPRITE
	MOVE	#200-1,D1
	MOVE.L	A0,A1
.Z
	MOVE	#2-1,D3
.E
	MOVE.L	A1,A0
N	SET	0
	REPT	20
	ROXR	N(A0)
N	SET	N+8
	ENDR
	ADDQ	#2,A1
	DBF	D3,.E
	LEA	160-2*2(A1),A1
	DBF	D1,.Z	
	RTS

	
IMG	INCBIN	ZAPPY.PI1
	BSS
SCREEN1	DS.L	1
SCREEN2	DS.L	1
	DS.B	256
BUFFER	DS.B	64000
BUF	DS.B	16000*8
CODE	DS.B	6*4000+2