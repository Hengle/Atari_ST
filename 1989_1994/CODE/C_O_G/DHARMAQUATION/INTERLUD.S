SEG=(136+200)/4
NB_PTS=4*SEG
PAS=1
NB_POS=(90/PAS)
PROG:

	JMP	MAIN
ZIK	INCBIN	LOGICAL.MUS
VBL_ZIK	MOVEM.L	D0-A6,-(SP)
	JSR	ZIK+8
	move.l	SCREEN1,d0
	CMPI.B	#$1,$FFFFFC02.W
	BNE.S	NO_CHG
	MOVE.L	SCREEN3,D0
NO_CHG	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)
	MOVEM.L	(SP)+,D0-A6
	ADDQ.L	#1,$140.W
	RTE
; a0: Pointer on packed Data
; a1: Pointer on destination of unpacked data
decrunch:	movem.l	d0-a6,-(sp)
	cmpi.l	#'Ice!',(a0)+
	bne.s	ice_03
	move.l	(a0)+,d0
	lea	-8(a0,d0.l),a5
	move.l	(a0)+,(sp)
	movea.l	a1,a4
	movea.l	a1,a6
	adda.l	(sp),a6
	movea.l	a6,a3
	bsr.s	ice_08
	bsr.s	ice_04
	bsr	ice_0c
	bcc.s	ice_03
	move.w	#$0f9f,d7
ice_00:	moveq	#3,d6
ice_01:	move.w	-(a3),d4
	moveq	#3,d5
ice_02:	add.w	d4,d4
	addx.w	d0,d0
	add.w	d4,d4
	addx.w	d1,d1
	add.w	d4,d4
	addx.w	d2,d2
	add.w	d4,d4
	addx.w	d3,d3
	dbra	d5,ice_02
	dbra	d6,ice_01
	movem.w	d0-d3,(a3)
	dbra	d7,ice_00
ice_03:	movem.l	(sp)+,d0-a6
	rts
ice_04:	bsr.s	ice_0c
	bcc.s	ice_07
	moveq	#0,d1
	bsr.s	ice_0c
	bcc.s	ice_06
	lea	ice_1a(pc),a1
	moveq	#4,d3
ice_05:	move.l	-(a1),d0
	bsr.s	ice_0f
	swap	d0
	cmp.w	d0,d1
	dbne	d3,ice_05
	add.l	20(a1),d1
ice_06:	move.b	-(a5),-(a6)
	dbra	d1,ice_06
ice_07:	cmpa.l	a4,a6
	bgt.s	ice_12
	rts
ice_08:	moveq	#3,d0
ice_09:	move.b	-(a5),d7
	ror.l	#8,d7
	dbra	d0,ice_09
	rts
ice_0a:	move.w	a5,d7
	btst	#0,d7
	bne.s	ice_0b
	move.l	-(a5),d7
	addx.l	d7,d7
	bra.s	ice_11
ice_0b:	move.l	-5(a5),d7
	lsl.l	#8,d7
	move.b	-(a5),d7
	subq.l	#3,a5
	add.l	d7,d7
	bset	#0,d7
	bra.s	ice_11
ice_0c:	add.l	d7,d7
	beq.s	ice_0d
	rts
ice_0d:	move.w	a5,d7
	btst	#0,d7
	bne.s	ice_0e
	move.l	-(a5),d7
	addx.l	d7,d7
	rts
ice_0e:	move.l	-5(a5),d7
	lsl.l	#8,d7
	move.b	-(a5),d7
	subq.l	#3,a5
	add.l	d7,d7
	bset	#0,d7
	rts
ice_0f:	moveq	#0,d1
ice_10:	add.l	d7,d7
	beq.s	ice_0a
ice_11:	addx.w	d1,d1
	dbra	d0,ice_10
	rts
ice_12:	lea	ice_1b(pc),a1
	moveq	#3,d2
ice_13:	bsr.s	ice_0c
	dbcc	d2,ice_13
	moveq	#0,d4
	moveq	#0,d1
	move.b	1(a1,d2.w),d0
	ext.w	d0
	bmi.s	ice_14
	bsr.s	ice_0f
ice_14:	move.b	6(a1,d2.w),d4
	add.w	d1,d4
	beq.s	ice_16
	lea	ice_1c(pc),a1
	moveq	#1,d2
ice_15:	bsr.s	ice_0c
	dbcc	d2,ice_15
	moveq	#0,d1
	move.b	1(a1,d2.w),d0
	ext.w	d0
	bsr.s	ice_0f
	add.w	d2,d2
	add.w	6(a1,d2.w),d1
	bra.s	ice_18
ice_16:	moveq	#0,d1
	moveq	#5,d0
	moveq	#0,d2
	bsr.s	ice_0c
	bcc.s	ice_17
	moveq	#8,d0
	moveq	#$40,d2
ice_17:	bsr.s	ice_0f
	add.w	d2,d1
ice_18:	lea	2(a6,d4.w),a1
	adda.w	d1,a1
	move.b	-(a1),-(a6)
ice_19:	move.b	-(a1),-(a6)
	dbra	d4,ice_19
	bra	ice_04
	DC.B	$7f,$ff,$00,$0e,$00,$ff,$00,$07
	DC.B	$00,$07,$00,$02,$00,$03,$00,$01
	DC.B	$00,$03,$00,$01
ice_1a:	DC.B	$00,$00,$01,$0d,$00,$00,$00,$0e
	DC.B	$00,$00,$00,$07,$00,$00,$00,$04
	DC.B	$00,$00,$00,$01
ice_1b:	DC.B	$09,$01,$00,$ff,$ff,$08,$04,$02
	DC.B	$01,$00
ice_1c:	DC.B	$0b,$04,$07,$00,$01,$20,$00,$00
	DC.B	$00,$20
**
	DS.L	256
NEWPILE	DS.L	1
MAIN
	CLR.L	-(SP)
	MOVE	#$20,-(sp)
	trap	#1
	addq.l	#6,sp
	CLR	-(SP)
	move.l	#-1,-(sp)
	move.l	#-1,-(sp)
	MOVE	#5,-(sp)
	trap	#14
	lea	12(sp),sp
	LEA	NEWPILE,A7

	move.l	#BUFFERSCR,d0	
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#32000,d0	
	move.l	d0,SCREEN2
	MOVE.L	#END_COD,D0
	CLR.B	D0
	SUB.L	#32000,D0
	MOVE.L	D0,SCREEN3
	
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)


	LEA	GANDALF,A0
	MOVE.L	SCREEN3,A1
	LEA	-34(A1),A1
	JSR	decrunch
	MOVE.L	SCREEN3,A1
	LEA	-34+2(A1),A1
	MOVEM.L	(A1),D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVEQ	#0,D0
	JSR	ZIK
	MOVE.L	#VBL_ZIK,$70.W

	JSR	LINE_A_INIT
	MOVE	#1,24(A0)
	CLR	26(A0)
	CLR	28(A0)
	CLR	30(A0)
	MOVE	#0,36(A0)
	MOVE.L	#FILL,46(A0)
	MOVE	#1,50(A0)
	CLR	52(A0)
	MOVE	#1,54(A0)
	move	#1,56(A0)
	move	#1,58(A0)
	move	#319,60(A0)
	move	#199,62(A0)

	MOVE.L	#TABLE_DAT,ADR_TABL
	
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)
	LEA	BUFCOD,A0
	MOVE.L	A0,SAVEA0
	LEA	TABLE,A4
	MOVE.L	A4,SAVEA4
	MOVEM.L	D0-A6,REG_GEN
	
	MOVE	#$777,$FFFF8242.W
	MOVE	#$777,$FFFF8250.W
	move	#$9999,modif
*************
	clr	x_angle
	clr	y_angle
	clr	z_angle

	CLR.L	POINTEUR
	
	
	MOVE	#2,x_angle
;	MOVE	#180*2,y_angle
;	MOVE	#70*2,z_angle
	
	move	#256,z_pt_fuite

	move.l	#(NB_POS)-1,d7
ici	CMPI.L	#(NB_POS)-20-1,D7
	BNE.S	CA_MARCHE
	CLR.L	FLAG2
CA_MARCHE	CLR.L	POINTEUR
	LEA	DATA_X,A1
	jsr	trigo
	ADD.L	#2,POINTEUR2
	CLR.L	FLAG_PTS
	MOVE	#NB_PTS-1,D6
DO_PTS	jsr	sp_to_pl
	jsr	ROUTINE
	DBF	D6,DO_PTS
	MOVEM.L	D0-A6,-(SP)
	movem.l	REG_GEN,D0-A6
GEN
	JSR	EFF
	MOVE	#SEG-1,D6
DO_SEG	MOVE.L	D6,-(SP)
	bsr	poly
	MOVE.L	(SP)+,D6
	DBF	D6,DO_SEG

	MOVE	#3999,D0
	MOVE.L	SCREEN1,A0
	LEA	BUF2,A1
	LEA	BUF1,A2
KL	MOVE	(A1),(A2)+
	MOVE	(A0),(A1)+
	ADDQ.L	#8,A0
	dbf	d0,KL

	JSR	GENERE1
	MOVEQ	#0,D0
	MOVEQ	#0,D3
	LEA	DATAS,A0
	LEA	FINAL,A1
	LEA	-8(A0),A0
LOOPED	LEA	8(A0),A0
	MOVE.L	(A0),D2
	MOVE.L	4(A0),D1
	TST.L	(A0)
	BEQ.S	OKVAZY
	CMP.L	D0,D1
	BLE.S	LOOPED
	MOVE.L	D1,D0
	MOVE.L	D2,D4
;	MOVE.L	#1,4(A0)
	BRA.S	LOOPED

OKVAZY	
	LEA	DATAS,A0	;
	LEA	-8(A0),A0	;
BOUI	ADDQ.L	#8,A0	;
	CMP.L	#DATAS+8000,A0
	BEQ	LP

	CMP.L	(A0),D4	;
	BNE.S	BOUI	;
	CLR.L	4(A0)	;

	MOVE.L	D4,(A1)+
	MOVE.L	D0,(A1)+
	CMPI.L	#7,D3
	BEQ.S	LP
	ADDQ.L	#1,D3
	MOVEQ	#0,D0
	LEA	DATAS,A0
	LEA	-8(A0),A0
	BRA.S	LOOPED
	
LP	LEA	DATAS,A0
	MOVE	#1999,D0
P	CLR.L	(A0)+
	DBF	D0,P
	JSR	GENERE2

	MOVEM.L	D0-A6,REG_GEN
	MOVEM.L	(SP)+,D0-A6
	CLR.L	PNT

	ADD	#2*PAS,x_angle
;	ADD	#2*PAS,y_angle
;	ADD	#2*PAS,z_angle

ADR_TABL	EQU	*+2
	LEA	ADR_TABL,A1
	MOVE	(A1)+,D0
	MOVE	#100,MOD_Y
	SUB	D0,MOD_Y
	MOVE	#0,MOD_Z
	SUB	D0,MOD_Z
	MOVE.L	A1,ADR_TABL
	dbf	d7,ici
	ST	$FFFF8244.W
	ST	$FFFF8246.W
	ST	$FFFF824C.W
	ST	$FFFF824E.W
	ST	$FFFF8254.W
	ST	$FFFF8256.W
	ST	$FFFF825C.W
	ST	$FFFF825E.W

	SF	$FFFF8242.W
	SF	$FFFF8248.W
	SF	$FFFF824A.W
	SF	$FFFF8250.W
	SF	$FFFF8252.W
	SF	$FFFF8258.W
	SF	$FFFF825A.W

;0001	42	777
;0010	44	007
;0011	46	007
;0100	48
;0101	4A
;0110	4C
;0111	4E
;1000	50	777
;1001	52
;1010	54	007
;1011	56
;1100	58
;1101	5A
;1110	5C
;1111	5E
***********
AGAIN	JSR	EFF
	CLR.L	TIME
	CLR.L	TIME2
	CLR.L	TIME2D
	CLR.L	TIMERY
	CLR	MOD_COUL
	CLR	MOD_COUL2
	CLR	MOD_COULB
	CLR	MOD_COUL2B
	MOVE.L	SCREEN1,A0
	LEA	TABLE,A1
	MOVE.L	(A1),A1
	MOVEM.L	(A1),D0-D7
	JSR	8*4(A1)
	JSR	AFF_CADRE
	
PAUSE	JSR	VSYNC
	ADDQ.L	#1,TIME2
TIME2	EQU	*+2
	MOVE.L	#0,D0
	CMPI.L	#50*2,D0
	BNE.S	PAUSE
*FAD1
FAD1	JSR	VSYNC
	LEA	FAD_IN,A0
MOD_COUL	EQU	*+2
	LEA	0(A0),A0
	CMPI	#-1,(A0)
	BEQ	END_FAD
	MOVE	(A0),D0
	MOVE	D0,$FFFF8242.W
	MOVE	D0,$FFFF8248.W
	MOVE	D0,$FFFF824A.W
	MOVE	D0,$FFFF8250.W
	MOVE	D0,$FFFF8252.W
	MOVE	D0,$FFFF8258.W
	MOVE	D0,$FFFF825A.W
	ADDQ	#1,MOD_COUL2
MOD_COUL2	EQU	*+2
	MOVE	#0,D0
	CMPI	#4,D0
	BNE.S	NON
	CLR	MOD_COUL2
	ADDQ	#2,MOD_COUL
NON	BRA	FAD1
*ENDFAD
END_FAD	

PAUSED	JSR	VSYNC
	ADDQ.L	#1,TIME2D
TIME2D	EQU	*+2
	MOVE.L	#0,D0
	CMPI.L	#50*2,D0
	BNE.S	PAUSED
	
	JSR	EFF_PLAN2

	MOVE.L	#TABLE+4,MOD_ADR_3D
VBL
	MOVE.L	SCREEN1,A0
MOD_ADR_3D	EQU	*+2
	LEA	MOD_ADR_3D,A1
	MOVE.L	(A1)+,A2
	TST.L	-4(A1)
	BNE	ROUL
	JSR	AFF_CADRE
NOT_SO_EASYH	JSR	VSYNC
	ADDQ.L	#1,TIMERY
TIMERY	EQU	*+2
	MOVE.L	#0,D0
	CMPI.L	#50*2,D0
	BNE.S	NOT_SO_EASYH
*FAD2
FAD2	JSR	VSYNC
	LEA	FAD_OUT,A0
MOD_COULB	EQU	*+2
	LEA	0(A0),A0
	CMPI	#-1,(A0)
	BEQ	END_FADB
	MOVE	(A0),D0
	MOVE	D0,$FFFF8242.W
	MOVE	D0,$FFFF8248.W
	MOVE	D0,$FFFF824A.W
	MOVE	D0,$FFFF8250.W
	MOVE	D0,$FFFF8252.W
	MOVE	D0,$FFFF8258.W
	MOVE	D0,$FFFF825A.W
	ADDQ	#1,MOD_COUL2B
MOD_COUL2B	EQU	*+2
	MOVE	#0,D0
	CMPI	#4,D0
	BNE.S	NONB
	CLR	MOD_COUL2B
	ADDQ	#2,MOD_COULB
NONB	BRA	FAD2
*ENDFAD
END_FADB

NOT_SO_EASY	JSR	VSYNC
	ADDQ.L	#1,TIME
TIME	EQU	*+2
	MOVE.L	#0,D0
	CMPI.L	#50,D0
	BNE.S	NOT_SO_EASY
;	LEA	TABLE+4,A1
;	MOVE.L	(A1)+,A2
	BRA	AGAIN
ROUL	MOVEM.L	(A2),D0-D7
	JSR	8*4(A2)
	MOVE.L	A1,MOD_ADR_3D
	SF	$FFFF8240.W
	JSR	VSYNC
	BRA	VBL

VSYNC	TST.L	$140.W
	BEQ.S	VSYNC
	CLR.L	$140.W
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTS

AFF_CADRE	MOVE.L	SCREEN1,A0
	LEA	192*160(A0),A1
	MOVE	#7,D1
DO_Y	MOVE	#19,D0
DO_X	MOVE	#$FFFF,2(A0)
	MOVE	#$FFFF,2(A1)
	ADDQ.L	#8,A0
	ADDQ.L	#8,A1
	DBF	D0,DO_X
	DBF	D1,DO_Y

	MOVE.L	SCREEN1,A0
	MOVE	#199,D0
DO_PIX	MOVE.B	#$FF,2(A0)
	MOVE.B	#$FF,153+2(A0)
	LEA	160(A0),A0
	DBF	D0,DO_PIX
	RTS
EFF_PLAN2	MOVE.L	SCREEN1,A0
	LEA	192*160(A0),A1
	MOVE	#7,D1
DO_Y_	MOVE	#19,D0
DO_X_	CLR	2(A0)
	CLR	2(A1)
	ADDQ.L	#8,A0
	ADDQ.L	#8,A1
	DBF	D0,DO_X_
	DBF	D1,DO_Y_

	MOVE.L	SCREEN1,A0
	MOVE	#199,D0
DO_PIX_	CLR.B	2(A0)
	CLR.B	153+2(A0)
	LEA	160(A0),A0
	DBF	D0,DO_PIX_
	RTS

FIN
	MOVE.L	4.W,A0
	JMP	(A0)

EFF	move.l	SCREEN1,a0
	MOVE	#7999,D0
HA	CLR.L	(A0)+
	DBF	D0,HA
	RTS	
SAVED0	DS.L	1
SAVEA0	DS.L	1
SAVEA4	DS.L	1
GENERE1
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVE.L	#-16+6,D7	OFFSET
	LEA	BUF1,A1
	LEA	BUF2,A2
	LEA	DATAS,A6
	
LOOP	ADD.L	#16,D7
	CMPI	#32000,D7
	BGT	FINI
	MOVE	(A1)+,D0
	MOVE	(A1)+,D1
	MOVE	(A2)+,D2
	MOVE	(A2)+,D3

	CMP	D0,D2
	BEQ.S	LOOP
	CMP	D1,D3
	BEQ.S	LOOP
	TST	D3
	BEQ.S	PLAN2_VIDE
MOVEL	
	MOVE	D2,D5
	SWAP	D5
	MOVE	D3,D5
	JSR	DO_IT
	BRA.S	LOOP
PLAN2_VIDE	TST	D2
	BNE.S	MOVEL
	BRA.S	LOOP

FINI	RTS

GENERE2
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D6
	MOVE.L	#-16+6,D7	OFFSET
	LEA	BUF1,A1
	LEA	BUF2,A2
	LEA	FINAL,A6
	MOVE.L	SAVEA0,A0
	MOVE.L	SAVEA4,A4
	MOVE.L	A0,(A4)+
	MOVE.L	A4,SAVEA4
	REPT	8
	MOVE.L	(A6)+,(A0)+
	MOVE.L	(A6)+,D0
	ENDR
	MOVEQ	#0,D0
WLOOP	ADD.L	#16,D7
	CMPI	#32000,D7
	BGT	WFINI
	MOVE	(A1)+,D0
	MOVE	(A1)+,D1
	MOVE	(A2)+,D2
	MOVE	(A2)+,D3

	CMP	D0,D2
	BEQ	WSAME_MOT1
	CMP	D1,D3
	BEQ.S	WSAME_MOT2
	TST	D3
	BEQ.S	WPLAN2_VIDE
WMOVEL	

	MOVE.B	#$40,D6
	LEA	FINAL,A6
	MOVE	D2,D5
	SWAP	D5
	MOVE	D3,D5
	LEA	-8(A6),A6
TROUVE	LEA	8(A6),A6
	CMP.L	(A6),D5
	BEQ.S	C_LE_MEME
	ADDQ.B	#1,D6
	CMPI.B	#$48,D6
	BEQ.S	PADFRQ
	BRA.S	TROUVE
C_LE_MEME	MOVE.B	#$21,(A0)+
	MOVE.B	D6,(A0)+
	MOVE	D7,(A0)+
	BRA.S	WLOOP
PADFRQ	
	MOVE	#$217C,(A0)+
	MOVE	D2,(A0)+
	MOVE	D3,(A0)+
	MOVE	D7,(A0)+
	BRA.S	WLOOP
WPLAN2_VIDE	TST	D2
	BNE.S	WMOVEL
	MOVE	#$42A8,(A0)+
	MOVE	D7,(A0)+
	BRA.S	WLOOP

WSAME_MOT2	TST	D2
	BNE.S	WMOVE_PLAN1
WCLR_PLAN1	MOVE	#$4268,(A0)+
	MOVE	D7,(A0)+
	BRA.S	WLOOP
WMOVE_PLAN1	
	MOVE.B	#$40,D6
	LEA	FINAL,A6
	MOVE	D2,D5
	LEA	-8(A6),A6
TROUVE2	LEA	8(A6),A6
	CMP	2(A6),D5
	BEQ.S	C_LE_MEME2
	ADDQ.B	#1,D6
	CMPI.B	#$48,D6
	BEQ.S	PADFRQ2
	BRA.S	TROUVE2
C_LE_MEME2	MOVE.B	#$31,(A0)+
	MOVE.B	D6,(A0)+
	MOVE	D7,(A0)+
	BRA	WLOOP
PADFRQ2

	MOVE	#$317C,(A0)+
	MOVE	D2,(A0)+
	MOVE	D7,(A0)+
	BRA	WLOOP

WSAME_MOT1	CMP	D1,D3
	BEQ	WLOOP
	TST	D3
	BNE.S	WMOVE_PLAN2
WCLR_PLAN2	MOVE	#$4268,(A0)+
	MOVE	D7,(A0)
	ADDQ	#2,(A0)+
	BRA	WLOOP
WMOVE_PLAN2	
	MOVE.B	#$40,D6
	LEA	FINAL,A6
	MOVE	D3,D5
	LEA	-8(A6),A6
TROUVE3	LEA	8(A6),A6
	CMP	2(A6),D5
	BEQ.S	C_LE_MEME3
	ADDQ.B	#1,D6
	CMPI.B	#$48,D6
	BEQ.S	PADFRQ3
	BRA.S	TROUVE3
C_LE_MEME3	MOVE.B	#$31,(A0)+
	MOVE.B	D6,(A0)+
	MOVE	D7,(A0)
	ADDQ	#2,(A0)+
	BRA	WLOOP
PADFRQ3


	MOVE	#$317C,(A0)+
	MOVE	D3,(A0)+
	MOVE	D7,(A0)
	ADDQ	#2,(A0)+
	BRA	WLOOP
	
	
WFINI	MOVE	#$4E75,(A0)+
	MOVE.L	A0,SAVEA0
	RTS

DO_IT	MOVEM.L	D0-A6,-(SP)
	LEA	DATAS,A0
HERE	TST.L	(A0)
	BEQ.S	OKEY
	CMP.L	(A0),D5
	BEQ.S	IDEM
	LEA	8(A0),A0
	BRA.S	HERE
IDEM	LEA	4(A0),A0
	ADDQ.L	#1,(A0)+
	BRA.S	HER
	
OKEY	MOVE.L	D5,(A0)+
	MOVE.L	#1,(A0)+
HER	MOVEM.L	(SP)+,D0-A6
	RTS

trigo	movem.l d0-d7/a4-a6,-(a7)

	lea cos_tab,a4
	lea sin_tab,a5
	lea x_angle,a6
	MOVE (a6)+,d2
	MOVE (a6)+,d1
	MOVE (a6)+,d0
	MOVE 0(a5,d2.w),d5
	MOVE 0(a4,d2.w),d4
	MOVE 0(a5,d1.w),d3
	MOVE 0(a4,d1.w),d2
	MOVE 0(a5,d0.w),d1
	MOVE 0(a4,d0.w),d0
	lea var_3d,a6
	moveq #9,d7
sp_c	MOVE d3,d6
	NEG d6
	MOVE d6,(a6)+
sp_f	MOVE d2,d6
	muls d5,d6
	asr.l d7,d6
	MOVE d6,(a6)+
sp_i	MOVE d2,d6
	muls d4,d6
	asr.l d7,d6
	MOVE d6,(a6)+
sp_a	MOVE d0,d6
	muls d2,d6
	asr.l d7,d6
	MOVE d6,(a6)+
sp_d	MOVE d1,d6
	muls d4,d6
	asr.l d7,d6
	movea.w d6,a4
	MOVE d0,d6
	muls d3,d6
	asr.l d7,d6
	muls d5,d6
	asr.l d7,d6
	sub.w a4,d6
	MOVE d6,(a6)+	
sp_g	MOVE d1,d6
	muls d5,d6
	asr.l d7,d6
	movea.w d6,a4
	MOVE d0,d6
	muls d3,d6
	asr.l d7,d6
	muls d4,d6
	asr.l d7,d6
	ADD a4,d6
	MOVE d6,(a6)+	
sp_b	MOVE d1,d6
	muls d2,d6
	asr.l d7,d6
	MOVE d6,(a6)+
sp_e	MOVE d0,d6
	muls d4,d6
	asr.l d7,d6
	movea.w d6,a4
	MOVE d1,d6
	muls d3,d6
	asr.l d7,d6
	muls d5,d6
	asr.l d7,d6
	ADD a4,d6
	MOVE d6,(a6)+	
sp_h	MOVE d0,d6
	muls d5,d6
	asr.l d7,d6
	movea.w d6,a4
	MOVE d1,d6
	muls d3,d6
	asr.l d7,d6
	muls d4,d6
	asr.l d7,d6
	sub.w a4,d6
	MOVE d6,(a6)+	
	movem.l (a7)+,d0-d7/a4-a6
	rts

sp_to_pl movem.l d0-d7/a1-a6,-(a7)
	lea 	points,a6
	ADDA.L	POINTEUR,A6
	MOVE	(A6)+,D0
	MOVE	(A6)+,D1
	MOVE	(A6)+,D2
	ADD.L	#6,POINTEUR
	SUB	#160,D0
	SUB	#100,D1
	
	lea depla,a3
	moveq	#0,d3
	moveq	#0,d4
MOD_Z	EQU	*+2
	MOVE	#0,D5

;	move	d5,d4
;	add	d2,d4
;	cmpi.l	#255,d4
;	bgt.s	oh_no
;	bra.s	oh_yes
;	
;oh_no	sub	#255,D5
;oh_yes	clr.l	d4
	
	ext.l d3
	ext.l d4
	ext.l d5
	moveq #9,d6
	asl.l d6,d3
	asl.l d6,d4
	asl.l d6,d5
	movea.l d3,a1	
	movea.l d4,a2
	movea.l d5,a3
	lea var_3d,a6
	MOVE d0,d3
	MOVE d1,d4
	MOVE d2,d5
	muls (a6)+,d3
	muls (a6)+,d4
	muls (a6)+,d5
	add.l d4,d5
	add.l d3,d5
	add.l a3,d5
	move.l d5,a5
	divs z_pt_fuite,d5
	MOVE #512,d7
	sub.w d5,d7
	MOVE d0,d3
	MOVE d1,d4
	MOVE d2,d5
	muls (a6)+,d3
	muls (a6)+,d4
	muls (a6)+,d5
	add.l d4,d5
	add.l d3,d5
	add.l a1,d5
	move.l d5,a4
	divs d7,d5
	muls (a6)+,d0
	muls (a6)+,d1
	muls (a6)+,d2
	add.l d0,d1
	add.l d1,d2
	add.l a2,d2
	move.l d2,d6
	divs d7,d2
	lea xp,a6
	ADD #160,d5
	MOVE d5,(a6)+
MOD_Y	EQU	*+2
	ADD #100,d2
	MOVE d2,(a6)+
	move.l a4,d5
	move.l a5,d7
	moveq #9,d0
	asr.l d0,d5
	asr.l d0,d6
	asr.l d0,d7
	MOVE d5,(a6)+
	MOVE d6,(a6)+
	MOVE d7,(a6)+
	MOVE	D7,ZA	
	movem.l (a7)+,d0-d7/a1-a6
	rts

ROUTINE
	MOVE	xp,D0
	MOVE	D0,(A1)+

	MOVE	yp,D0
	MOVE	D0,(A1)+

	RTS

	
FLAG2	DC.L	1
poly:
	ADDQ.L	#1,FLAG_PTS
	CMPI.L	#(136/4),FLAG_PTS
	BLE.S	AFF_TRUC
	TST.L	FLAG2
	BEQ.S	AFF_TRUC
	RTS
AFF_TRUC	JSR	LINE_A_INIT
	
	LEA	DATA_X,A5
	ADDA.L	PNT,A5
	CMPI	#$9999,(A5)
	BNE.S	OKAY
	CLR.L	PNT
	LEA	DATA_X,A5
	BRA.S	OKAY2
OKAY	ADD.L	#4*4,PNT
OKAY2	
	moveq	#0,d3

	moveq	#0,d4
	moveq	#0,d5
	moveq	#0,d6
	moveq	#0,d7
	move	2(a5),d4
	move	6(a5),d5
	move	10(a5),d6
	move	14(a5),d7

	cmp	d4,d5
	bgt	d5_pg
	move	d4,d5
d5_pg	
	cmp	d6,d5
	bgt	d5_pg2
	move	d6,d5
d5_pg2	
	cmp	d7,d5
	bgt	d5_pg3
	move	d7,d5
d5_pg3	addq	#1,d5
	move	d5,ymax

	moveq	#0,d3

	moveq	#0,d4
	moveq	#0,d5
	moveq	#0,d6
	moveq	#0,d7
	move	2(a5),d4
	move	6(a5),d5
	move	10(a5),d6
	move	14(a5),d7

	cmp	d4,d5
	blt	d5_pgh
	move	d4,d5
d5_pgh
	cmp	d6,d5
	blt	d5_pg2h
	move	d6,d5
d5_pg2h	
	cmp	d7,d5
	blt	d5_pg3h
	move	d7,d5
d5_pg3h	subq	#1,d5
	move	d5,ymin
	
;	LEA	TAB,A5
	LEA	_PTSIN,A6
	MOVE.L	(A5)+,(A6)+
	MOVE.L	(A5)+,(A6)+
	MOVE.L	(A5)+,(A6)+
	MOVE.L	(A5)+,(A6)+
	LEA	-4*4(A5),A5
	MOVE.L	(A5)+,(A6)+
	
	MOVE	ymin,D3
LOOP1	MOVE	D3,40(A0)
	MOVE.L	A0,-(SP)
;	DC	POLYGON
	cmp	#0,d3
	blt.s	saut
	cmp	#200,d3
	bge.s	saut
	JSR	LINE_A_POLYGON
saut	
	MOVE.L	(SP)+,A0
	ADDQ	#1,D3
	CMP	ymax,D3
	BNE	LOOP1

	RTS
ymin	ds	1
ymax	ds	1
LINE_A_INIT
	LEA	EMUL_LINEA,A0
	MOVE.L	A0,D0
	RTS

LINE_A_POLYGON
	MOVEM.L	D3-D7/A3-A5,-(SP)
	JSR	_FCA0D6
	MOVEM.L	(SP)+,D3-D7/A3-A5
	RTS

_FCA0D6
	MOVEQ	#3,D0
	
	LEA	_PTSIN,A0
	LEA	BUF16DA,A1
	CLR	PNT_261E
	
LFCA0F4	MOVE	6(A0),D1
	MOVE	2(A0),D2
	SUB	D2,D1
	BEQ.S	LFCA13E
	MOVE	EMUL_LINEA-$299A+$29C2,D3
	MOVE	D3,D4
	SUB	D2,D4
	SUB	6(A0),D3
	MOVE	D4,D2
	EOR	D3,D2
	BPL.S	LFCA13E
	MOVE	4(A0),D2
	SUB	0(A0),D2
	ADD	D2,D2
	MULS	D2,D4
	DIVS	D1,D4
	BPL.S	LFCA12E
	NEG	D4
	ADDQ	#1,D4
	ASR	#1,D4
	NEG	D4
	BRA.S	LFCA132
LFCA12E	ADDQ	#1,D4
	ASR	#1,D4
LFCA132	ADD	0(A0),D4
	MOVE	D4,(A1)+
	ADDQ	#1,PNT_261E
	
LFCA13E	LEA	4(A0),A0
	DBF	D0,LFCA0F4
	MOVE	PNT_261E,D0
	BNE.S	LFCA150
	RTS
LFCA150	
	LEA	BUF16DA,A0
	BSR	LFCA1DC
	MOVE	PNT_261E,D0
	ASR	#1,D0
	SUBQ	#1,D0
	TST	EMUL_LINEA+$29D0-$299A
	BNE.S	LFCA18A
LFCA16C	
	MOVE	(A1)+,EMUL_LINEA+$29C0-$299A
	MOVE	(A1)+,EMUL_LINEA+$29C4-$299A
	MOVE	D0,-(A7)
	MOVE.L	A1,-(A7)
	BSR	_FCA5F6
	MOVEA.L	(A7)+,A1
	MOVE	(A7)+,D0
	DBF	D0,LFCA16C
	RTS
LFCA18A	
	MOVE	(A1)+,EMUL_LINEA+$29C0-$299A
	MOVE	(A1)+,EMUL_LINEA+$29C4-$299A

	MOVE	EMUL_LINEA+$29D2-$299A,D1
	MOVE	EMUL_LINEA+$29C0-$299A,D2
	MOVE	EMUL_LINEA+$29C4-$299A,D3
	CMP	D1,D2
	BGE.S	LFCA1B6
	CMP	D1,D3
	BLT.S	LFCA1D6
	MOVE	D1,EMUL_LINEA+$29C0-$299A
LFCA1B6	
	MOVE	EMUL_LINEA+$29D6-$299A,D1
	CMP	D1,D3
	BLE.S	LFCA1CA
	CMP	D1,D2
	BGT.S	LFCA1D6
	MOVE	D1,EMUL_LINEA+$29C4-$299A
LFCA1CA	MOVE	D0,-(A7)
	MOVE.L	A1,-(A7)
	BSR	_FCA5F6
	MOVEA.L	(A7)+,A1
	MOVE	(A7)+,D0
LFCA1D6	DBF	D0,LFCA18A
	RTS
LFCA1DC	SUBQ	#2,D0
	BCS.S	LFCA1FC
	MOVE	D0,D1
	MOVEA.L	A0,A1
LFCA1E4	MOVE	D1,D0
	MOVEA.L	A1,A0
LFCA1E8	MOVE	(A0)+,D2
	CMP	(A0),D2
	BLE.S	LFCA1F4
	MOVE	(A0),-2(A0)
	MOVE	D2,(A0)
LFCA1F4	DBF	D0,LFCA1E8
	DBF	D1,LFCA1E4
LFCA1FC	RTS
	MOVEQ	#1,D1
	MOVE	6(A7),D0
	MULS	4(A7),D0
	BGE.S	LFCA20C
	NEG	D1
LFCA20C	MOVE	8(A7),D2
	DIVS	D2,D0
	TST	D2
	BGE.S	LFCA21A
	NEG	D1
	NEG	D2
LFCA21A	MOVE.L	D3,-(A7)
	MOVE.L	D0,D3
	BGE.S	LFCA222
	NEG.L	D3
LFCA222	SWAP	D3
	ADD	D3,D3
	CMP	D2,D3
	BLT.S	LFCA22C
	ADD	D1,D0
LFCA22C	MOVE.L	(A7)+,D3
	RTS
	MOVE	D2,-(A7)
	MOVE	D3,-(A7)
	MULS	#160,D1

	MOVE	EMUL_LINEA,D3
	MOVE.B	_FCA259(PC,D3.W),D3
	MOVE	D0,D2
	EXT.L	D2
	AND	#$FFF0,D2
	ASR	D3,D2
	ADD.L	D2,D1
	AND	#$F,D0
	MOVE	(A7)+,D3
	MOVE	(A7)+,D2
	RTS
_FCA259	DC.L	$03020001
	DC.L	$00000000

_FCA5D4	DC	$FFFF
_FCA5D6	DC.L	$7FFF3FFF
	DC.L	$1FFF0FFF
	DC.L	$07FF03FF
	DC.L	$01FF00FF
	DC.L	$007F003F
	DC.L	$001F000F
	DC.L	$00070003
	DC.L	$00010000

_FD1B86	DC.L	$00CC0130
	DC.L	$009C014A
	DC.L	$4E56FFEC

_FCA5F6
	LEA	EMUL_LINEA,A4
	MOVEM	$26(A4),D4-D6
	MOVE	D5,D0
	AND	$32(A4),D0
	ADD	D0,D0
	MOVEA.L	$2E(A4),A0
	ADDA	D0,A0
	TST	$34(A4)
	SNE	D0
	AND	#$20,D0
	MOVE	D4,D1
	ASR	#4,D1
	MOVE	D6,D2
	ASR	#4,D2
	MOVEQ	#$F,D3
	AND	D3,D4
	ADD	D4,D4
	MOVE	_FCA5D4(PC,D4.W),D4
	AND	D3,D6
	ADD	D6,D6
	MOVE	_FCA5D6(PC,D6.W),D6
	NOT	D6
	SUB	D1,D2
	BNE.S	LFCA63C
	AND	D6,D4
LFCA63C	MOVEA.L	$9A(A4),A5
LFD1B58
	MOVEA.L	SCREEN1,A1
	MULS	#160,D5
	ADDA.L	D5,A1
	MOVEA	D0,A2

	MOVE	#4,D7
	MOVE	D7,D0
	ADD	D0,D0
	MULS	D0,D1
	ADDA.L	D1,A1
	MOVEQ	#0,D7
	
	LEA	$18(A4),A3
	MOVE	$24(A4),D1
	ADD	D1,D1
TST	LEA	_FD1B86(PC,D1.W),A5
	ADDA	(A5),A5

LFD1C52

	NOT	D4
	NOT	D6
LFD1C56	MOVEA.L	A1,A4
	MOVE	D2,D5
	MOVE	(A0),D3
	ADDA	A2,A0
	TST	(A3)+
	BNE.S	LFD1C88
	MOVE	D4,D1
	AND	D1,(A1)
	ADDQ.L	#8,A1
	SUBQ	#1,D5
	BCS.S	LFD1C7E
	SUBQ	#1,D5
	BCS.S	LFD1C78
	CLR	D1
LFD1C70	ADDA	D0,A4
	MOVE	D1,(A4)
	DBF	D5,LFD1C70
LFD1C78	MOVE	D6,D1
	ADDA	D0,A4
	AND	D1,(A4)
LFD1C7E	DBF	D7,LFD1C56
	NOT	D4
	NOT	D6
	RTS

LFD1C88	MOVE	(A4),D1
	EOR	D3,D1
	AND	D4,D1
	EOR	D3,D1
	MOVE	D1,(A1)
	ADDQ.L	#8,A1
	SUBQ	#1,D5
	BCS.S	LFD1CAE
	SUBQ	#1,D5
	BCS.S	LFD1CA2
LFD1C9A	ADDA	D0,A4
	MOVE	D3,(A4)
	DBF	D5,LFD1C9A
LFD1CA2	ADDA	D0,A4
	MOVE	(A4),D1
	EOR	D3,D1
	AND	D6,D1
	EOR	D3,D1
	MOVE	D1,(A4)
LFD1CAE	DBF	D7,LFD1C56
	NOT	D4
	NOT	D6
	RTS

FILL	
	DC.L	-1
	DC.L	-1
	DC.L	-1
	DC.L	-1
	
TAB	
	DC	50,70
	DC	12,175
	DC	120,190
	DC	410,150

	DC	50,70

cos_tab	incbin 'COSIN.DAT'	;tables sinus cosinus
sin_tab	equ cos_tab+720

points	
*LETSGO
 DC 0,0,0
 DC 0,199,0
 DC 8,199,0
 DC 8,0,0
 DC 0,0,0
 DC 0,8,0
 DC 320,8,0
 DC 320,0,0
 DC 312,0,0
 DC 312,199,0
 DC 320,199,0
 DC 320,0,0
 DC 0,191,0
 DC 0,199,0
 DC 320,199,0
 DC 320,191,0
 DC 16,16,0
 DC 16,96,0
 DC 48,96,0
 DC 48,16,0
 DC 32,72,0
 DC 32,96,0
 DC 80,96,0
 DC 80,72,0
 DC 88,16,0
 DC 88,96,0
 DC 120,96,0
 DC 120,16,0
 DC 112,16,0
 DC 112,40,0
 DC 144,40,0
 DC 144,16,0
 DC 112,72,0
 DC 112,96,0
 DC 144,96,0
 DC 144,72,0
 DC 112,48,0
 DC 112,64,0
 DC 128,64,0
 DC 128,48,0
 DC 152,16,0
 DC 152,40,0
 DC 208,40,0
 DC 208,16,0
 DC 168,32,0
 DC 168,96,0
 DC 192,96,0
 DC 192,32,0
 DC 248,16,0
 DC 248,40,0
 DC 304,40,0
 DC 304,16,0
 DC 216,72,0
 DC 216,96,0
 DC 272,96,0
 DC 272,72,0
 DC 240,32,0
 DC 240,80,0
 DC 280,80,0
 DC 280,32,0
 DC 248,16,0
 DC 240,32,0
 DC 248,40,0
 DC 264,24,0
 DC 256,72,0
 DC 272,96,0
 DC 280,80,0
 DC 272,64,0
 DC 216,16,0
 DC 216,48,0
 DC 232,16,0
 DC 224,16,0
 DC 88,104,0
 DC 32,104,0
 DC 32,128,0
 DC 88,128,0
 DC 32,160,0
 DC 32,184,0
 DC 88,184,0
 DC 88,160,0
 DC 32,104,0
 DC 16,128,0
 DC 16,160,0
 DC 32,184,0
 DC 88,136,0
 DC 56,136,0
 DC 56,168,0
 DC 88,168,0
 DC 40,136,0
 DC 40,152,0
 DC 72,152,0
 DC 72,136,0
 DC 104,112,0
 DC 104,176,0
 DC 128,176,0
 DC 128,112,0
 DC 152,112,0
 DC 152,176,0
 DC 176,176,0
 DC 176,112,0
 DC 120,104,0
 DC 120,120,0
 DC 160,120,0
 DC 160,104,0
 DC 120,168,0
 DC 120,184,0
 DC 160,184,0
 DC 160,168,0
 DC 120,104,0
 DC 104,112,0
 DC 112,120,0
 DC 128,112,0
 DC 160,104,0
 DC 160,112,0
 DC 168,120,0
 DC 176,112,0
 DC 104,176,0
 DC 120,184,0
 DC 128,176,0
 DC 112,168,0
 DC 160,184,0
 DC 176,176,0
 DC 168,168,0
 DC 152,176,0
 DC 184,168,0
 DC 184,184,0
 DC 200,184,0
 DC 200,168,0
 DC 208,168,0
 DC 208,184,0
 DC 224,184,0
 DC 224,168,0
 DC 232,168,0
 DC 232,184,0
 DC 248,184,0
 DC 248,168,0
********
 DC 0,200,-0
 DC 0,200,-8
 DC 320,200,-8
 DC 320,200,-0
 DC 0,200,-0
 DC 0,200,-199
 DC 8,200,-199
 DC 8,200,-0
 DC 0,200,-191
 DC 0,200,-199
 DC 320,200,-199
 DC 320,200,-191
 DC 312,200,-0
 DC 312,200,-199
 DC 320,200,-199
 DC 320,200,-0
 DC 16,200,-48
 DC 16,200,-56
 DC 24,200,-56
 DC 24,200,-48
 DC 32,200,-48
 DC 32,200,-56
 DC 40,200,-56
 DC 40,200,-48
 DC 48,200,-48
 DC 48,200,-56
 DC 56,200,-56
 DC 56,200,-48
 DC 64,200,-16
 DC 64,200,-32
 DC 112,200,-32
 DC 112,200,-16
 DC 80,200,-24
 DC 80,200,-56
 DC 96,200,-56
 DC 96,200,-24
 DC 120,200,-16
 DC 120,200,-56
 DC 136,200,-56
 DC 136,200,-16
 DC 152,200,-16
 DC 152,200,-56
 DC 168,200,-56
 DC 168,200,-16
 DC 128,200,-16
 DC 128,200,-24
 DC 160,200,-24
 DC 160,200,-16
 DC 128,200,-48
 DC 128,200,-56
 DC 160,200,-56
 DC 160,200,-48
 DC 144,200,-64
 DC 144,200,-80
 DC 192,200,-80
 DC 192,200,-64
 DC 160,200,-72
 DC 160,200,-104
 DC 176,200,-104
 DC 176,200,-72
 DC 200,200,-64
 DC 200,200,-104
 DC 216,200,-104
 DC 216,200,-64
 DC 224,200,-64
 DC 224,200,-104
 DC 240,200,-104
 DC 240,200,-64
 DC 208,200,-80
 DC 208,200,-88
 DC 232,200,-88
 DC 232,200,-80
 DC 248,200,-64
 DC 248,200,-104
 DC 264,200,-104
 DC 264,200,-64
 DC 256,200,-64
 DC 256,200,-72
 DC 280,200,-72
 DC 280,200,-64
 DC 256,200,-96
 DC 256,200,-104
 DC 280,200,-104
 DC 280,200,-96
 DC 256,200,-80
 DC 256,200,-88
 DC 272,200,-88
 DC 272,200,-80
 DC 40,200,-112
 DC 40,200,-144
 DC 56,200,-144
 DC 56,200,-112
 DC 72,200,-112
 DC 72,200,-144
 DC 80,200,-144
 DC 80,200,-112
 DC 56,200,-112
 DC 56,200,-120
 DC 72,200,-144
 DC 72,200,-136
 DC 88,200,-112
 DC 88,200,-144
 DC 104,200,-144
 DC 104,200,-112
 DC 96,200,-112
 DC 96,200,-120
 DC 120,200,-120
 DC 120,200,-112
 DC 96,200,-136
 DC 96,200,-144
 DC 120,200,-144
 DC 120,200,-136
 DC 96,200,-124
 DC 96,200,-132
 DC 112,200,-132
 DC 112,200,-124
 DC 128,200,-112
 DC 128,200,-120
 DC 152,200,-144
 DC 152,200,-136
 DC 128,200,-136
 DC 128,200,-144
 DC 152,200,-120
 DC 152,200,-112
 DC 160,200,-112
 DC 160,200,-120
 DC 192,200,-120
 DC 192,200,-112
 DC 168,200,-116
 DC 168,200,-144
 DC 184,200,-144
 DC 184,200,-116
 DC 144,200,-152
 DC 144,200,-184
 DC 152,200,-184
 DC 152,200,-152
 DC 148,200,-152
 DC 148,200,-160
 DC 164,200,-160
 DC 164,200,-152
 DC 148,200,-168
 DC 148,200,-176
 DC 164,200,-176
 DC 164,200,-168
 DC 160,200,-156
 DC 160,200,-172
 DC 168,200,-172
 DC 168,200,-156
 DC 176,200,-152
 DC 176,200,-184
 DC 184,200,-184
 DC 184,200,-152
 DC 192,200,-152
 DC 192,200,-184
 DC 200,200,-184
 DC 200,200,-152
 DC 180,200,-152
 DC 180,200,-160
 DC 196,200,-160
 DC 196,200,-152
 DC 180,200,-168
 DC 180,200,-176
 DC 196,200,-176
 DC 196,200,-168
 DC 208,200,-152
 DC 208,200,-184
 DC 216,200,-184
 DC 216,200,-152
 DC 212,200,-152
 DC 212,200,-160
 DC 228,200,-160
 DC 228,200,-152
 DC 212,200,-168
 DC 212,200,-176
 DC 228,200,-176
 DC 228,200,-168
 DC 224,200,-156
 DC 224,200,-172
 DC 232,200,-172
 DC 232,200,-156
 DC 224,200,-184
 DC 232,200,-184
 DC 220,200,-172
 DC 212,200,-172
 DC 240,200,-152
 DC 240,200,-160
 DC 272,200,-160
 DC 272,200,-152
 DC 248,200,-156
 DC 248,200,-184
 DC 264,200,-184
 DC 264,200,-156
 DC 288,200,-176
 DC 288,200,-184
 DC 296,200,-184
 DC 296,200,-176
 DC 291,200,-168
 DC 299,200,-136
 DC 291,200,-128
 DC 283,200,-136

depla	
;	include	z2.dat
	dc	255
TABLE_DAT
 DC 1
 DC 2
 DC 3
 DC 4
 DC 5
 DC 6
 DC 7
 DC 8
 DC 10
 DC 11
 DC 12
 DC 13
 DC 14
 DC 15
 DC 16
 DC 17
 DC 18
 DC 20
 DC 21
 DC 22
 DC 23
 DC 24
 DC 25
 DC 26
 DC 27
 DC 28
 DC 29
 DC 31
 DC 32
 DC 33
 DC 34
 DC 35
 DC 36
 DC 37
 DC 38
 DC 39
 DC 41
 DC 42
 DC 43
 DC 44
 DC 45
 DC 46
 DC 47
 DC 48
 DC 49
 DC 51
 DC 52
 DC 53
 DC 54
 DC 55
 DC 56
 DC 57
 DC 58
 DC 59
 DC 61
 DC 62
 DC 63
 DC 64
 DC 65
 DC 66
 DC 67
 DC 68
 DC 70
 DC 71
 DC 72
 DC 73
 DC 74
 DC 75
 DC 76
 DC 77
 DC 78
 DC 80
 DC 81
 DC 82
 DC 83
 DC 84
 DC 85
 DC 86
 DC 87
 DC 88
 DC 90
 DC 91
 DC 92
 DC 93
 DC 94
 DC 95
 DC 96
 DC 97
 DC 98
 DC 100
 DC 100
 DC 100

FAD_IN	DC	$0,$111,$222,$333,$444,$555,$666,$777
	DC	-1
FAD_OUT	DC	$777,$666,$555,$444,$333,$222,$111,$0
	DC	-1

PART1	DC	%1111111111111111
	DC	%0111111111111111
	DC	%0011111111111111
	DC	%0001111111111111
	DC	%0000111111111111
	DC	%0000011111111111
	DC	%0000001111111111
	DC	%0000000111111111
	DC	%0000000011111111
	DC	%0000000001111111
	DC	%0000000000111111
	DC	%0000000000011111
	DC	%0000000000001111
	DC	%0000000000000111
	DC	%0000000000000011
	DC	%0000000000000001

PART2	DC	%1000000000000000
	DC	%1100000000000000
	DC	%1110000000000000
	DC	%1111000000000000
	DC	%1111100000000000
	DC	%1111110000000000
	DC	%1111111000000000
	DC	%1111111100000000
	DC	%1111111110000000
	DC	%1111111111000000
	DC	%1111111111100000
	DC	%1111111111110000
	DC	%1111111111111000
	DC	%1111111111111100
	DC	%1111111111111110
	DC	%1111111111111111

PNTS
N	SET	32768
	REPT	16
	DC	N
N	SET	N/2
	ENDR

GANDALF	INCBIN	GANDALF.PAK
	EVEN
	
	section bss

xe	ds 1
ye	ds 1
ze	ds 1
xdep	ds 1
ydep	ds 1
zdep	ds 1
xp	ds 1
yp	ds 1
new_xe	ds 1
new_ye	ds 1
new_ze	ds 1
x_angle	ds 1
y_angle	ds 1
z_angle	ds 1	
z_pt_fuite	ds 1
var_3d	ds 9
POINTEUR	DS.L	1
POINTEUR2	DS.L	1
DATA_X
	DS	NB_PTS
;DATA_Y
	DS	NB_PTS
	DS.B	200
modif	Ds	1

SCREEN2	DS.L	1
SCREEN1	DS.L	1
SCREEN3	DS.L	1
FLAG_PTS	DS.L	1
ANC_VBL	DS.L	1
CNT	DS.L	1
CNT2	DS.L	1
ZA	DS	1	
PNT_X	DS.L	1
PNT_Y	DS.L	1
PNT	DS.L	1
REG_GEN	DS.L	16
*LINE_A_EMUL

PNT_261E	DS	1
EMUL_LINEA	DS.B	100
BUF16DA	DS.B	512
BUF299A	DS.B	512

_PTSIN	DS.B	100
	
	DS.B	256
BUFFERSCR	DS.B	32000
TABLE	DS.L	360
BUF1	DS.B	8000
BUF2	DS.B	8000
FINAL	DS.L	16
DATAS	DS.B	8000

BUFCOD	DS.B	373000
END_COD