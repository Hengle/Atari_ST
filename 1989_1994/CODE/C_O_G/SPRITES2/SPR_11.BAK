	*******************************
	*DERNIERES ROUTINES DE SPRITES*
	*     EN CODE GêNêRê...       *
	* DERNIERE PARCE QUE J'EN AI  *
	* MARRE DE FAIRE DES OPT PEN- *
	*  DANT DES MOIS ET DES MOIS  *
	*******************************
X	EQU	5	;(COLONNES DE 16 PIXELS)+1
Y	EQU	63	;HAUTEUR
NB_SPR	EQU	5	;NOMBRE DE SPRITES
NB_DECAL	EQU	8	;8 OU 16
NB_DEC	EQU	1	;1 POUR 8 ET 0 POUR 16
PAS	EQU	15*6	;PRISE DE POS DANS LA COURBE

	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP

	CLR.W	-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL

	MOVE.B	$FFFF8201.W,SAUVEC
	MOVE.B	$FFFF8203.W,SAUVEC+1
	BSR	PREP_ECR
	BSR	MAK_COD
	LEA	PIC+34+128,A0
	BSR	PREDECALET
	MOVE.L	SCREEN1,A0
	MOVE.L	SCREEN2,A1
	MOVE.W	#7999,D7
RECOMEFF	CLR.L	(A0)+
	CLR.L	(A1)+
	DBRA	D7,RECOMEFF

	LEA	COURB,A0
	LEA	FIN_CRB,A1
	MOVE.L	-12(A1),-12(A0)
	MOVE.L	-8(A1),-8(A0)
	MOVE.L	-4(A1),-4(A0)	
	MOVE.W	#((PAS/6)*5)-2,D7
RECOP1	MOVE.L	(A0)+,(A1)+
	MOVE.W	(A0)+,(A1)+
	DBRA	D7,RECOP1
	MOVE.L	#-1,(A1)

	MOVE.L	#COURB,PNT_CRB

	MOVE.L	#FIN,$008
	MOVE.L	#FIN,$00C
	MOVE.L	#FIN,$010
	MOVE.L	#FIN,$014
	MOVE.L	#FIN,$018
	MOVE.L	#FIN,$01C
	MOVE.L	#FIN,$020

	ANDI.B	#%11111000,$484.W

	MOVEM.L	PIC+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVE.B	$FFFFFA07.W,MFP
	MOVE.B	$FFFFFA09.W,MFP+1
	MOVE.B	$FFFFFA0F.W,MFP+2
	MOVE.B	$FFFFFA13.W,MFP+3
	MOVE.B	$FFFFFA1B.W,MFP+4
	MOVE.B	$FFFFFA21.W,MFP+5

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	$120.W,ANC_TIM
	MOVE.L	#VBLR,$70.W
	MOVE.L	#TB0,$120.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W

LOOP	JMP	LOOP

FIN	MOVE.W	#$2700,SR
	MOVE.L	ANC_VBL,$70.W
	MOVE.L	ANC_TIM,$120.W
	
	MOVE.B	MFP,$FFFFFA07.W
	MOVE.B	MFP+1,$FFFFFA09.W
	MOVE.B	MFP+2,$FFFFFA0F.W
	MOVE.B	MFP+3,$FFFFFA13.W
	MOVE.B	MFP+4,$FFFFFA1B.W
	MOVE.B	MFP+5,$FFFFFA21.W

	MOVE.W	#$2300,SR
	MOVE.B	SAUVEC,$FFFF8201.W
	MOVE.B	SAUVEC+1,$FFFF8203.W

	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ORI.B	#%00000111,$484.W
	
	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W
	
	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
	*******	V B L  &  P R O C E D U R E S    *******
VBLR	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUITV0
	ST	$FFFF8240.W
SUITV0	
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4	;D
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A4	;A
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;N
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

;	MOVE.L	SCREEN2,A4	;T
;	ADDA.W	4(A5),A4
;N	SET	0
;	REPT	Y
;	MOVEM.L	D0-D7/A0-A1,N(A4)
;N	SET	N+160
;	ENDR
;	LEA	PAS(A5),A5
;	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;O
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;O
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A4	;O
	ADDA.W	4(A5),A4
N	SET	0
	REPT	Y
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	*AFFICHAGE EN MOVEM

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	Y
	MOVEM.L	(A0)+,D0-D7/A2-A3
	MOVEM.L	D0-D7/A2-A3,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

;	LEA	TABLE_GEN+(60*8),A6	;U
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5

;	LEA	TABLE_GEN+(48*8),A6	;O
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(36*8),A6	;T
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;A
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5



;	LEA	TABLE_GEN+(24*8),A6	;N
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5
;	LEA	PAS(A5),A5
	


	LEA	TABLE_GEN+(24*8),A6	;N
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;A
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6	;D
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5


	SF	$FFFF8240.W
	BSR	SWAPEC

	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*5)-6(A0)
	BNE.S	FINF
	MOVE.L	#COURB,PNT_CRB
FINF	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE
	
TB0	BCLR	#0,$FFFFFA0F.W
	RTE

SWAPEC	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS
	
MAK_COD	MOVE.L	#TABLE_SPR,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6
	LEA	FIC_OPT,A3	;OPT POUR LE SPRITE(MASK-SPRITE)
	CLR.W	FLAG_EFF
	BSR 	CODING	;D

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+512,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;A

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+1024,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;N

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+1536,A3
	CLR	FLAG_EFF
	BSR	CODING	;T

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+2048,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;O

	RTS

CODING	
RECOMGENSPR	MOVE.L	ANNEX,A0
	MOVE.L	(A0),A0
	MOVE.L	SCREEN1,A1
	MOVE.L	SCREEN2,A5
	MOVE.W	#Y-1,D6
REAF2	MOVE.W	#X-2,D7
REAF1	MOVE.L	(A0),(A1)+
	MOVE.L	4(A0),(A1)+
	MOVE.W	(A0),D0
	MOVE.W	2(A0),D1
	MOVE.W	4(A0),D2
	OR.W	D2,D0
	OR.W	D1,D0
	NOT.W	D0
	MOVE.W	D0,(A5)+
	ADDQ.L	#8,A0
	DBRA	D7,REAF1
	CLR.L	(A1)+
	CLR.L	(A1)+
	MOVE.W	#-1,(A5)+
	LEA	160-((X-1)*8)(A0),A0
	DBRA	D6,REAF2

	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	REPT	NB_DECAL-1
	BSR	DECAL_SPR
	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	ENDR
	RTS

DECAL_SPR	MOVE.L	SCREEN2,A1	;MSK
	MOVE.W	#NB_DEC,D4
RECOM_DEC	MOVE.L	SCREEN1,A0	;SPR
	MOVE.W	#Y-1,D5
DEC3	MOVE.W	#3,D6
DEC2	MOVE.W	#X-1,D7
DEC1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DEC1
	LEA	-((X*8)-2)(A0),A0
	DBRA	D6,DEC2
	LEA	(X-1)*8(A0),A0
	DBRA	D5,DEC3
	DBRA	D4,RECOM_DEC
	MOVE.L	SCREEN1,A0
	MOVE.W	#Y-1,D6
MSK2	MOVE.W	#X-1,D7
MSK1	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.W	(A0)+,D2
	ADDQ.L	#2,A0
	OR.W	D1,D0
	OR.W	D2,D0
	NOT.W	D0
	MOVE.W	D0,(A1)+
	DBRA	D7,MSK1
	DBRA	D6,MSK2
	RTS

COD_GEN	MOVE.L	SCREEN1,A0	;SPR
	MOVE.L	SCREEN2,A1	;MSK
	MOVE.L	#$4CDA00FF,(A2)+
	MOVE.W	#Y-1,D6
CDG2	MOVE.W	#X-1,D7
CDG1	BSR	ANDS
	DBRA	D7,CDG1
	MOVE.W	#$41E8,(A2)+
	MOVE.W	#160-(X*8),(A2)+
	BSR	OPTI_ADDQ_ANDS
 	DBRA	D6,CDG2
	LEA	32(A3),A3
	MOVE.L	SCREEN1,A0	;SPR
	MOVE.L	SCREEN2,A1	;MSK
	MOVE.L	#$4CDA00FF,(A2)+
	MOVE.W	#Y-1,D6
CDG4	MOVE.W	#X-1,D7
CDG3	BSR	ORS
	DBRA	D7,CDG3
	MOVE.W	#$43E9,(A2)+
	MOVE.W	#160-(X*8),(A2)+
	BSR	OPTI_ADDQ_ORS
	DBRA	D6,CDG4
	LEA	32(A3),A3
	SUBQ.L	#4,A2
	MOVE.W	#$4E75,(A2)+
	RTS

ANDS	TST.W	(A1)
	BEQ.S	NO_MASK
	CMPI.W	#-1,(A1)
	BEQ.S	NO_MASK
	;TST.L	0(A0)
	;BEQ	AND1
	MOVE.W	#$C158,D4
	MOVE.W	#$C198,D5
	CLR.W	ADD1
	MOVE.W	(A1),D0
	MOVE.W	#7,D3
CHERCHMSK	CMP.W     	(A3),D0
	BEQ.S	MSKTROUVê
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	ADDI.W	#$200,D5
	ADDQ.W	#4,ADD1
	DBRA	D3,CHERCHMSK
	LEA	-32(A3),A3
	MOVE.W	#$0298,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
MSKTROUVê	SUBA.W	ADD1,A3
	MOVE.W	D5,(A2)+
	MOVE.W	D4,(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
NO_MASK	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_ANDS
;	ADDQ.W	#1,ADD
FIN_MASK	ADDQ.L	#2,A1
	ADDQ.L	#8,A0
	RTS

AND1	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5C48,(A2)+
	BRA	FIN_MASK

OPTI_ADDQ_ANDS:
	CLR.W	VARI
	MOVE.W	#$5048,D1	;ADDQ.W	#8,A0
	MOVE.W	#$5448,D2	;ADDQ.W	#2,A0
	MOVE.W	#$41E8,D3	;LEA	#IMM(A0),A0
CONTANDQ	CMP.W	-2(A2),D1
	BNE.S	ANDQ2
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ2	CMP.W	-2(A2),D2
	BNE.S	ANDQ3
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ3	CMP.W	-4(A2),D3
	BNE.S	FINANDQ
	MOVE.W	-2(A2),D4
	ADD.W	D4,VARI
	SUBQ.L	#4,A2
	BRA	CONTANDQ
FINANDQ	TST.W	VARI
	BEQ	SORTANDQ
	CMPI.W	#8,VARI
	BGT	CHANDQ2
	CMPI.W	#2,VARI
	BNE.S	CH1
	MOVE.W	#$5448,(A2)+
	BRA.S	SORTANDQ
CH1	CMPI.W	#4,VARI
	BNE.S	CH11
	MOVE.W	#$5848,(A2)+
	BRA.S	SORTANDQ
CH11	CMPI.W	#6,VARI
	BNE.S	CH111
	MOVE.W	#$5C48,(A2)+
	BRA.S	SORTANDQ
CH111	MOVE.W	#$5048,(A2)+
	BRA.S	SORTANDQ
CHANDQ2	MOVE.W	#$41E8,(A2)+
	MOVE.W	VARI,(A2)+
SORTANDQ	RTS

OPTI_ADDQ_ORS:
	CLR.W	VARI
	MOVE.W	#$5449,D0
	MOVE.W	#$5849,D1
	MOVE.W	#$5C49,D2
	MOVE.W	#$5049,D3
	MOVE.W	#$43E9,D4
CONTORQ	CMP.W	-2(A2),D0
	BNE.S	ORQ2
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ2	CMP.W	-2(A2),D1
	BNE.S	ORQ3
	ADDQ.W	#4,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ3	CMP.W	-2(A2),D2
	BNE.S	ORQ4
	ADDQ.W	#6,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ4	CMP.W	-2(A2),D3
	BNE.S	ORQ5
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ5	CMP.W	-4(A2),D4
	BNE.S	SORTORQ
	MOVE.W	-2(A2),D0
	ADD.W	D0,VARI
	MOVE.W	#$5449,D0
	SUBQ.L	#4,A2
	BRA.S	CONTORQ
SORTORQ	TST.W	VARI
	BEQ	FINORQ
	CMPI.W	#8,VARI
	BGT	CHORQ2
	CMPI.W	#2,VARI
	BNE.S	ORQ11
	MOVE.W	#$5449,(A2)+
	BRA	FINORQ
ORQ11	CMPI.W	#4,VARI
	BNE.S	ORQ111
	MOVE.W	#$5849,(A2)+
	BRA	FINORQ
ORQ111	CMPI.W	#6,VARI
	BNE.S	ORQ1111
	MOVE.W	#$5C49,(A2)+
	BRA	FINORQ
ORQ1111	MOVE.W	#$5049,(A2)+
	BRA	FINORQ
CHORQ2	MOVE.W	#$43E9,(A2)+
	MOVE.W	VARI,(A2)+
FINORQ	RTS

ORS	TST.W	(A1)
	BEQ	AFF_MOV
	CMPI.W	#-1,(A1)
	BEQ	NO_AFF
	TST.L	(A0)
	BEQ	AFF3
	TST.L	2(A0)
	BEQ	AFF1
	TST.W	(A0)
	BEQ	AFF23
	TST.W	4(A0)
	BEQ	AFF12
;	TST.W	2(A0)
;	BEQ	AFF13
	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE1
	BRA	NOT1SAME
APRES1COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1	CMP.L	(A3),D0
	BEQ.S	TROUVê1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE1	CLR.W	ADD1
	SWAP	D0
	MOVE.W	2(A0),D0
	MOVE.W	#$8199,D4
	MOVE.W	#7,D3
CHERCHCOMP1	CMP.L	(A3),D0
	BEQ.S	TROUVêC1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP1
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêC1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP

NOT1SAME	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPA	CMP.L	(A3),D0
	BEQ.S	TROUVêA
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPA
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêA	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPB	CMP.L	(A3),D0
	BEQ.S	TROUVêB
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPB
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES1COMP
TROUVêB	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP


AFF13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP13	CMP.L	(A3),D0
	BEQ.S	TROUVê13
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP13
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	CONT2
TROUVê13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD

CONT2	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1_3	CMP.L	(A3),D0
	BEQ.S	TROUVê1_3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1_3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	
	BRA	FIN_AFF

AFF3	MOVE.W	#$5849,(A2)+
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP3	CMP.L	(A3),D0
	BEQ.S	TROUVê3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP11	CMP.L	(A3),D0
	BEQ.S	TROUVê11
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP11
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê11	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE2
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
APRES2COMP	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE2	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHCOMP2	CMP.L	(A3),D0
	BEQ.S	TROUVêC2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP2
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES2COMP
TROUVêC2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES2COMP

AFF23	BSR	OPTI_ADDQ_ORS
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	TST.W	4(A0)
	BEQ	AFF2
	MOVE.W	#$0099,(A2)+
	MOVE.L	2(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
AFF2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP2	CMP.L	(A3),D0
	BEQ.S	TROUVê2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP2
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF_MOV	TST.L	(A0)
	BEQ	MOV3
;	TST.L	2(A0)
;	BEQ	MOV1
	TST.W	(A0)
	BEQ	MOV23
	TST.W	4(A0)
	BEQ	MOV12
;	TST.W	2(A0)
;	BEQ	MOV13
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE3
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV66	CMP.L	(A3),D0
	BEQ.S	TROUVêMV66
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV66
	LEA	-32(A3),A3
	BRA	CONT6
TROUVêMV66	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+

	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV77	CMP.L	(A3),D0
	BEQ.S	TROUVêMV77
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV77
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES3COMP
TROUVêMV77	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP

CONT6	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
APRES3COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV33	CMP.L	(A3),D0
	BEQ.S	TROUVêMV33
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV33
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV33	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE3	SWAP	D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP3	CMP.L	(A3),D0
	BEQ.S	TROUVêC3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP3
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES3COMP
TROUVêC3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP


MOV13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV13	CMP.L	(A3),D0
	BEQ.S	TROUVêMV13
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV13
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	BRA	CONT3
TROUVêMV13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
CONT3	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1_3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1_3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1_3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV3	MOVE.W	#$22CC,(A2)+
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV23	MOVE.W	#$32CC,(A2)+
	TST.W	4(A0)
	BEQ	MOV2

	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CMP.W	4(A0),D0
	BEQ	COMPARE5
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
APRES5COMP	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE5	CLR.W	ADD1
	SWAP	D0
	MOVE.W	4(A0),D0
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP5	CMP.L	(A3),D0
	BEQ.S	TROUVêC5
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP5
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
	BRA	APRES5COMP
TROUVêC5	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES5COMP

MOV2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV2	CMP.L	(A3),D0
	BEQ.S	TROUVêMV2
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV2
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE4
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMVD	CMP.L	(A3),D0
	BEQ.S	TROUVêMVD
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMVD
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMVD	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	
APRES4COMP	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE4	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHCOMP4	CMP.L	(A3),D0
	BEQ.S	TROUVêC4
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP4
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES4COMP
TROUVêC4	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES4COMP

NO_AFF	MOVE.W	#$5049,(A2)+	
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
FIN_AFF	ADDQ.L	#8,A0
	ADDQ.L	#2,A1
	RTS

PREDECALET	LEA	BUF_DEC,A1
	LEA	PREDEC_TAB,A6
	MOVE.W	#Y-1,D6
RECOP2	MOVE.W	#X-2,D7
RECOP11	MOVE.L	(A0)+,(A1)+
	MOVE.W	(A0)+,(A1)+
	CLR.W	(A1)+
	ADDQ.L	#2,A0
	DBRA	D7,RECOP11
	CLR.L	(A1)+
	CLR.L	(A1)+
	LEA	160-((X-1)*8)(A0),A0
	DBRA	D6,RECOP2

	LEA	BUF_DEC,A0
	MOVE.L	A0,(A6)+
	MOVE.W	#6,D3
DECPGEN	LEA	X*8*Y(A0),A1
	MOVE.L	A1,(A6)+
	MOVE.W	#(X*Y)-1,D7
RECOP3	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP3

	MOVE.W	#1,D4
DECPG1	MOVE.W	#Y-1,D5
DECP3	MOVE.W	#3,D6
DECP2	MOVE.W	#X-1,D7
DECP1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DECP1
	LEA	-((X*8)-2)(A0),A0
	DBRA	D6,DECP2
	LEA	(X-1)*8(A0),A0
	DBRA	D5,DECP3
	LEA	-(X*8*Y)(A0),A0
	DBRA	D4,DECPG1
	DBRA	D3,DECPGEN
	RTS

MAK_EFF	TST.W	FLAG_EFF
	BEQ	FLAGEFF_OFF
	MOVE.L	SCREEN2,A0	;MSK
	MOVE.L	SCREEN1,A1	;SPR
	MOVE.W	#Y-1,D6
RECOMEF2	MOVE.W	#X-1,D7
RECOMEF1	CMPI.W	#-1,(A0)
	BEQ	QQQ
	TST.L	(A1)
	BEQ	EFF3
	TST.L	2(A1)
	BEQ	EFF1
	TST.W	(A1)
	BEQ	EFF23
	TST.W	2(A1)
	BEQ	EFF13
	TST.W	4(A1)
	BEQ	EFF12
EFF_ALL	MOVE.W	#$20C0,(A2)+	;6 NOPS
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA.S	NO_EFF
QQQ	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_EFF
NO_EFF	ADDQ.L	#8,A1
	ADDQ.L	#2,A0
	DBRA	D7,RECOMEF1
	MOVE.W	#$41E8,(A2)+
	MOVE.W	#160-(X*8),(A2)+
	BSR	OPTI_ADDQ_EFF
	DBRA	D6,RECOMEF2
	MOVE.W	#$4E75,(A2)+
FLAGEFF_OFF	RTS

EFF3	MOVE.W	#$5848,(A2)+
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+	;4 NOPS
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF1	MOVE.W	#$30C0,(A2)+	;3 NOPS
	MOVE.W	#$5C48,(A2)+
	BRA	NO_EFF

EFF23	TST.W	4(A1)
	BEQ	EFF2
	MOVE.W	#$5448,(A2)+	;5 NOPS
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$20C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF
EFF2	MOVE.W	#$5448,(A2)+	;4 NOPS
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

EFF13	MOVE.W	#$30C0,(A2)+	;6 NOPS
	MOVE.W	#$5448,(A2)+
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF12	MOVE.W	#$20C0,(A2)+	;4 NOPS
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

OPTI_ADDQ_EFF
	MOVE.W	#$5448,D0
	MOVE.W	#$5848,D1
	MOVE.W	#$5C48,D2
	MOVE.W	#$5048,D3
	MOVE.W	#$41E8,D4
	CLR.W	ADD1
CONT_OPTEF	CMP.W	-2(A2),D0
	BNE.S	ADEF2
	ADDQ.W	#2,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF2	CMP.W	-2(A2),D1
	BNE.S	ADEF3
	ADDQ.W	#4,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF3	CMP.W	-2(A2),D2
	BNE.S	ADEF4
	ADDQ.W	#6,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF4	CMP.W	-2(A2),D3
	BNE.S	ADEF5
	ADDQ.W	#8,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF5	CMP.W	-4(A2),D4
	BNE.S	FIN_OPTEF
	MOVE.W	-2(A2),D0
	ADD.W	D0,ADD1
	MOVE.W	#$5448,D0
	SUBQ.L	#4,A2
	BRA	CONT_OPTEF
FIN_OPTEF	TST.W	ADD1
	BEQ	FINI_OPTEF
	CMPI.W	#8,ADD1
	BGT	MAK_LEAEF
	CMPI.W	#2,ADD1
	BNE.S	TESTEF2
	MOVE.W	#$5448,(A2)+
	BRA	FINI_OPTEF
TESTEF2	CMPI.W	#4,ADD1
	BNE.S	TESTEF3
	MOVE.W	#$5848,(A2)+
	BRA	FINI_OPTEF
TESTEF3	CMPI.W	#6,ADD1
	BNE.S	TESTEF4
	MOVE.W	#$5C48,(A2)+
	BRA	FINI_OPTEF
TESTEF4	MOVE.W	#$5048,(A2)+
	BRA	FINI_OPTEF
MAK_LEAEF	MOVE.W	#$41E8,(A2)+
	MOVE.W	ADD1,(A2)+
FINI_OPTEF	RTS

PREP_ECR	MOVE.L	#BUFFER,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADDI.L	#32000,D0
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS
	
	SECTION	DATA
PIC	INCBIN	DAN3.PI1

FIC_OPT	INCBIN	DAN2.OPT

	DS.L	100
COURB	INCBIN	BIGGIE4.CRB
FIN_CRB	DS.L	10000
	DC.W	-1

TABLE_SPR	DC.L	PIC+34	D
	DC.L	PIC+34+32	A
	DC.L	PIC+34+64	N
	DC.L	PIC+34+96	T
	DC.L	PIC+34+128	O

	SECTION	BSS
ANC_PAL	DS.L	8
ANC_VBL	DS.L	1
ANC_TIM	DS.L	1
SAUV_SP	DS.L	1
SAUVEC	DS.W	1
MFP	DS.B	8
	DS.B	256
BUFFER	DS.L	16000
	DS.B	256
SCREEN1	DS.L	1
SCREEN2	DS.L	1
PREDEC_TAB	DS.L	8
BUF_DEC	DS.L	(12*Y)*8
PNT_CRB	DS.L	1
VARI	DS.W	1
ADD1	DS.W	1
ANNEX	DS.L	1
FLAG_EFF	DS.W	1
TABLE_GEN	DS.L	4000
BUF_COD