DEBUT:	MOVEA.L  A7,A5
	LEA.L 	D_PILE,A7
	MOVE.L 	4(A5),A5
	MOVE.L 	$C(A5),D0
	ADD.L 	$14(A5),D0
	ADD.L 	$1C(A5),D0
	ADD.L 	#$100,D0		
	MOVE.L 	D0,-(SP)		
        MOVE.L 	A5,-(SP)
	MOVE 	#0,-(SP)
	MOVE 	#$4A,-(SP)
	TRAP 	#1
	LEA 	12(SP),SP
	
	CLR.L 	-(SP)
	MOVE 	#$20,-(SP)
	TRAP 	#1
	ADDQ.L 	#6,SP
	MOVE.L 	D0,SAUVE

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W



DEC_DIST	LEA	LOGO+34,A0
	LEA	BUF1DEC,A1
	LEA	TAB1DEC,A6
	MOVE.L	A1,(A6)+
	MOVE.W	#79,D6
RECOP2	MOVE.W	#11,D7
RECOP1	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP1
	LEA	112(A0),A0
	CLR.L	(A1)+
	CLR.L	(A1)+
	DBRA	D6,RECOP2
	MOVE.W	#14,D4
	LEA	BUF1DEC,A0
DECGEN	LEA	(56*80)(A0),A1
	MOVE.L	A1,(A6)+
	MOVE.W	#(14*80)-1,D7
RECOP3	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP3	
	MOVE.W	#79,D5
DEC3	MOVE.W	#3,D6
DEC2	MOVE.W	#6,D7
DEC1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DEC1
	LEA	-54(A0),A0
	DBRA	D6,DEC2
	LEA	48(A0),A0
	DBRA	D5,DEC3
	LEA	-(56*80)(A0),A0
	DBRA	D4,DECGEN
;	RTS


	LEA	PRECRB,A0
	LEA	DISTBUF1,A5
GO2	CLR.L	D2
	MOVE.B	(A5)+,D2

	CMPI.B	#-1,D2
	BNE.S	OK
	BRA.S	FINI
OK	SUBQ.B	#1,D2

	LEA	TAB1DEC,A2
CI	MOVE.L	(A2)+,D0
	DBF	D2,CI
	MOVE.L	D0,(A0)+

	BRA.S	GO2

			
FINI	

	LEA	DISTVAL1,A0
	LEA	EN_PLUS,A1
	MOVE.L	#79,D0
DO_IT	MOVE.B	(A0)+,(A1)+
	DBF	D0,DO_IT

	LEA	PRECRB,A0
	LEA	ENPLUS,A1
	MOVE.L	#79,D0
DO_IT_AGAIN
	MOVE.L	(A0)+,(A1)+
	DBF	D0,DO_IT_AGAIN



	MOVE.B	$FFFFFA07.W,MFP1
	MOVE.B	$FFFFFA09.W,MFP2
	MOVE.B	$FFFFFA0F.W,MFP3
	MOVE.B	$FFFFFA13.W,MFP4
	MOVE.B	$FFFFFA1B.W,MFP5
	MOVE.B	$FFFFFA21.W,MFP6
	
	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	
	MOVE	#4,-(SP)
	TRAP 	#14
	ADDQ.L	#2,SP
	MOVE	D0,RES
	
	MOVE	#2,-(SP)
	TRAP 	#14
	ADDQ.L 	#2,SP
	MOVE.L	D0,ANC_ECR
	
	CLR.W 	-(SP)
	MOVE.L	#$F8000,-(SP)
	MOVE.L	#$F8000,-(SP)
	MOVE 	#5,-(SP)
	TRAP 	#14
	LEA.L 	12(SP),SP


	LEA.L	$FFFF8240.W,A0
	MOVEM.L	(A0),D0-D7
	LEA.L	ANC_PAL,A0
	MOVEM.L	D0-D7,(A0)
	

	LEA	PRECRB,A5
	LEA	DISTVAL1,A6


        
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	#VBL_IR,$70.W
	MOVE.L	$120.W,ANC_TB
	MOVE.L	#TB0_IR,$120.W
	
	DC.W	$A00A
	MOVE.B	#$12,$FFFFFC02.W
	
	CLR.B	$FFFFFA1B.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W



BOUCLE	JMP	BOUCLE

FIN:	
	MOVE.B	#8,$FFFFFC02.W
	MOVE.B	MFP1,$FFFFFA07.W
	MOVE.B	MFP2,$FFFFFA09.W
	MOVE.B	MFP3,$FFFFFA0F.W
	MOVE.B	MFP4,$FFFFFA13.W
	MOVE.B	MFP5,$FFFFFA1B.W
	MOVE.B	MFP6,$FFFFFA21.W
	
	MOVE.L	ANC_VBL,$70.W
	MOVE.L	ANC_TB,$120.W
	
	LEA.L	ANC_PAL,A0
	MOVEM.L	(A0),D0-D7
	LEA.L	$FFFF8240.W,A0
	MOVEM.L	D0-D7,(A0)
	
	MOVE 	RES,-(SP)	
	MOVE.L	ANC_ECR,-(SP)	
	MOVE.L	ANC_ECR,-(SP)	
	MOVE 	#5,-(SP)	
	TRAP 	#14		
	LEA.L 	12(SP),SP	
	
	MOVE.L	SAUVE,-(SP)	
	MOVE 	#$20,-(SP)	
	TRAP 	#1		
	ADDQ.L 	#6,SP		
	
;	PEA	CHUT_DA	   	
;	MOVE	#$20,-(A7) 	
;	TRAP	#14        	
;	ADDQ.L	#6,A7      	

	CLR.W 	-(SP)		
	TRAP	#1		
	

VBL_IR	
	CLR.B	$FFFFFA1B.W
;	MOVE.B	#1,$FFFFFA21.W
;	MOVE.B	#8,$FFFFFA1B.W

	MOVEM.L	LOGO+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ST	$FFFF8240.W
	CLR.L	D3
	
	
	CMPI.B	#-1,81(A6)
	BNE.S	GO
	
	LEA	PRECRB,A5
	LEA	DISTVAL1,A6
	
GO	MOVE.L	(A5)+,A0
	MOVE.B	(A6)+,D3

	LEA	$F8000,A1
	ADD.L	D3,A1


	MOVEM.L	A5-A6,SAVEA

N	SET	0
N2	SET	0
	REPT	80
	MOVEM.L	N2(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVE.L	13*4+N2(A0),N+13*4(A1)
N	SET	N+160
N2	SET	N2+(14*4)
	ENDR
	
	MOVEM.L	SAVEA,A5-A6

	SF	$FFFF8240.W	

	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE


 


TB0_IR	
	CLR.B	$FFFFFA1B.W
	MOVE.B	#1,$FFFFFA21.W
	MOVE.B	#8,$FFFFFA1B.W
;	MOVE.L	#TB0_IR,$120
	BCLR	#0,$FFFFFA0F.W
	RTE			







	 
	section   data


DISTBUF1
	INCLUDE	DISTBUF1.S
	DC.B	-1
	EVEN
DISTVAL1
	INCLUDE	DISTVAL1.S
EN_PLUS	DCB.B	80,0
	DC.B	-1
	

LOGO	INCBIN	LOG96*80.PI1
	EVEN

 	SECTION BSS
 	
F_PILE	DS.L 	128	
D_PILE	DS.L 	1	
SAUVE	DS.L	1	
ANC_VBL DS.L	1	
ANC_TB	DS.L	1	
ANC_ECR	DS.L	1	
RES	DS.W	1	
ANC_PAL	DS.W	16
MFP1	DS.B	1
MFP2	DS.B	1
MFP3	DS.B	1
MFP4	DS.B	1
MFP5	DS.B	1
MFP6	DS.B	1
SAVEA	DS.L	2
SAVECOL	DS.L	8	
TAB1DEC	DS.L	16
BUF1DEC	DS.L	((12+2)*80)*16
PRECRB	DS.L	630
ENPLUS	DS.L	80