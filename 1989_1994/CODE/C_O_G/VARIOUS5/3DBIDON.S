	PEA	0.W
	move.w	#$20,-(sp)
	trap	#1
	addq.l	#6,sp

	CLR	-(SP)
	PEA	-1.W
	PEA	-1.W
	move.w	#5,-(sp)
	trap	#14
	lea.l	12(sp),sp

	MOVEQ	#0,D0
	LEA	BUFCOD,A0
	LEA	TABLE,A1
	MOVE	#118,D1
	MOVE.L	A0,(A1)+
LM	MOVE	(A0)+,D0
	CMPI	#$4E75,D0
	BNE.S	LM
	MOVE.L	A0,(A1)+
	DBF	D1,LM
	JSR	SET_SCR
	MOVE	#$777,$FFFF8242.W
	MOVE	#$777,$FFFF8250.W
	
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	JSR	EFF

	MOVE.L	SCREEN2,A0
	LEA	TABLE,A1
	MOVE.L	(A1),A1
	MOVEM.L	(A1),D0-D7
	JSR	8*4(A1)
	
	LEA	TABLE+4,A1
	
H	;DCB	6000,$4E71
	MOVEM.L	D0-A6,-(SP)
	MOVE.L	SCREEN2,A1	*
	lea	160*90(a1),a1
	MOVE.L	SCREEN1,A0	*
	ADDA.L	PNT_PLAN,A0
	
	ADDQ.L	#2,PNT_PLAN
	CMPI.L	#8,PNT_PLAN
	BNE.S	KJH
	CLR.L	PNT_PLAN
KJH
	LEA	COLORS,A2
	MOVE.L	PNT_PLAN,D0
	LSL	#4,D0
	ADDA.L	D0,A2
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

N	SET	0
N2	SET	0
	MOVE	#19,D0
KOP	MOVE	N+6(A1),N2(A0)
	MOVE	N+8(A1),N2+8(A0)

	MOVE	N+6+16(A1),N2+16(A0)
	MOVE	N+8+16(A1),N2+8+16(A0)

	MOVE	N+6+32(A1),N2+32(A0)
	MOVE	N+8+32(A1),N2+8+32(A0)

	MOVE	N+6+48(A1),N2+48(A0)
	MOVE	N+8+48(A1),N2+8+48(A0)

	MOVE	N+6+64(A1),N2+64(A0)
	MOVE	N+8+64(A1),N2+8+64(A0)

	MOVE	N+6+80(A1),N2+80(A0)
	MOVE	N+8+80(A1),N2+8+80(A0)

	MOVE	N+6+96(A1),N2+96(A0)
	MOVE	N+8+96(A1),N2+8+96(A0)

	MOVE	N+6+112(A1),N2+112(A0)
	MOVE	N+8+112(A1),N2+8+112(A0)

	MOVE	N+6+128(A1),N2+128(A0)
	MOVE	N+8+128(A1),N2+8+128(A0)

	MOVE	N+6+144(A1),N2+144(A0)
	MOVE	N+8+144(A1),N2+8+144(A0)
	
;N	SET	N+160
;N2	SET	N2+160
	LEA	160(A0),A0
	LEA	160(A1),A1
	DBF	D0,KOP

	MOVEM.L	(SP)+,D0-A6
	
	MOVE.L	SCREEN2,A0
	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	NO_TIM
	ST	$FFFF8240.W
NO_TIM	
 
	MOVE.L	(A1)+,A2
	CMPI.L	#0,-4(A1)
	BNE.S	ROUL
	LEA	TABLE+4,A1
	MOVE.L	(A1)+,A2
ROUL	MOVEM.L	(A2),D0-D7
	JSR	8*4(A2)
	SF	$FFFF8240.W
	
KK
	MOVE.L	$466.W,D1
MLMLA	CMP.L	$466,D1
	BEQ.S	MLMLA

	CMPI.B	#$39,$FFFFFC02.W
	BEQ.S	FIN
	BRA	H
PNT_PLAN	DS.L	1

FIN
	PEA	0.W
	TRAP	#1

EFF	move.l	SCREEN1,a0
	MOVE	#7999,D0
HA	CLR.L	(A0)+
	DBF	D0,HA
	RTS	

SET_SCR:	move.l	#BUFFERSCR,d0	
	and.l	#$ffffff00,d0		
	move.l	d0,SCREEN1
	add.l	#32000,d0		
	move.l	d0,SCREEN2
	rts				
	DATA
BUFCOD	INCBIN	DATAS
COLORS
;0000
;0001
;0010
;0011
;0100
;0101
;0110
;0111
;1000
;1001
;1010
;1011
;1100
;1101
;1110
;1111

 DC $0,$111,$777,$777,$555,$777,$777,$777,$333,$777,$777,$777,$777
 DCB 3,$777

 DC $0,$333,$111,$777,$777,$777,$777,$777,$555
 DCB 7,$777

 DC $0,$555,$333,$777,$111,$777,$777,$777,$777
 DCB 7,$777

 DC $0,$777,$555,$777,$333,$777,$777,$777,$111
 DCB 7,$777

	BSS

SCREEN2	DS.L	1
SCREEN1	DS.L	1
	
	DS.B	256
BUFFERSCR	DS.B	64000
TABLE	DS.L	360
