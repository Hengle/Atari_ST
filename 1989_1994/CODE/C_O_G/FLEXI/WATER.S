	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	CLR	-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE	#5,-(SP)
	TRAP	#14
	ADDA.L	#12,SP

	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,SAVE_PAL
	CLR.L	$FFFF8240.W
	
	MOVE.L	$70.W,ANC_VBL
	CLR.L	PNT_W3
	MOVE.L	#VBL,$70.W
J	JMP	J
VBL
	MOVEA.L	$44E.W,A0
	LEA	160*50(A0),A0
	LEA	WATER+34,A1
	ADDA.L	PNT_W3,A1
	MOVE	#38,D0
AFF_C	MOVE	#39,D1
AFF_L	MOVE.L	(A1)+,(A0)+
	DBF	D1,AFF_L
	DBF	D0,AFF_C
	LEA	PAL_WATER,A0
	ADDA.L	PNT_W,A0
	CMPI.L	#-1,(A0)
	BEQ.S	OK
	MOVE	(A0),$FFFF8242.W
	ADDQ.L	#1,PNT_W2
	CMPI.L	#2,PNT_W2
	BNE.S	OK2
	CLR.L	PNT_W2
	ADDQ.L	#2,PNT_W
	BRA.S	OK2
OK	CMPI.L	#160*39*3,PNT_W3
	BEQ.S	OK2
	ADD.L	#160*39,PNT_W3
	CLR.L	PNT_W
	CLR.L	PNT_W2
OK2	CMPI.B	#$39,$FFFFFC02.W
	BEQ.S	FIN
	RTE
	
FIN	MOVE.L	ANC_VBL,$70.W
	MOVEM.L	SAVE_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	CLR.L	-(SP)
	TRAP	#1
	DATA
PAL_WATER
	DC	$000
	DC	$111
	DC	$222
	DC	$333
	DC	$444
	DC	$555
	DC	$666
	DC	$777
	DC	$777
	DC	$777
	DC	$777
	DC	$777
	DC	$777
	DC	$666
	DC	$555
	DC	$444
	DC	$333
	DC	$222
	DC	$111
	DC	$000
	
	DC.L	-1
WATER	INCBIN	WATER2.PI1
	BSS
SAVE_PAL	DS.L	8
ANC_VBL	DS.L	1
PNT_W	DS.L	1
PNT_W2	DS.L	1
PNT_W3	DS.L	1
