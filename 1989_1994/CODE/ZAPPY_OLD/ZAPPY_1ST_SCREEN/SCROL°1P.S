IERA	EQU	$FFFA07		
IERB	EQU	$FFFA09		
ISRA	EQU	$FFFA0F		
IMRA	EQU	$FFFA13		
TBCR	EQU	$FFFA1B		
TBDR	EQU	$FFFA21		
SYNCRO	EQU	$FF820A		
COUL_0	EQU	$FF8240
COUL_1	EQU	$FF8242		
COUL_2	EQU	$FF8244		
COUL_3	EQU	$FF8246
COUL_4	EQU	$FF8248
COUL_5	EQU	$FF824A
COUL_6	EQU	$FF824C
COUL_7	EQU	$FF824E
COUL_8	EQU	$FF8250
COUL_9	EQU	$FF8252
COUL_10	EQU	$FF8254
COUL_11	EQU	$FF8256
COUL_12	EQU	$FF8258
COUL_13	EQU	$FF825A
COUL_14	EQU	$FF825C
COUL_15	EQU	$FF825E
ACIA	EQU	$FFFC02		
PSG	EQU	$FF8800	        


 	SECTION TEXT
DEBUT:	MOVE.L  A7,A5
	LEA.L 	D_PILE,A7
	MOVE.L 	4(A5),A5
	MOVE.L 	$C(A5),D0
	ADD.L 	$14(A5),D0
	ADD.L 	$1C(A5),D0
	ADD.L 	#$100,D0	
	MOVE.L 	D0,-(SP)	
        MOVE.L 	A5,-(SP)
	MOVE.W 	#0,-(SP)
	MOVE.W 	#$4A,-(SP)
	TRAP 	#1
	LEA 	12(SP),SP
	
	CLR.L 	-(SP)		
	MOVE.W 	#$20,-(SP)	
	TRAP 	#1		
	ADDQ.L 	#6,SP			
	MOVE.L 	D0,SAUVE		
			
	MOVE.B	IERA,MFP1		
	MOVE.B	IERB,MFP2		
	MOVE.B	ISRA,MFP3		
	MOVE.B	IMRA,MFP4		
	MOVE.B	TBCR,MFP5		
	MOVE.B	TBDR,MFP6		
	
	CLR.B	IERA			
	CLR.B	IERB			
	

	MOVE.L	#BUFFER,D0		
	ANDI.L	#$FFFFFF00,D0		
	ADD.L	#512,D0			
	MOVE.L	D0,ECRAN		
	
	MOVE.W	#4,-(SP)		
	TRAP 	#14			
	ADDQ.L	#2,SP			
	MOVE.W	D0,RES			
	
	MOVE.W	#2,-(SP)		
	TRAP 	#14			
	ADDQ.L 	#2,SP			
	MOVE.L	D0,ANC_ECR		
	
	MOVE.W 	#0,-(SP)		
	MOVE.L	ECRAN,-(SP)		
	MOVE.L	ECRAN,-(SP)		
	MOVE.W 	#5,-(SP)		
	TRAP 	#14			
	LEA.L 	12(SP),SP		

	
	LEA.L	COUL_0,A0		
	MOVEM.L	(A0),D0-D7		
	LEA.L	ANC_PAL,A0		
	MOVEM.L	D0-D7,(A0)		
	
	MOVE.L #MES_F,MES_PNT		
	MOVE.B	#4,NB_BIT		
	
	
	MOVE.L	$70,ANC_VBL		
	MOVE.L	#VBL_IR,$70		
	MOVE.L	$120,ANC_TB		
	MOVE.L	#TB0_IR,$120		
	
	DC.W	$A00A			
	MOVE.B	#$12,ACIA		
	
	CLR.B	TBCR			
	BSET	#0,IERA			
	BSET	#0,IMRA			

BOUCLE:	
	MOVE.B	VSYNC,D0		
WAIT	CMP.B	VSYNC,D0		
	BEQ.S	WAIT			
	CMP.B	#$39,ACIA		
	BNE.S	BOUCLE			
***********************************************************************

FIN:	
	MOVE.B	#8,ACIA			
	MOVE.B	MFP1,IERA		
	MOVE.B	MFP2,IERB		
	MOVE.B	MFP3,ISRA		
	MOVE.B	MFP4,IMRA		
	MOVE.B	MFP5,TBCR		
	MOVE.B	MFP6,TBDR		
	
	MOVE.L	ANC_VBL,$70		
	MOVE.L	ANC_TB,$120		
	
	LEA.L	ANC_PAL,A0		
	MOVEM.L	(A0),D0-D7		
	LEA.L	COUL_0,A0		
	MOVEM.L	D0-D7,(A0)		
	
	MOVE.W 	RES,-(SP)		
	MOVE.L	ANC_ECR,-(SP)		
	MOVE.L	ANC_ECR,-(SP)		
	MOVE.W 	#5,-(SP)		
	TRAP 	#14			
	LEA.L 	12(SP),SP		
	
	MOVE.L	SAUVE,-(SP)		
	MOVE.W 	#$20,-(SP)		
	TRAP 	#1			
	ADDQ.L 	#6,SP			
	
	PEA	CHUT_DA	   		
	MOVE.W	#$20,-(A7) 		
	TRAP	#14        		
	ADDQ.L	#6,A7      		

	CLR.W 	-(SP)			
	TRAP	#1			
	



VBL_IR	
	MOVEM.L	D0,-(SP)		
	CLR.B	TBCR			
	MOVE.B	#117,TBDR		
	MOVE.B	#8,TBCR			
	LEA.L	COUL_0,A6		
	LEA.L	PAL1,A5			
     REPT 8
     	MOVE.L	(A5)+,(A6)+		
     ENDR

VBL7	CMP.W	#1,POIROT1		
	BEQ.S	VBL4			
	ADDQ.W	#1,POIROT1		
	BRA.S	VBL3			
VBL4	BSR	SCR_TXT			
VBL3	MOVEM.L	(SP)+,D0		
	NOT.B	VSYNC			
	RTE				

******************************

TB0_IR	
	LEA.L	COUL_0,A6		
	LEA.L	PAL2,A5			
     REPT 8
     	MOVE.L	(A5)+,(A6)+		
     ENDR
	CLR.B	TBCR			
	MOVE.B	#74,TBDR		
	MOVE.B	#8,TBCR			
	MOVE.L	#TB1_IR,$120		
	BCLR	#0,ISRA			
	RTE				

TB1_IR	
	LEA.L	COUL_0,A6		
	LEA.L	PAL3,A5			
     REPT 8
     	MOVE.L	(A5)+,(A6)+		
     ENDR
	CLR.B	TBCR			
	MOVE.B	#8,TBDR			
	MOVE.B	#8,TBCR			
	MOVE.L	#TB2_IR,$120		
	BCLR	#0,ISRA			
	RTE				
TB2_IR
     REPT 127
	NOP				
     ENDR
	MOVE.B	#0,SYNCRO		
     REPT 8
     	NOP				
     ENDR
	MOVE.B	#2,SYNCRO		
	CLR.B	TBCR			
	MOVE.L	#TB0_IR,$120		
	BCLR	#0,ISRA			
	RTE				

SCR_TXT	MOVEQ	#32,D0			
	MOVE.L	#160,D1			
	LEA.L	CAR_BUF,A5		
	MOVE.L	ECRAN,A4		
	ADDA.L	#160*100,A4		

DECAL:
        MOVE.B	5(A4),4(A4)		
	MOVE.B	12(A4),5(A4)
	MOVE.B	13(A4),12(A4)
	MOVE.B	20(A4),13(A4)
	MOVE.B	21(A4),20(A4)
	MOVE.B	28(A4),21(A4)
	MOVE.B	29(A4),28(A4)
	MOVE.B	36(A4),29(A4)
	MOVE.B	37(A4),36(A4)
	MOVE.B	44(A4),37(A4)
	MOVE.B	45(A4),44(A4)
	MOVE.B	52(A4),45(A4)
	MOVE.B	53(A4),52(A4)
	MOVE.B	60(A4),53(A4)
	MOVE.B	61(A4),60(A4)
	MOVE.B	68(A4),61(A4)
	MOVE.B	69(A4),68(A4)
	MOVE.B	76(A4),69(A4)	
	MOVE.B	77(A4),76(A4)
	MOVE.B	84(A4),77(A4)
	MOVE.B	85(A4),84(A4)
	MOVE.B	92(A4),85(A4)
	MOVE.B	93(A4),92(A4)
	MOVE.B	100(A4),93(A4)
	MOVE.B	101(A4),100(A4)
	MOVE.B	108(A4),101(A4)
	MOVE.B	109(A4),108(A4)
	MOVE.B	116(A4),109(A4)
	MOVE.B	117(A4),116(A4)
	MOVE.B	124(A4),117(A4)
	MOVE.B	125(A4),124(A4)
	MOVE.B	132(A4),125(A4)
	MOVE.B	133(A4),132(A4)
	MOVE.B	140(A4),133(A4)
	MOVE.B	141(A4),140(A4)
	MOVE.B	148(A4),141(A4)
	MOVE.B	149(A4),148(A4)
	MOVE.B	156(A4),149(A4)
	MOVE.B	157(A4),156(A4)
	MOVE.B	4(A5),157(A4)	
	MOVE.B	1(A5),(A5)		
	MOVE.B	6(A5),1(A5)		
	MOVE.B	7(A5),6(A5)			



	ADDA.L	#12,A5
	ADDA.L D1,A4			
	DBF D0,DECAL			
	SUBQ.B #1,NB_BIT		
	BEQ.S NEXTCHAR			
	RTS				

NEXTCHAR:
	MOVE.B	#4,NB_BIT		
	MOVEQ	#0,D0			
	MOVE.L	MES_PNT,A0		
	MOVE.B	(A0)+,D0		
	CMPI.B	#-1,D0			
	BEQ	 AGAIN			
	MOVE.L	A0,MES_PNT		
	CMPI.B	#-2,D0			
	BEQ	SPACE			
	CMPI.B	#39,D0			
	BGT	LINE5			
	CMPI.B	#29,D0			
	BGT.S	LINE4			
	CMPI.B	#19,D0			
	BGT.S	LINE3			
	CMPI.B	#9,D0			
	BGT.S	LINE2			
LINE1:	LSL.L	#4,D0			
	LEA.L	FONTES,A1		
	ADDA.L	#34,A1			
	ADDA.L	D0,A1			
	MOVE.L	A1,CAR_ADR		
	BSR	LOAD_C			
	RTS				
LINE2:	SUB.B	#10,D0			
	LSL.L	#4,D0			
	LEA.L	FONTES,A1		
	ADDA.L	#34,A1			
	ADDA.L	#160*33,A1		
	ADDA.L	D0,A1			
	MOVE.L	A1,CAR_ADR		
	BSR	LOAD_C			
	RTS				
LINE3:	SUB.B	#20,D0			
	LSL.L	#4,D0			
	LEA.L	FONTES,A1		
	ADDA.L	#34,A1			
	ADDA.L	#160*66,A1		
	ADDA.L	D0,A1			
	MOVE.L	A1,CAR_ADR		
	BSR	LOAD_C			
	RTS				
LINE4:	SUB.B	#30,D0			
	LSL.L	#4,D0			
	LEA.L	FONTES,A1		
	ADDA.L	#34,A1			
	ADDA.L	#160*99,A1		
	ADDA.L	D0,A1			
	MOVE.L	A1,CAR_ADR		
	BSR	LOAD_C			
	RTS				
LINE5:	SUB.B	#40,D0			
	LSL.L	#4,D0			
	LEA.L	FONTES,A1		
	ADDA.L	#34,A1			
	ADDA.L	#160*132,A1		
	ADDA.L	D0,A1			
	MOVE.L	A1,CAR_ADR		
	BSR	LOAD_C			
	RTS				

SPACE	LEA	CAR_BUF,A0		
     REPT 99				
	CLR.L	(A0)+			
     ENDR				
	RTS				

AGAIN	MOVE.L	#MES_F,MES_PNT		
	BRA	NEXTCHAR	        

LOAD_C	MOVE.L	CAR_ADR,A0		
	LEA	CAR_BUF,A1	        
	MOVE.L	#160,D0			
     REPT  33				
	MOVE.L	(A0),(A1)+		
	MOVE.W	4(A0),(A1)+		
	MOVE.L	8(A0),(A1)+		
	MOVE.W	12(A0),(A1)+		
	ADDA.L	D0,A0			
     ENDR				
	RTS				


	SECTION DATA
	EVEN

NEW_PAL	DC.W	$233,$233,$300,$700,$210,$320,$122,$122
	DC.W	$202,$707,$344,$344,$320,$540,$000,$777

MES_F	DC.B  -2,-2
	DC.B	0,1,2,3,4,5,6,7,8,9
	DC.B	10,11,12,13,14,15,16,17,18,19
	DC.B	20,21,22,23,24,25,26,27,28,29
	DC.B	30,31,32,33,34,35,36,37,38,39
	DC.B	40,41,42,43,44,45,46,47,48,49
	DC.B	-2,-2
	DC.B  -1
	EVEN

FONTES	INCBIN	"GOODFNT.PI1"
	EVEN

PAL3	DC.W	$002,$530,$777,$655,$433,$554,$443,$640
	DC.W	$232,$750,$760,$770,$220,$110,$211,$000
	EVEN

PAL2	DC.W	$002,$777,$700,$655,$433,$554,$443,$640
	DC.W	$232,$750,$760,$770,$220,$110,$211,$000
	EVEN
PAL1	DC.W	$002,$530,$777,$655,$433,$554,$443,$640
	DC.W	$232,$750,$760,$770,$220,$110,$211,$000
	EVEN
CHUT_DA	DC.B	7,$FF,6,0,8,0,9,0,$A,0

 	SECTION BSS
 	EVEN
F_PILE	DS.L 	128		
D_PILE	DS.L 	1			
ECRAN	DS.L 	1			
SAUVE	DS.L	1			
ANC_VBL DS.L	1			
ANC_TB	DS.L	1			
ANC_ECR	DS.L	1			
CAR_BUF	DS.L	99			
MES_PNT	DS.L	1			
CAR_ADR	DS.L	1			
POIROT1	DS.W	1			
POIROT2	DS.W	1			
POIROT3	DS.W	1			
POIROT4	DS.W	1			
RES	DS.W	1			
ANC_PAL	DS.W	16			
MFP1	DS.B	1			
MFP2	DS.B	1			
MFP3	DS.B	1			
MFP4	DS.B	1			
MFP5	DS.B	1			
MFP6	DS.B	1			
BUFFER	DS.B	45000			
VSYNC	DS.B	1			
NB_BIT	DS.B	1			
N_SPR	DS.B	1			

