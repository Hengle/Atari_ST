																
IERA	EQU	$FFFA07
IERB	EQU	$FFFA09
ISRA	EQU	$FFFA0F
IMRA	EQU	$FFFA13
TBCR	EQU	$FFFA1B
TBDR	EQU	$FFFA21
SYNCRO	EQU	$FF820A
COUL_0	EQU	$FF8240
COUL_1	EQU	$FF8242
COUL_2	EQU	$FF8244
COUL_3	EQU	$FF8246
COUL_4	EQU	$FF8248
COUL_5	EQU	$FF824A
COUL_6	EQU	$FF824C
COUL_7	EQU	$FF824E
COUL_8	EQU	$FF8250
COUL_9	EQU	$FF8252
COUL_10	EQU	$FF8254
COUL_11	EQU	$FF8256
COUL_12	EQU	$FF8258
COUL_13	EQU	$FF825A
COUL_14	EQU	$FF825C
COUL_15	EQU	$FF825E
ACIA	EQU	$FFFC02
PSG	EQU	$FF8800


 	SECTION TEXT
DEBUT:	MOVE.L  A7,A5
	LEA.L 	D_PILE,A7
	MOVE.L 	4(A5),A5
	MOVE.L 	$C(A5),D0
	ADD.L 	$14(A5),D0
	ADD.L 	$1C(A5),D0
	ADD.L 	#$100,D0		
	MOVE.L 	D0,-(SP)		
        MOVE.L 	A5,-(SP)
	MOVE.W 	#0,-(SP)
	MOVE.W 	#$4A,-(SP)
	TRAP 	#1
	LEA 	12(SP),SP
	
	CLR.L 	-(SP)			
	MOVE.W 	#$20,-(SP)		
	TRAP 	#1			
	ADDQ.L 	#6,SP			
	MOVE.L 	D0,SAUVE		


	MOVEA.L	#SPRITE+34,A0
	LEA.L	BUFFER,A1
	MOVE.L	#65,D1
COP	MOVE.L  #$7,D0
COPY	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY
	LEA.L	128(A0),A0
	DBF 	D1,COP


	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#24,A0
	LEA.L	BUFFER2,A1
	MOVE.L	#65,D1
COP2	MOVE.L  #$7,D0
COPY2	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY2
	LEA.L	128(A0),A0
	DBF 	D1,COP2


	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#48,A0
	LEA.L	BUFFER3,A1
	MOVE.L	#65,D1
COP3	MOVE.L  #$7,D0
COPY3	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY3
	LEA.L	128(A0),A0
	DBF 	D1,COP3

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#72,A0
	LEA.L	BUFFER4,A1
	MOVE.L	#65,D1
COP4	MOVE.L  #$7,D0
COPY4	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY4
	LEA.L	128(A0),A0
	DBF 	D1,COP4

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#96,A0
	LEA.L	BUFFER5,A1
	MOVE.L	#65,D1
COP5	MOVE.L  #$7,D0
COPY5	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY5
	LEA.L	128(A0),A0
	DBF 	D1,COP5

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#120,A0
	LEA.L	BUFFER6,A1
	MOVE.L	#65,D1
COP6	MOVE.L  #$7,D0
COPY6	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY6
	LEA.L	128(A0),A0
	DBF 	D1,COP6

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	LEA.L	BUFFER7,A1
	MOVE.L	#65,D1
COP7	MOVE.L  #$7,D0
COPY7	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY7
	LEA.L	128(A0),A0
	DBF 	D1,COP7

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	ADDA.L	#24,A0
	LEA.L	BUFFER8,A1
	MOVE.L	#65,D1
COP8	MOVE.L  #$7,D0
COPY8	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY8
	LEA.L	128(A0),A0
	DBF 	D1,COP8

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	ADDA.L	#48,A0
	LEA.L	BUFFER9,A1
	MOVE.L	#65,D1
COP9	MOVE.L  #$7,D0
COPY9	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY9
	LEA.L	128(A0),A0
	DBF 	D1,COP9

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	ADDA.L	#72,A0
	LEA.L	BUFFER10,A1
	MOVE.L	#65,D1
COP10	MOVE.L  #$7,D0
COPY10	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY10
	LEA.L	128(A0),A0
	DBF 	D1,COP10

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	ADDA.L	#96,A0
	LEA.L	BUFFER11,A1
	MOVE.L	#65,D1
COP11	MOVE.L  #$7,D0
COPY11	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY11
	LEA.L	128(A0),A0
	DBF 	D1,COP11

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*66,A0
	ADDA.L	#120,A0
	LEA.L	BUFFER12,A1
	MOVE.L	#65,D1
COP12	MOVE.L  #$7,D0
COPY12	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY12
	LEA.L	128(A0),A0
	DBF 	D1,COP12

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*(66*2),A0
	LEA.L	BUFFER13,A1
	MOVE.L	#65,D1
COP13	MOVE.L  #$7,D0
COPY13	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY13
	LEA.L	128(A0),A0
	DBF 	D1,COP13

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*(66*2),A0
	ADDA.L	#24,A0
	LEA.L	BUFFER14,A1
	MOVE.L	#65,D1
COP14	MOVE.L  #$7,D0
COPY14	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY14
	LEA.L	128(A0),A0
	DBF 	D1,COP14

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*(66*2),A0
	ADDA.L	#48,A0
	LEA.L	BUFFER15,A1
	MOVE.L	#65,D1
COP15	MOVE.L  #$7,D0
COPY15	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY15
	LEA.L	128(A0),A0
	DBF 	D1,COP15

	MOVEA.L	#SPRITE+34,A0
	ADDA.L	#160*(66*2),A0
	ADDA.L	#72,A0
	LEA.L	BUFFER16,A1
	MOVE.L	#65,D1
COP16	MOVE.L  #$7,D0
COPY16	MOVE.L  (A0)+,(A1)+
	DBF	D0,COPY16
	LEA.L	128(A0),A0
	DBF 	D1,COP16






        LEA   BUFFER,A0
        LEA   MASQ,A1
        MOVE.L  #263,D7
QS1     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS1

        LEA   BUFFER2,A0
        LEA   MASQ2,A1
        MOVE.L  #263,D7
QS2     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS2

        LEA   BUFFER3,A0
        LEA   MASQ3,A1
        MOVE.L  #263,D7
QS3     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS3

        LEA   BUFFER4,A0
        LEA   MASQ4,A1
        MOVE.L  #263,D7
QS4     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS4


        LEA   BUFFER5,A0
        LEA   MASQ5,A1
        MOVE.L  #263,D7
QS5     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS5


        LEA   BUFFER6,A0
        LEA   MASQ6,A1
        MOVE.L  #263,D7
QS6     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS6


        LEA   BUFFER7,A0
        LEA   MASQ7,A1
        MOVE.L  #263,D7
QS7     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS7

        LEA   BUFFER8,A0
        LEA   MASQ8,A1
        MOVE.L  #263,D7
QS8     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS8

        LEA   BUFFER9,A0
        LEA   MASQ9,A1
        MOVE.L  #263,D7
QS9     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS9

        LEA   BUFFER10,A0
        LEA   MASQ10,A1
        MOVE.L  #263,D7
QS10     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS10

        LEA   BUFFER11,A0
        LEA   MASQ11,A1
        MOVE.L  #263,D7
QS11     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS11

        LEA   BUFFER12,A0
        LEA   MASQ12,A1
        MOVE.L  #263,D7
QS12     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS12

        LEA   BUFFER13,A0
        LEA   MASQ13,A1
        MOVE.L  #263,D7
QS13     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS13

        LEA   BUFFER14,A0
        LEA   MASQ14,A1
        MOVE.L  #263,D7
QS14     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS14

        LEA   BUFFER15,A0
        LEA   MASQ15,A1
        MOVE.L  #263,D7
QS15     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS15

        LEA   BUFFER16,A0
        LEA   MASQ16,A1
        MOVE.L  #263,D7
QS16     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
        DBF D7,QS16








        LEA   MASQ,A1 
        MOVE.L  #8975,D7       * 528*16=1184
QSS     NOT.L  (A1)+
        DBF D7,QSS

	MOVE.B	IERA,MFP1		
	MOVE.B	IERB,MFP2		
	MOVE.B	ISRA,MFP3		
	MOVE.B	IMRA,MFP4		
	MOVE.B	TBCR,MFP5		
	MOVE.B	TBDR,MFP6		
	
	CLR.B	IERA	   * SUPPRIME INTERRUPTIONS
	CLR.B	IERB			
	

;	MOVE.L	#BUFFERL,D0		* ADRESSE DU BUFFER POUR ECRAN
;	ANDI.L	#$FFFFFF00,D0		* SUPRIME LES 8 BITS "FAIBLE"
;	ADD.L	#512,D0			* ET FAIT MULTIPLE DE 256
;	MOVE.L	D0,ADRLOGO		* ON SAUVE L'ADRESSE CALCULEE
	
	MOVE.W	#4,-(SP)		* APPEL FONCTION GETREZ
	TRAP 	#14			* XBIOS...
	ADDQ.L	#2,SP			*
	MOVE.W	D0,RES			* SAUVE LA RESOLUTION
	
	MOVE.W	#2,-(SP)		* APPEL FONCTION PHYSBASE
	TRAP 	#14			* XBIOS
	ADDQ.L 	#2,SP			*
	MOVE.L	D0,ANC_ECR		* SAUVE L'ADRESSE ECRAN
	
	MOVE.W 	#0,-(SP)		* BASSE RESOLUTION
	MOVE.L	#-1,-(SP)		* PHYSBASE A ECRAN
	MOVE.L	#-1,-(SP)		* LOGBASE A ECRAN
	MOVE.W 	#5,-(SP)		* FONCTION SETSCREEN
	TRAP 	#14			* DU XBIOS
	LEA.L 	12(SP),SP		*

	LEA.L	COUL_0,A0		* ADRESSE PALETTE SHIFTER
	MOVEM.L	(A0),D0-D7		* RECUPERE LES 16 REGISTRES
	LEA.L	ANC_PAL,A0		* ADRESSE DE SAUVEGARDE
	MOVEM.L	D0-D7,(A0)		* SAUVE LES 16 REGISTRES
	
        
;        move.l ADRFONT,a3
;        lea  FONT+34,a5
;        JSR  decomp
			
	MOVE.L	#MES_F,MES_PNT
        ;MOVE.L #MES_F2,MES_PNT2

        MOVE.W  #0,POIROT1
	MOVE.W  #0,POIROT2
        MOVE.W  #0,POIROT3

;	MOVEQ	#5,D0			* NETOIE D0
;	BSR	MUSIC		* INITIALISE LA MUSIQUE
;	MOVE.W  #5,MUS
	
	bsr	SET_SCR		;preparation des ecrans
;        move.l SCREEN1,a3
;        lea  LOGO+34,a5
;        JSR  decomp
;        move.l SCREEN2,a3
;        lea  LOGO+34,a5
;        JSR  decomp

        MOVEA.L SCREEN1,A0
        MOVEA.L #FOND+34,A1
        MOVE.L  #7999,D0
S1       MOVE.L  (A1)+,(A0)+
        DBF D0,S1


        MOVEA.L SCREEN2,A0
        MOVEA.L #FOND+34,A1
        MOVE.L  #7999,D0
S2       MOVE.L  (A1)+,(A0)+
        DBF D0,S2

        MOVEA.L SCREEN3,A0
        MOVEA.L #FOND+34,A1
        MOVE.L  #7999,D0
S3       MOVE.L  (A1)+,(A0)+
        DBF D0,S3


	MOVEA.L SCREEN1,A0
        LEA.L  SAVEFD,A1
        MOVE.L  #69,D2
SI      REPT 8
        MOVE.L  (A0)+,(A1)+
        ENDR
        LEA.L  128(A0),A0
        DBF  D2,SI


	LEA.L	COUL_0,A6		* ADRESSE PALETTE SHIFTER DANS A6
	MOVEA.L #FOND+2,A5              * ADRESSE COULEURS
        MOVEM.L (A5),D0-D7
        MOVEM.L D0-D7,(A6)
	MOVE.L	#0,VALEUR_AUGMENTEE_A_A0

	MOVE.L	$70,ANC_VBL		* SAUVE L'ANCIEN VECTEUR VBL
	MOVE.L	#VBL_IR,$70		* ET PLACE LE MIEN...
	MOVE.L	$120,ANC_TB		* SAUVE ANCIEN VECTEUR TIMER B
	MOVE.L	#TB0_IR,$120		* ET PLACE LE MIEN...
	
	DC.W	$A00A			* CACHE LA SOURIS (LINE A)
	MOVE.B	#$12,ACIA		* INIT CLAV
	
	CLR.B	TBCR			* ARRET DU TIMER B (PLUS PRUDENT)
	BSET	#0,IERA			* AUTORISE LES INTERUPTIONS
	BSET	#0,IMRA			* SUR LE TIMER B

;	bsr	SET_SCR		;preparation des ecrans
;	lea	TEXTE,a0	;debut du texte dans a0
;        LEA     TEXTE2,A1
;	move.l	a0,MEM_LET	Position fonte (Table)
;        MOVE.L  A1,MEM_LET2
;	move.w	#0,PART_AFF	(2 Parties)

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W

BOUCLE:	
	MOVE.B	VSYNC,D7		* ATTEND UNE SYNCRO VERTICALE
WAIT	CMP.B	VSYNC,D7		* POUR LE TESTS DES TOUCHES
	BEQ.S	WAIT
	CMP.B	#$39,ACIA		* TESTE ESPACE (CODE SCAN)
	BNE.S	BOUCLE			* SI ESPACE, ON SORT DE L'INTRO
***********************************************************************

FIN:	
        MOVE.B  #2,SYNCRO
	MOVE.B	#8,ACIA			* REMET LE CLAVIER
	MOVE.B	MFP1,IERA		* RESTAURE LE MFP
	MOVE.B	MFP2,IERB		*
	MOVE.B	MFP3,ISRA		*
	MOVE.B	MFP4,IMRA		*
	MOVE.B	MFP5,TBCR		*
	MOVE.B	MFP6,TBDR		*
	
	MOVE.L	ANC_VBL,$70		* REMET LE VECTEUR VBL
	MOVE.L	ANC_TB,$120		* REMET LE VECTEUR TIMER C
	
	LEA.L	ANC_PAL,A0		* ADRESSE PALETTE SAUVEE
	MOVEM.L	(A0),D0-D7		* RECUPERE LES 16 REGISTRES
	LEA.L	COUL_0,A0		* ADRESSE PALETTE SHIFTER
	MOVEM.L	D0-D7,(A0)		* RESTITUE LES COULEURS
	
	MOVE.W 	RES,-(SP)		* ANCIENNE RESOLUTION
	MOVE.L	ANC_ECR,-(SP)		* ANCIEN ECRAN PHYSIQUE
	MOVE.L	ANC_ECR,-(SP)		* ANCIEN ECRAN LOGIQUE
	MOVE.W 	#5,-(SP)		* FONCTION SETSCREEN
	TRAP 	#14			* DU XBIOS
	LEA.L 	12(SP),SP		* CORRIGE LA PILE
	
	MOVE.L	SAUVE,-(SP)		* RETOUR EN UTILISATEUR
	MOVE.W 	#$20,-(SP)		* AVEC LA F