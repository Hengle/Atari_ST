DEBUT:
	PEA	0.W
	MOVE 	#$20,-(SP)
	TRAP 	#1
	ADDQ.L 	#6,SP

	CLR.W 	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE 	#5,-(SP)
	TRAP 	#14
	LEA.L 	12(SP),SP

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
	MOVE.L	#FIN,$014.W

	move.l	#BUFFER,d0
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#32000,d0
	move.l	d0,SCREEN2

	move.l	SCREEN1,d0
;	MOVE.L	SCREEN2,SCREEN1
;	MOVE.L	D0,SCREEN2
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	MOVE.L	SCREEN1,A0
	LEA	IMG_DEP+34,A1
	MOVE	#7999,D0
T	MOVE.L	(A1)+,(A0)+
	DBF	D0,T

	MOVE.L	SCREEN1,A0
	LEA	BUFFER_COORD,A1
	LEA	BUFFER_COORD2,A2
;	MOVE	#%1111111111,(A0)
;	MOVE	#%1010101111111,160*175(A0)
;	MOVE.L	$44E.W,A0
BOUCLE0	MOVE	(A0),D0
	BNE.S	PLAN_NON_VIDE
BOUCLE1	ADDQ.L	#8,A0
	ADD	#16,COORD_X
	CMPI	#320,COORD_X
	BNE.S	BOUCLE0
	CLR	COORD_X
	ADDQ	#1,COORD_Y
	CMPI	#200,COORD_Y
	BNE.S	BOUCLE0
	BRA	FINI
PLAN_NON_VIDE	MOVEQ	#15,D1
	MOVE	COORD_X,D2
LOOP0	BTST	D1,D0
	BNE.S	ALLUMê
BOUCLE2	ADDQ	#1,D2
	DBF	D1,LOOP0
	BRA.S	BOUCLE1
ALLUMê	ADDQ.L	#1,COMPTE_PTS
;	MOVE	D2,(A1)+
;	MOVE	COORD_Y,(A1)+
	MOVEM.L	D0-A0/A3-A6,-(SP)
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVE	D2,D0
	MOVE	COORD_Y,D1

	MULU	#160,D1
	DIVS	#16,D0
	MOVE	D0,D2
	MULU	#8,D2
	ADD.L	D2,D1
	SWAP	D0
	CMPI	#$7,D0
	BGT.S	PLUS_UN
	BRA.S	PLUS_LOIN
PLUS_UN	ADD.L	#1,D1
	SUB.L	#8,D0
PLUS_LOIN
	LEA	KK,A0
	LSL	#3,D0
	JSR	(A0,D0.W)

;	CMPI	#-25,ZA
;	BGT.S	PLD
;	BRA.S	NOPLD
;PLD	ADD	#2,D1
;NOPLD
;	CMPI	#0,ZA
;	BGT.S	PLD2
;	BRA.S	NOPLD2
;PLD2	ADD	#2,D1
;NOPLD2	CMPI	#25,ZA
;	BGT.S	PLD3
;	BRA.S	NOPLD3
;PLD3	ADD	#2,D1
;NOPLD3
;
;	SUB.L	#23000,D1
	MOVE	D1,(A2)+
	MOVEM.L	(SP)+,D0-A0/A3-A6
	BRA.S	BOUCLE2

KK	MOVE.B	#%10000000,(A1)+
	NOP
	RTS
	MOVE.B	#%01000000,(A1)+
	NOP
	RTS
	MOVE.B	#%00100000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00010000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00001000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00000100,(A1)+
	NOP
	RTS
	MOVE.B	#%00000010,(A1)+
	NOP
	RTS
	MOVE.B	#%00000001,(A1)+
	NOP
	RTS


FINI	BRA.S	FINI
FIN	MOVE.L	4.W,(A0)
	JMP	(A0)

	DATA
IMG_DEP	INCBIN	AI_CHAN.PI1
IMG_FIN	;INCBIN	ZAPPY.PI1

	BSS
COMPTE_PTS	DS.L	1
COORD_X	DS	1
COORD_Y	DS	1
SCREEN1	DS.L	1
SCREEN2	DS.L	1
	DS.B	256
BUFFER	DS.B	32000*2
BUFFER_COORD	DS.B	100000
BUFFER_COORD2	DS.B	200000
