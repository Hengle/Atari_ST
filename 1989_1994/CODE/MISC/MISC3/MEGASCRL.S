DEBUT:
	LEA.L 	D_PILE,A7

	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP	

	MOVE.L	#-8,VALUE2
	MOVE.L	#-8,VALUE

	MOVE.L	#DATA,DATAPNT
	MOVE.L	#DATA,DATAPNT2

	MOVE	#$2700,SR

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
	MOVE.L	#FIN,$014.W

	MOVE.L	#BUFFERSCR,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	MOVE.L	D0,SCREEN
	ADD.L	#128000,D0
	MOVE.L	D0,SCREEN2
	MOVE.L	D0,SCREENA

	MOVE.L	#INTER_RTE,$68.W
	MOVE.L	#INTER_RTE,$134.W

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	CLR.B	$FFFFFA13.W
	CLR.B	$FFFFFA15.W
	CLR.B	$FFFFFA1B.W

	MOVE.B	#$12,$FFFFFC02.W

	CLR.B	$FFFFFA1B.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W

	LEA	TEXTE,A0
	MOVE.L	A0,MEM_LET

	MOVE.L	#RTE,$120.W

	MOVE.L	#VBLR,$70.W
	MOVE	#$2300,SR

BOUCLED	BRA.S	BOUCLED

VBLR
	CLR.B	$FFFFFA1B.W
	MOVE.B	#0,$FFFFFA19.W
	MOVE.B	#99,$FFFFFA1F.W		; BORDER HAUT
	MOVE.B	#4,$FFFFFA19.W
	BCLR	#3,$FFFFFA17.W
	MOVE.L	#INTER_TMA,$134.W
	ORI.B	#$20,$FFFFFA13.W
	ORI.B	#$20,$FFFFFA07.W

	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVEM.L	D0-D7,$FFFF8240.W

	move.l	SCREEN,a1
	ADDA.L	VALUE,A1
	LEA	208+160*7(A1),A1

	LEA	MINI_TABLE,A0
MODT	EQU	*+2
	LEA	0(A0),A0

	TST.L	(A0)
	BNE.S	.ROULE
	CLR	MODT
	LEA	MINI_TABLE,A0
.ROULE
	MOVE.L	(A0),A2
	ADDQ	#4,MODT
	JSR	(A2)

	CLR.L	PLUS3		7*
	ADD.L	#8,VALUE		9*
	MOVE.L	VALUE,D0		5*
	CMPI.L	#29440,D0		4*
	BNE.S	MLML		2
	CLR.L	VALUE		7*
	MOVE.L	#-29440,PLUS3	7*
	BRA.S	GLIBO		3*
MLML	DCB	17,$4E71	16*
GLIBO	
	;44

INTER_RTE	RTE

INTER_TMA:	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	MOVE	#$2100,SR
full
	LEA	$FFFF8209.W,A3
	LEA	$FFFF8260.W,A6
	LEA	$FFFF820A.W,A5

	MOVEQ	#0,D0
	MOVEQ	#2,D1

	STOP	#$2100
	MOVE	#$2700,SR
	MOVE	#$2300,(SP)

	MOVEQ	#29,D2
SYNCHROA:	DBF	D2,SYNCHROA
	NOP

	MOVE.B	D0,(A5)
	REPT	6
	NOP
	ENDR
	MOVE.B	D1,(A5)

******************************************
KJ	MOVE.L	#$FFFF8209,A0	
	MOVE.L	#$FFFF8260,A4	
	MOVE.L	#$FFFF820A,A3	
	MOVE	#199+28,D0		* NB DE LIGNES
	MOVEQ	#0,D1		
	MOVEQ	#0,D4
	MOVEQ	#2,D3
	MOVEQ	#$10,D6

SYNCHR	MOVE.B	(A0),D7     * SYNCHRO
	BEQ.S	SYNCHR
	SUB.W	D7,D6		
	LSL.W	D6,D1		

	REPT	97-4-4-37-1
	NOP	
	ENDR

	MOVE.L	DATAPNT,A6		5
	CMPI.L	#-1,(A6)		5
	BNE.S	OK2		2
	MOVE.L	#DATA,DATAPNT		7
	MOVE.L	DATAPNT,A6		5
	BRA.S	GF		3
OK2	DCB	15,$4E71
GF	MOVE.L	(A6)+,PLUS		7
	MOVE.L	(A6)+,A5		3
;37

	MOVE	#$000,$FFFF8240.W	4

	JSR	(A5)		*4	T=128
	MOVE.L	(A6)+,A5	*3
	JSR	(A5)
	MOVE.L	(A6)+,A5
	JSR	(A5)
	MOVE.L	(A6)+,A5
	JSR	(A5)
	MOVE.L	(A6)+,A5
	JSR	(A5)
	MOVE.L	(A6)+,A5
	JSR	(A5)

	DCB	7,$4E71
VB
	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	MOVEM.L	IMAGE+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	DCB	88-21-19,$4E71
	MOVE.B	#0,(A3)
	MOVE	A3,(A3)
	DCB	13,$4E71
	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	DCB	12-1-2,$4E71
	MOVE	#130+91-1-1,D7


FULLSCREEN	NOP
	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	DCB	88,$4E71
	MOVE.B	#0,(A3)
	MOVE	A3,(A3)
	DCB	13,$4E71
	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	DCB	12-4,$4E71
	DBF	D7,FULLSCREEN

	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	DCB	85/5,$2A95
	DCB	3,$4E71
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)
	DCB	2,$2A95
	DCB	3,$4E71
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	CLR.B	$FFFF820A.W
	DCB	1,$2A95
	DCB	3,$4E71
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	MOVE	a4,(A3)
	DCB	85/5,$2A95
	DCB	1,$4E71
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)
	DCB	2,$2A95
	DCB	3,$4E71
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	dcb	12-1-1,$4e71
	MOVEQ	#39,D7
	
FULL_END	NOP
	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	DCB	85/5,$2A95
	DCB	3,$4E71
	MOVE.B	#0,(A3)
	MOVE	A3,(A3)
	DCB	2,$2A95
	DCB	3,$4E71
 	MOVE	A4,(A4)
	MOVE.B	#0,(A4)
	DCB	12-4,$4E71
	DBF	D7,FULL_END

	MOVE.L	A6,DATAPNT	*5

	MOVE.L	PLUS,D0
	ADD.L	D0,SCREEN1
	MOVE.L	PLUS3,D0
	ADD.L	D0,SCREEN1
	MOVE.B  SCREEN2+1,$FFFF8201.W
	MOVE.B  SCREEN2+2,$FFFF8203.W

	JSR	SWAP
	
	MOVE	#$777,$FFFF8240.W

RTE	RTE


FIN	MOVE.L	4.W,A0
	JMP	(A0)

VB2	MOVE.L	MEM_LET,A5

	LEA	IMAGE+34,A0	3
	ADDA	(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	2(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	4(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	6(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	8(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	10(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	12(A5),A0
	JSR	BUFFER_FULL

	LEA	IMAGE+34,A0
	ADDA	14(A5),A0
	JSR	BUFFER_FULL
POPOPO
	MOVE.L	MEM_LET,A2
	ADD.L	#2*8,A2
	CMPI	#$FFFF,16(A2)
	BEQ.S	GO_LET	2
	BRA.S	POL	3
GO_LET
	LEA	TEXTE,A2	3
POL	
	MOVE.L	A2,MEM_LET	5
	MOVE.L	A2,A5

	LEA	-29440(A1),A1
	LEA	-29440(A1),A1

	LEA	IMAGE+34,A0
	ADDA	(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	2(A5),A0
	;JSR	BUFFER_FULL2
	RTS

	LEA	IMAGE+34,A0
	ADDA	4(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	6(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	8(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	10(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	12(A5),A0
	JSR	BUFFER_FULL2

	LEA	IMAGE+34,A0
	ADDA	14(A5),A0
	JSR	BUFFER_FULL2
	RTS

MINI_TABLE	
	DC.L	VB2
	DC.L	APART1B
	DC.L	APART2
	DC.L	APART2B
	DC.L	0
	

APART2	MOVE.L	MEM_LET,A5

	LEA	IMAGE+34+32*160,A0	3
	ADDA	(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+		6
	MOVE.L	INC+4(A0),(A1)+		6
INC	SET	INC+160
	LEA	222(A1),A1		2
	ENDR

	LEA	IMAGE+34+32*160,A0	3
	ADDA	2(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+		6
	MOVE.L	INC+4(A0),(A1)+		6
INC	SET	INC+160
	LEA	222(A1),A1		2
	ENDR

	LEA	IMAGE+34+32*160,A0	3
	ADDA	4(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+		6
	MOVE.L	INC+4(A0),(A1)+		6
INC	SET	INC+160
	LEA	222(A1),A1		2
	ENDR

	LEA	IMAGE+34+32*160,A0	3
	ADDA	6(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+		6
	MOVE.L	INC+4(A0),(A1)+		6
INC	SET	INC+160
	LEA	222(A1),A1		2
	ENDR
	
	LEA	IMAGE+34+32*160,A0
	ADDA	8(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34+32*160,A0
	ADDA	10(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	
	LEA	IMAGE+34+32*160,A0
	ADDA	12(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34+32*160,A0
	ADDA	14(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR


;	T=3691+4

	RTS

APART1B	MOVE.L	MEM_LET,A5

	LEA	IMAGE+34,A0	3
	ADDA	(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	2(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	4(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	6(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0
	ADDA	8(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34,A0
	ADDA	10(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR


	LEA	IMAGE+34,A0
	ADDA	12(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34,A0
	ADDA	14(A5),A0

INC	SET	0
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR



;	3693
	RTS

APART2B	MOVE.L	MEM_LET,A5
	LEA	IMAGE+34,A0	3
	ADDA	(A5),A0


INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	2(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	4(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0	3
	ADDA	6(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+	6
	MOVE.L	INC+4(A0),(A1)+	6
INC	SET	INC+160
	LEA	222(A1),A1	2
	ENDR

	LEA	IMAGE+34,A0
	ADDA	8(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34,A0
	ADDA	10(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR


	LEA	IMAGE+34,A0
	ADDA	12(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR

	LEA	IMAGE+34,A0
	ADDA	14(A5),A0

INC	SET	8
	REPT	32
	MOVE.L	INC(A0),(A1)+
	MOVE.L	INC+4(A0),(A1)+
INC	SET	INC+160
	LEA	222(A1),A1
	ENDR


;	3693
	RTS




SWAP
	move.l	SCREEN1,d0
	move.l	SCREEN2,SCREEN1
	move.l	d0,SCREEN2

	move.l	SCREEN,d0
	move.l	SCREENA,SCREEN
	move.l	d0,SCREENA

	move.l	VALUE,d0
	move.l	VALUE2,VALUE
	move.l	d0,VALUE2

	move.l	DATAPNT,d0
	move.l	DATAPNT2,DATAPNT
	move.l	d0,DATAPNT2


	rts
		

NOTHING	
	REPT	117
	NOP
	ENDR
	RTS

H70
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	89
	NOP				
	ENDR
	MOVE.B	D4,(A3)
	MOVE.B	D3,(A3)
	REPT	13
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	1
	NOP			 
	ENDR
	RTS	=4 NOPS
H44
;	MOVE.B	D3,(A4)
	NOP
;	MOVE.B	D4,(A4)
	REPT	89+4
	NOP				
	ENDR
	MOVE.B	D4,(A3)
	MOVE.B	D3,(A3)
	REPT	13
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	1
	NOP			 
	ENDR
	RTS	=4 NOPS
H24
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	89-2
	NOP				
	ENDR
	MOVE.B	D4,(A3)
	MOVE.B	D3,(A3)
	REPT	13
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	1+2
	NOP			 
	ENDR
	RTS	=4 NOPS
H2
;	MOVE.B	D3,(A4)
	NOP
;	MOVE.B	D4,(A4)
	REPT	89-2+4
	NOP				
	ENDR
	MOVE.B	D4,(A3)
	MOVE.B	D3,(A3)
	REPT	13
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	1+2
	NOP			 
	ENDR
	RTS	=4 NOPS
H80
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	35
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	49
	NOP				
	ENDR
	MOVE.B	D4,(A3)
	MOVE.B	D3,(A3)
	REPT	13		
	NOP
	ENDR
	MOVE.B	D3,(A4)
	NOP
	MOVE.B	D4,(A4)
	REPT	1
	NOP			 
	ENDR
	RTS

BUFFER_FULL
INC	SET	0
INC2	SET	0
	REPT	32
	MOVEP.L	INC+9(A0),D0	6
	MOVEP.L	D0,INC2(A1)	6
INC	SET	INC+160
INC2	SET	INC2+230
	ENDR
	LEA	230*32(A1),A1	2
	RTS

BUFFER_FULL2
INC	SET	0
INC2	SET	0
	REPT	32
	MOVEP.L	INC(A0),D0
	MOVEP.L	D0,INC2+1(A1)
INC	SET	INC+160
INC2	SET	INC2+230
	ENDR
	LEA	230*32(A1),A1	2
	RTS

	SECTION	DATA
IMAGE	INCBIN	BLOCS.PI1
TEXTE	INCBIN	BIG3.TXT

DATA	
	DC.L	-256,NOTHING,NOTHING,NOTHING,NOTHING,NOTHING,NOTHING
	DC.L	256,H44,H44,H44,H44,H44,H44
	DC.L	0,H24,H2,H2,H2,H2,NOTHING
	DC.L	0,H24,NOTHING,NOTHING,NOTHING,NOTHING,NOTHING
	DC.L	0,H80,H44,H2,H70,NOTHING,NOTHING
	DC.L	0,H44,H2,H2,NOTHING,NOTHING,NOTHING
	DC.L	0,H24,H24,NOTHING,NOTHING,NOTHING,NOTHING
	DC.L	0,H80,H70,H2,H2,H70,NOTHING
	DC.L	0,H70,H2,H2,H2,NOTHING,NOTHING
	DC.L	0,H24,H24,H24,NOTHING,NOTHING,NOTHING
	DC.L	0,H44,H44,H2,H2,H2,H2
	DC.L	0,H44,H44,NOTHING,NOTHING,NOTHING,NOTHING
	DC.L	256,H24,H24,H24,H24,NOTHING,NOTHING
	DC.L	-256,H80,H80,H80,H44,H44,NOTHING
	DC.L	0,H70,H44,H2,NOTHING,NOTHING,NOTHING
	DC.L	0,H24,H24,H24,H24,H24,NOTHING
	DC.L	0,H44,H44,H44,H2,H2,NOTHING
	DC.L	0,H70,H24,H44,H2,NOTHING,NOTHING
	DC.L	0,H24,H24,H24,H24,H24,H24
	DC.L	0,H80,H70,H70,H24,H2,H70

	DC.L	256,H70,H70,H24,H2,H2,NOTHING
	DC.L	0,H80,H2,H2,H2,H2,NOTHING	
	DC.L	-256,H80,NOTHING,NOTHING,NOTHING,NOTHING,NOTHING
	DC.L	512,H70,H70,H44,NOTHING,NOTHING,NOTHING
	DC.L	-512,H80,H80,H80,H80,NOTHING,NOTHING
	DC.L	0,H44,H44,H44,H44,H24,NOTHING
	DC.L	512,H70,H70,H70,H2,NOTHING,NOTHING
	DC.L	-512,H80,H80,H80,H80,H24,NOTHING
	DC.L	0,H44,H44,H44,H44,H24,H24
	
	DC.L	512,H70,H70,H24,H24,H44,NOTHING
	DC.L	-256,H80,H80,H80,H80,H24,H24
	DC.L	0,H2,H2,H2,H2,NOTHING,NOTHING

	DC.L	-1,-1

	SECTION	BSS
 	
F_PILE	DS.L 	128	
D_PILE	DS.L 	1	
GLOUBI	DS.L	1
SCREENA	DS.L	1
SCREEN	DS.L	1
SCREEN1	DS.L	1
SCREEN2	DS.L	1
DATAPNT2	DS.L	1
DATAPNT	DS.L	1
VALUE2	DS.L	1
VALUE	DS.L	1
ASCREEN2	DS.L	1
ASCREEN1	DS.L	1
PLUS	DS.L	1
PLUS3	DS.L	1
MEM_LET	DS.L	1
	DS.B	256
BUFFERSCR	DS.B	64000*4
