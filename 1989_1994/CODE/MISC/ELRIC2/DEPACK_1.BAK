SHOW_TIME_DEPACK = 1
DEPACK_MODE = 1    1 POUR LE DEPACKING EN PARTANT DU DEBUT, 0 POUR LA FIN

	MOVE.W	#LONG_RT,D0

	PEA	0.W
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP
	MOVE.L	D0,SAUV_SP

	LEA	PILE,A7

	CLR.W	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.W	#$502,$FFFF8240.W
	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL
	MOVE.W	#$111,$FFFF8240.W

	LEA	DATAS,A0
;	MOVE.L	$44E.W,A5
;	LEA	-34(A5),A5
;	LEA	BUF_DEPACK,A5
	JSR	DEPACK

	MOVEM.L	$F8000-34+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
;	LEA	BUF_DEPACK+34,A0
;	MOVE.L	$44E.W,A1
;	MOVE.W	#7999,D7
;RECOPY	MOVE.L	(A0)+,(A1)+
;	DBRA	D7,RECOPY

	MOVE.W	#7,-(SP)
	TRAP	#1
	ADDQ.W	#2,SP

	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP

	CLR.W	-(SP)
	TRAP	#1

DATAS	INCBIN	PRES1B.HUF
	EVEN
	IFEQ	DEPACK_MODE
	DS.B	32066
	ENDC
FIN_DATA

ANC_PAL	DS.L	8
SAUV_SP	DS.L	1
	IFNE	DEPACK_MODE
BUF_DEPACK	DS.B	32066
	ENDC

*LONGUEUR DE LA ROUTINE DE DEPACKING : 112-124 OCTETS

DEB_RT	EQU	*

	IFNE	DEPACK_MODE
DEPACK	CMPI.L	#"STWX",(A0)+
	BNE.S	PAS_A_DEPACKER
	MOVEQ	#0,D5
	MOVEQ	#-1,D7
	LEA	FIN_DATA,A4
	LEA	2(A0),A1	A1=TABLE D'OFFSET
	LEA	64(A1),A2	A2=TABLE DE CORRESPONDANCE
	ADDA.W	(A0),A0	A0=DEBUT DES DATAS A DEPACKER
DEPACKING	CMPA.L	A4,A0
	BEQ.S	FIN_DEPACK
	MOVE.W	(A0)+,D0	D0=.W A TRAITER
	MOVEQ	#15,D6
CONT_DEPACK	MOVEQ	#-4,D1	D1=NB DE BITS
	MOVEQ	#0,D2
DECAL_ANOTHER	LSL	D2
	LSL	D0
	ADDX.W	D5,D2
	ADDQ.W	#4,D1
	MOVE.W	(A1,D1.W),D3	D3=OFFSET DANS LA TABLE
	MOVE.W	2(A1,D1.W),D4	D4=NB D'OCTETS A TRAITER -1
	CMP.W	D7,D4
	BNE.S	SEARCH_1
	DBRA	D6,DECAL_ANOTHER
	CMPA.L	A4,A0
	BEQ.S	FIN_DEPACK
	MOVE.W	(A0)+,D0
	MOVEQ	#15,D6
	BRA.S	DECAL_ANOTHER
SEARCH_1	CMP.W	2(A2,D3.W),D2
	BEQ.S	TROUVê
	ADDQ.W	#4,D3
	DBRA	D4,SEARCH_1	
	DBRA	D6,DECAL_ANOTHER
	CMPA.L	A4,A0
	BEQ.S	FIN_DEPACK
	MOVE.W	(A0)+,D0
	MOVEQ	#15,D6
	BRA.S	DECAL_ANOTHER
TROUVê	
	IFNE	SHOW_TIME_DEPACK
	 ANDI.W	#$0777,$FFFF8240.W
	 ADDI.W	#$111,$FFFF8240.W
	ENDC
	MOVE.B	(A2,D3.W),(A5)+
	DBRA	D6,CONT_DEPACK
	BRA.S	DEPACKING
PAS_A_DEPACKER	
FIN_DEPACK	RTS
	ELSE
DEPACK	CMPI.L	#"STWX",(A0)+
	BNE.S	PAS_A_DEPACKER
	
PAS_A_DEPACKER
	RTS
	ENDC
LONG_RT	EQU	(*-DEB_RT)

	DS.B	500
PILE	DS.B	500
