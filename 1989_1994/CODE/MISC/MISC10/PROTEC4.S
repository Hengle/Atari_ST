;A FINIR: ECRIRE LE BOOT EN NON RELOGEABLE... ET NE LE FAIRE MARCHER
;QU'EN $8-$70.

	OPT	O+,A+,P+
	OPT	A+
	PEA	0.W
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

;***********************************************
	LEA	ANC_VBL,A0
	MOVE.L	$70.W,(A0)
	
	STOP	#$2300
	STOP	#$2300
	LEA	$70.W,A0
	LEA	VBL,A1
	MOVE.L	A1,(A0)
B	JMP	B
YOUPI	PEA	0.W
	TRAP	#1

VBL
  MOVE.B  #$18,D0 
  MOVE    #$2700,SR 
L0004:TST.B   $FFFF8209.W
  BEQ.S     L0004 
  SUB.B   $FFFF8209.W,D0 
  LSR.L   D0,D0 
	MOVE.B	$FFFF8209.W,D1
	NOP
	MOVE.B	$FFFF8209.W,D3
	MOVE.L	ANC_VBL,$70.W

COOL	
	SUB	D1,D3
	LSR	#1,D3
	LSR	#1,D3
	MOVE	D3,D4
	SWAP	D3
	MOVE	D4,D3

	LEA	BUFFER,A0
	ADDQ	#4,2(A0)
	MOVE	#5,D0
CODE	SUB.L	D3,(A0)+
	DBF	D0,CODE

BUFFER	INCBIN	CODED.BIN
	DC	$0000
GOGO	MOVE	(a0),D0
	MOVE	d2,(a0)	ON SUPPOSE D2=0000
	MOVE	D0,(a0)

;	LIST

	BRA.S	ICI
	MOVE	d2,(a0)	ON SUPPOSE D2=0000
	MOVE	D0,(a0)

	DC	$2F7C
	LEA	ADR,A2
	MOVE	#$6002,(A2)
	MOVE	d2,(a0)	ON SUPPOSE D2=0000
	MOVE	D0,(a0)

	RESET
	MOVE	d2,(a0)	ON SUPPOSE D2=0000
	MOVE	D0,(a0)

ADR	DC	$2F7C
	BRA.S	SUITE
ICI	;FAIRE ICI UN APPEL BIDON...
	NOP
	PEA	TXT
	MOVE	#$9,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
SUITE	;D1 CONTIENT LE CODE...
	MOVE	#$10,D4
	MOVE	d2,(a0)	ON SUPPOSE D2=0000
	MOVE	D0,(a0)
	RESET
	DBF	D4,FG
	BRA.S	ICI
FG	JSR	COOLIE
	BRA.S	ICI
COOLIE	
	MOVE.L	6(A7),(A7)
	MOVE.L	(A7),A0
	ADD	D3,A0
	ADD	D3,A0
	MOVE.L	A0,(A7)
	RTS

;	MOVE.L	(A7)+,A0	=RTS
;	JMP	(A0)


ANC_VBL	DS.L	1
TXT	DC.B	'PROB',0