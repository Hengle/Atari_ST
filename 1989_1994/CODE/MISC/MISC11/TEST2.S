	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP




	LEA	ROUTINE,A0
	MOVEA.L	#$E0000,A1
	MOVE.L	#7999,D0
LM	MOVE.L	(A0)+,(A1)+
	DBF	D0,LM




	 move.l #$31415926,$426.W
	 move.l #$E0000,$42A.W

	clr	-(sp)
	move.l	#40000,-(sp)
	move	#$31,-(sp)
	trap	#1
	addq.l	#8,sp


ROUTINE MOVE.B	#$2,$FFFF820A.W
	CLR.B	$FFFF8260.W
	MOVE.L	$436.W,A0
	LEA	-4(A0),A0
	MOVE.L	A0,SP
 	MOVE	#$2300,SR


	 move.l #$31415926,$426.W
	 move.l #$E0000,$42A.W

	
	CLR.W	-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP
	
	
	ANDI.B	#%11111000,$484.W
	
	CLR.L	PAS
	CLR.L	OFFSET
	
	BSR	PREP_AFF

	MOVE.L	#ECRAN,D0
	ANDI.B	#0,D0
	MOVE.L	D0,SCREEN
	
	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL

	MOVE.L	$70.W,ANC_VBL
	MOVE.L	#VBLR,$70.W
	
LOOP	BRA	LOOP

FIN	MOVE.L	ANC_VBL,$70.W

	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W
	
	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ORI.B	#%00000111,$484.W
	
	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
TESTT	CMPI.B	#$50,$FFFFFC02.W
	BNE	SUIT1
	MOVE.L	PAS,D7
	MOVE.L	#160,D0
	LSL.L	D7,D0
	ADD.L	D0,OFFSET
	BRA	FINT

SUIT1	CMPI.B	#$48,$FFFFFC02.W
	BNE	SUIT2
	MOVE.L	PAS,D7
	MOVE.L	#160,D0
	LSL.L	D7,D0
	SUB.L	D0,OFFSET
	CMPI.L	#0,OFFSET
	BGE	FINT
	CLR.L	OFFSET
	BRA	FINT

SUIT2	CMPI.B	#$4D,$FFFFFC02.W
	BNE	SUIT3
	ADDQ.L	#8,OFFSET
	BRA	FINT

SUIT3	CMPI.B	#$4B,$FFFFFC02.W
	BNE	SUIT4
	SUBI.L	#8,OFFSET
	CMPI.L	#0,OFFSET
	BGE	FINT
	CLR.L	OFFSET
	BRA	FINT

SUIT4	CMPI.B	#$47,$FFFFFC02.W
	BNE	SUIT5
	ADDI.L	#2,OFFSET
	BRA	FINT

SUIT5	CMPI.B	#$52,$FFFFFC02.W
	BNE	SUIT6
	SUBI.L	#2,OFFSET
	BRA	FINT

SUIT6	CMPI.B	#$3B,$FFFFFC02.W
	BNE	SUIT7
	MOVE.L	OFFSET,D0
	SUBI.L	#32,D0
	LEA	$0.W,A0
	ADDA.L	D0,A0
	MOVEM.L	(A0),D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	BRA	FINT
	
SUIT7	CMPI.B	#$3C,$FFFFFC02.W
	BNE	SUIT8
	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	BRA	FINT

SUIT8	CMPI.B	#2,$FFFFFC02.W
	BNE	SUIT9
	MOVE.L	#0,PAS
	BRA	FINT
	
SUIT9	CMPI.B	#3,$FFFFFC02.W
	BNE	SUIT10
	MOVE.L	#1,PAS
	BRA	FINT
	
SUIT10	CMPI.B	#4,$FFFFFC02.W
	BNE	SUIT11
	MOVE.L	#2,PAS
	BRA	FINT

SUIT11	CMPI.B	#$44,$FFFFFC02.W
	BNE	FINT

	MOVE.L	ANC_VBL,$70.W
	
	CLR.W	-(SP)
	PEA	F_NAME
	MOVE.W	#60,-(SP)
	TRAP	#1
	ADDQ.L	#8,SP
	
	MOVE.W	#1,-(SP)
	PEA	F_NAME
	MOVE.W	#61,-(SP)
	TRAP	#1
	ADDQ.L	#8,SP
	MOVE.W	D0,HANDLE
	
	LEA	$0.W,A0
	ADDA.L	OFFSET,A0
	SUBA.L	#34,A0

	MOVE.L	A0,-(SP)
	MOVE.L	#32066,-(SP)
	MOVE.W	HANDLE,-(SP)
	MOVE.W	#64,-(SP)
	TRAP	#1
	LEA	12(SP),SP
	
	MOVE.W	HANDLE,-(SP)
	MOVE.W	#62,-(SP)
	TRAP	#1
	ADDQ.L	#4,SP

	MOVE.L	#VBLR,$70.W
		
FINT	RTS

VBLR	LEA	$0.W,A0
	ADDA.L	OFFSET,A0
	MOVE.L	SCREEN,A1
	MOVE.B	SCREEN+1,$FFFF8201.W
	MOVE.B	SCREEN+2,$FFFF8203.W
	BSR	AFF_PIC
	BSR	TESTT
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE

	
PREP_AFF	LEA	AFF_PIC,A0
	MOVEQ	#0,D2
	MOVE.W	#615,D7
PREPCDG	MOVE.W	#$4CE8,(A0)+
	MOVE.W	#$7CFF,(A0)+
	MOVE.W	D2,(A0)+
	MOVE.W	#$48E9,(A0)+
	MOVE.W	#$7CFF,(A0)+
	MOVE.W	D2,(A0)+
	ADDI.W	#52,D2
	DBRA	D7,PREPCDG
	MOVE.W	#$4E75,(A0)+
	RTS
	
	SECTION	DATA
;PROG	INCBIN	FONT_ZAP.PI1

F_NAME	DC.B	"FNT_ZAP.PI1",0
	SECTION	BSS
ANC_PAL	DS.L	8
ANC_VBL	DS.L	1
SAUV_SP	DS.L	1
OFFSET	DS.L	1
PAS	DS.L	1
HANDLE	DS.W	1
SCREEN	DS.L	1
	DS.B	256
ECRAN	DS.L	8000
	DS.B	256
AFF_PIC	DS.W	(18*200)+1
