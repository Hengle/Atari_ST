	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP
	
	CLR.W	-(SP)
	MOVE.L	#-1,-(SP)	
	MOVE.L	#-1,-(SP)	
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP
	
	MOVE.L	#FIN,$008
	MOVE.L	#FIN,$00C
	MOVE.L	#FIN,$010
	MOVE.L	#FIN,$014
	MOVE.L	#FIN,$018
	MOVE.L	#FIN,$01C
	MOVE.L	#FIN,$020
	MOVE.L	#FIN,$024
	
	ANDI.B	#%11111000,$484.W

	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL
	
	CLR.B	FLAG
	MOVE.L	#72,POSEC
	MOVE.L	#80,POSEC2
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	#VBLR,$70.W
	
LOOP	JMP	LOOP

FIN	MOVE.L	ANC_VBL,$70.W

	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ORI.B	#%00000111,$484.W
	
	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
	*******	V B L  &  P R O C E D U R E S   *******
VBLR	MOVE.W	#3000,D0
BCL	DBRA	D0,BCL
	MOVE.W	#$070,$FFFF8240.W
	BSR	AFF_LIG
	MOVE.W	#$000,$FFFF8240.W
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE

AFF_LIG	TST.B	FLAG
	BEQ	DIR_1
	BNE	DIR_2
DIR_1	LEA	CHAIN,A0
	ADDA.L	POS_CH,A0
	CMPI.L	#-1,(A0)
	BNE	SUITFCR1
	CLR.L	POS_CH
	LEA	CHAIN,A0
	SUBI.L	#8,POSEC
	ADDI.L	#8,POSEC2
	CMPI.L	#-8,POSEC
	BNE	SUITFCR1
	CLR.L	POSEC
	MOVE.L	#152,POSEC2
	MOVE.B	#1,FLAG	
	CLR.L	POS_CH
	BRA	DIR_2
SUITFCR1	MOVE.L	(A0),A0
	MOVE.L	$44E.W,A1
	ADDA.L	POSEC,A1	
	MOVE.W	(A0),(A1)
	LEA	CHAINS,A0
	ADDA.L	POS_CH,A0
	MOVE.L	$44E.W,A1
	ADDA.L	POSEC2,A1
	MOVE.L	(A0),A0
	MOVE.W	(A0),(A1)
	ADDQ.L	#4,POS_CH	
	RTS
DIR_2	LEA	CHAIN2,A0
	ADDA.L	POS_CH,A0
	CMPI.L	#-1,(A0)
	BNE	SUITFCR2
	CLR.L	POS_CH
	LEA	CHAIN2,A0
	ADDI.L	#8,POSEC
	SUBI.L	#8,POSEC2
	CMPI.L	#80,POSEC
	BNE	SUITFCR2
	MOVE.B	#0,FLAG
	MOVE.L	#72,POSEC
	MOVE.L	#80,POSEC2
	CLR.L	POS_CH
	BRA	DIR_1
SUITFCR2	MOVE.L	(A0),A0
	MOVE.L	$44E.W,A1
	ADDA.L	POSEC,A1
	MOVE.W	(A0),(A1)
	LEA	CHAINS2,A0
	ADDA.L	POS_CH,A0
	MOVE.L	(A0),A0
	MOVE.L	$44E.W,A1
	ADDA.L	POSEC2,A1
	MOVE.W	(A0),(A1)
	ADDQ.L	#4,POS_CH
	RTS

	SECTION	DATA
GRAPH	DC.W	%1111111111111111
	DC.W	%0011111111111111
	DC.W	%0000111111111111
	DC.W	%0000001111111111
	DC.W	%0000000011111111
	DC.W	%0000000000111111
	DC.W	%0000000000001111
	DC.W	%0000000000000011
	DC.W	%0000000000000000
GRAPH2	DC.W	%0000000000000000
	DC.W	%1100000000000000
	DC.W	%1111000000000000
	DC.W	%1111110000000000
	DC.W	%1111111100000000
	DC.W	%1111111111000000
	DC.W	%1111111111110000
	DC.W	%1111111111111100
	DC.W	%1111111111111111

CHAIN	DC.L	GRAPH+14,GRAPH+12,GRAPH+10,GRAPH+8,GRAPH+6,GRAPH+4,GRAPH+2,GRAPH,-1

CHAINS	DC.L	GRAPH2+2,GRAPH2+4,GRAPH2+6,GRAPH2+8,GRAPH2+10,GRAPH2+12,GRAPH2+14,GRAPH2+16,-1

CHAIN2	DC.L	GRAPH+2,GRAPH+4,GRAPH+6,GRAPH+8,GRAPH+10,GRAPH+12,GRAPH+14,GRAPH+16,-1

CHAINS2 	DC.L	GRAPH2+14,GRAPH2+12,GRAPH2+10,GRAPH2+8,GRAPH2+6,GRAPH2+4,GRAPH2+2,GRAPH2,-1

	SECTION	BSS
ANC_PAL	DS.L	8
SAUV_SP	DS.L	1
ANC_VBL	DS.L	1
POSEC	DS.L	1
POSEC2	DS.L	1
POS_CH	DS.L	1
FLAG	DS.B	1
	EVEN