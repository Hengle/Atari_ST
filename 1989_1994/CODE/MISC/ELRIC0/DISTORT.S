 	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP
	
	MOVEQ	#1,D0
	JSR	MUZAXX
;	MOVE.L	#MUZAXX+8,$4D2.W

	CLR.W	-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP
	
	ANDI.B	#%11111000,$484.W
	
	MOVE.B	#$12,$FFFFFC02.W
	DC.W	$A00A

	MOVE.W	#7999,D0
	MOVE.L	$44E.W,A0
EFF	CLR.L	(A0)+
	DBRA	D0,EFF

	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,SAUV_PAL
 	MOVEM.L	LOGO+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	MOVE.L	#FIN2,$008
	MOVE.L	#FIN2,$00C
	MOVE.L	#FIN2,$010
	MOVE.L	#FIN2,$014
	MOVE.L	#FIN2,$018
	MOVE.L	#FIN2,$01C
	MOVE.L	#FIN2,$020
	
	BSR	PREDEC
	
;	CLR.L	$4D2.W
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	#VBLR,$70.W
	
BOUCLE	JMP	BOUCLE

FIN	MOVE.L	ANC_VBL,$70.W

	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W
	
	MOVE.B	#8,$FFFFFC02.W

	ORI.B	#%00000111,$484.W
	
	MOVEM.L	SAUV_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ANDI.W	#%1101111111111111,SR
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
FIN2	CMPI.B	#$39,$FFFFFC02.W
	BNE	FIN2
	BRA	FIN
	
	*******   V B L  &  P R O C E D U R E S   *******
VBLR	CMPI.B	#$F,$FFFFFC02.W
	BNE	SUITV0
	MOVE.W	#$700,COULTAB
	MOVE.W	#$070,COULT2
SUITV0	MOVE.W	COULTAB,$FFFF8240.W
	MOVE.L	$44E.W,A1
	MOVE.L	COUNT_LIG,AD
	BSR	AFF
	MOVE.W	COULT2,$FFFF8240.W
	JSR	MUZAXX+224
	MOVE.W	#$000,$FFFF8240.W
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	CLR.W	COULTAB
	CLR.W	COULT2
	RTE
	
TABTAK	MOVEQ	#0,D0
	LEA	MVT,A2
	LEA	CORES_BUF,A3
	ADDA.L	AD,A2
	CMPI.B	#-1,84(A2)
	BNE	SUITK
	CLR.L	COUNT_LIG
	CLR.L	AD
	LEA	MVT,A2
SUITK	MOVE.B	(A2),D0
	LSL.W	#2,D0
	ADDA.L	D0,A3
	MOVE.L	(A3),A0
	ADDQ.L	#1,AD
	RTS

AFF	
N	SET	0
	REPT	10
	BSR	TABTAK
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVE.L	52+N(A0),52+N(A1)
N	SET	N+160
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVE.L	52+N(A0),52+N(A1)
N	SET	N+160
	ENDR
	REPT	7
	BSR	TABTAK
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVE.L	52+N(A0),52+N(A1)
	MOVEM.L	N+104(A0),D0-D7/A2-A6	
	MOVEM.L	D0-D7/A2-A6,N+104(A1)
	MOVE.L	N+156(A0),N+156(A1)
N	SET	N+160
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVE.L	52+N(A0),52+N(A1)
	MOVEM.L	N+104(A0),D0-D7/A2-A6	
	MOVEM.L	D0-D7/A2-A6,N+104(A1)
	MOVE.L	N+156(A0),N+156(A1)
N	SET	N+160
	ENDR
	REPT	25
	BSR	TABTAK
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVEM.L	N+52(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N+52(A1)
	MOVEM.L	N+104(A0),D0-D7/A2-A6	
	MOVEM.L	D0-D7/A2-A6,N+104(A1)
	MOVE.L	N+156(A0),N+156(A1)
N	SET	N+160
	MOVEM.L	N(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N(A1)
	MOVEM.L	N+52(A0),D0-D7/A2-A6
	MOVEM.L	D0-D7/A2-A6,N+52(A1)
	MOVEM.L	N+104(A0),D0-D7/A2-A6	
	MOVEM.L	D0-D7/A2-A6,N+104(A1)
	MOVE.L	N+156(A0),N+156(A1)
N	SET	N+160
	ENDR
	ADDQ.L	#1,COUNT_LIG
	RTS
		
	*******   P R E D E C A L A G E S  1 6    *******

PREDEC	MOVE.L	#LOGO+34,A0
	BSR	REAFF
	REPT	15
	MOVE.L	#BUF_LOG,A0
	ADDA.L	AD,A0
	SUBA.L	#(160*84),A0
	BSR	REAFF
	BSR	DECAL
	ENDR
	CLR.L	AD
	RTS
	
REAFF	MOVE.L	#BUF_LOG,A1
	ADDA.L	AD,A1
	MOVE.W	#83,D0
RCP_LIG	MOVEM.L	(A0),D1-D7/A2-A6
	MOVEM.L	D1-D7/A2-A6,(A1)
	MOVEM.L	48(A0),D1-D7/A2-A6
	MOVEM.L	D1-D7/A2-A6,48(A1)
	MOVEM.L	96(A0),D1-D7/A2-A6
	MOVEM.L	D1-D7/A2-A6,96(A1)
	MOVEM.L	144(A0),D1-D4
	MOVEM.L	D1-D4,144(A1)
	LEA	160(A0),A0
	LEA	160(A1),A1
	DBRA	D0,RCP_LIG
	ADDI.L	#(160*84),AD
	RTS

DECAL	MOVE.L	#BUF_LOG,A0
	ADDA.L	AD,A0
	SUBA.L	#(160*84),A0
	MOVE.L	#83,D1
NEW_LIG	MOVE.L	#3,D0
REC	ROXR	(A0)
	ROXR	8(A0)
	ROXR	16(A0)
	ROXR	24(A0)
	ROXR	32(A0)
	ROXR	40(A0)
	ROXR	48(A0)
	ROXR	56(A0)
	ROXR	64(A0)
	ROXR	72(A0)
	ROXR	80(A0)
	ROXR	88(A0)
	ROXR	96(A0)
	ROXR	104(A0)
	ROXR	112(A0)
	ROXR	120(A0)
	ROXR	128(A0)
	ROXR	136(A0)
	ROXR	144(A0)
	ROXR	152(A0)
	ADDQ.L	#2,A0
	DBRA	D0,REC
	LEA	38*4(A0),A0
	DBRA	D1,NEW_LIG
	RTS
	
	SECTION	DATA
LOGO	INCBIN	HOLOLOGO.PI1
MUZAXX	INCBIN	COUNT_Z.MUS

CORES_BUF	DC.L	BUF_LOG,BUF_LOG+160*84,BUF_LOG+160*168,BUF_LOG+160*252,BUF_LOG+160*336,BUF_LOG+160*420,BUF_LOG+160*504,BUF_LOG+160*588,BUF_LOG+160*672,BUF_LOG+160*756,BUF_LOG+160*840,BUF_LOG+160*924,BUF_LOG+160*1008
	DC.L	BUF_LOG+160*1092,BUF_LOG+160*1176,BUF_LOG+160*1260

MVT	REPT	4
	DC.B	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	ENDR
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	DC.B	0,0,1,2,2,3,4,4,5,6,6,7,8,8,9,10,10,11,12,12,13,14,14,15,14,14,13,12,12
	DC.B	11,10,10,9,8,8,7,6,6,5,4,4,3,2,2,1,0,0
	REPT	4
	DC.B	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	ENDR
	REPT	4
	DC.B	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	ENDR
	DC.B	-1

	SECTION	BSS
SAUV_PAL	DS.L	8
SAUV_SP	DS.L	1
ANC_VBL	DS.L	1 
AD	DS.L	1
COUNT_LIG	DS.L	1
COULTAB	DS.W	1
COULT2	DS.W	1
BUF_LOG	DS.L	(40*84)*16  	;215 Ko DE PREDECALAGES