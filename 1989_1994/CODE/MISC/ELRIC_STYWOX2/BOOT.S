	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP
	MOVE.L	D0,SAUV_SP

	CLR.W	-(SP)
	PEA	-1.W
	PEA	-1.W
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.W	#LONG_BOOT,D0
	BSR	BOOT_PRG

	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.W	#6,SP

	CLR.W	-(SP)
	TRAP	#1

SAUV_SP	DS.L	1

DEP_BOOT = *
BOOT_PRG	LEA	BUFFER,A2
	MOVE.W	#$3FF,D3	;1023
	MOVE.W	#$3FF,D4
	MOVEQ	#127,D6
.R2	MOVEQ	#1,D7
.R1	MOVE.W	#$11,-(SP)
	TRAP	#14
	ADDQ.W	#2,SP	
	AND.W	D3,D0	;0-->511
	ADD.W	D0,D0	;*2
	MOVE.W	D0,(A2)+
	DBRA	D7,.R1	;X&Y
	MOVE.W	#$11,-(SP)
	TRAP	#14
	ADDQ.W	#2,SP	
	AND.W	D4,D0	;0-->511
	ADD.W	D0,D0	;*2
	MOVE.W	D0,(A2)+
	DBRA	D6,.R2	;52 OCTETS
	MOVE.L	A2,A3	;A3=ADRESSE DES COEFFS
	MOVE.W	#$7FFF,(A3)+
	MOVE.W	#1022,D5
	MOVE.W	#256+1,D7	;Z_DEP=1+256
RECOM	MOVE.L	#$80*256,D0
	DIVU.W	D7,D0
	ASL.L	#8,D0
	MOVE.W	D0,(A3)+
	ADDQ.W	#1,D7
	DBRA	D5,RECOM	;LES COEFFS

VBL	MOVE.L	A2,A0	;A0=ADRESSE DES COEFFS
	LEA	BUFFER,A5
	LEA	CORES_X,A1
	LEA	CORES_Y,A6
	REPT	100
	MOVE.W	(A5)+,D0	;X*2
	MOVE.W	(A5)+,D1	;Y*2
	MOVE.W	(A5),D2	;Z*2
	SUBQ.W	#2,D2
	ANDI.W	#$1FF,D2
	MOVE.W	D2,(A5)+
	MOVE.W	0(A0,D2.W),D2	;COEFFICIENT
	MULU.W	D2,D0
	MULU.W	D2,D1
	SWAP	D0	;X
	SWAP	D1	;Y
	ADD.W	D0,D0
	ADD.W	D0,D0
	ADD.W	D1,D1
	MOVE.W	0(A1,D0.W),D3	;D3:MOTIF
	MOVE.L	$44E.W,A3
	ADDA.W	2(A1,D0.W),A3
	ADDA.W	0(A6,D1.W),A3
	OR.W	D3,(A3)
	ENDR
	MOVEM.L	D0-A6,-(SP)
	MOVE.W	#$25,-(SP)
	TRAP	#14
	ADDQ.W	#2,SP
	MOVEM.L	(SP)+,D0-A6
	BRA	VBL
	RTS
LONG_BOOT = *-DEP_BOOT

	DCB.L	800,0
N	SET	0
	REPT	10
	DC.W	32768,N,16384,N,8192,N,4096,N,2048,N,1024,N,512
	DC.W	N,256,N,128,N,64,N,32,N,16,N,8,N,4,N,2,N,1,N
N	SET	N+8
	ENDR
CORES_X	
	REPT	10
	DC.W	32768,N,16384,N,8192,N,4096,N,2048,N,1024,N,512
	DC.W	N,256,N,128,N,64,N,32,N,16,N,8,N,4,N,2,N,1,N
N	SET	N+8
	ENDR
	DCB.L	800,0

	DCB.W	400,0
N	SET	0
	REPT	100
	DC.W	N*160
N	SET	N+1
	ENDR
CORES_Y	
	REPT	100
	DC.W	N*160
N	SET	N+1
	ENDR
	DCB.W	400,0	

BUFFER	DS.B	10000