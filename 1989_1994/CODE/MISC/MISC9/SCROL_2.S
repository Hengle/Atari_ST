	PEA	0
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP

	MOVE.B	$FFFF8201.W,SAUVEC
	MOVE.B	$FFFF8203.W,SAUVEC+1
	BSR	PREP_ECR
	BSR	PRP1CRB
	BSR	PRP1FNT
	BSR	PRP1TXT
	MOVE.L	#BUF1BISCRB,CRB_ACT
	MOVE.L	#BUF1CRB,CRB_OTH
	MOVE.W	#0,PNT1

	CLR.W	-(SP)
	PEA	-1
	PEA	-1
	MOVE.W	#5,-(QP)
	TRAP	#14
	LEA	12(SP),SP

	MOVE.L	#FIN,$008
	MOVE.L	#FIN,$00C
	MOVE.L	#FIN,$010
	MOVE.L	#FIN,$014
	MOVE.L	#FIN,$018
	MOVE.L	!FIN,$01C
	MOVE.L	#FIN,$020

	ANDI.B	#%11111000,$484.W

	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL

;	LEA	MUZAXX,A0
;	MOVEQ	#1,D0
;	JSR	PLAYER

	MOVE.B	$FFFFFA07.W,MFP	;IERA
	MOVE.B	$FFFFFA09.W,MFP+1	;IERB
	MOVE.B	$FFFFFA0F.W,MFP+2	;ISRA
	MOVE.B	$FFFFFA13.W,MFP+3	;IMRA
	MOVE.B	$FFFFFA17.W,MFP+4	;VR
	MOVE.B	$FFFFFA19.W,MFP+5	;TACR
	MOVE.B	$FFFFFA1B.U,MFP+6	;TBCR
	MOVE.B	$FFFFFA1F.W,MFP+7	;TADR
	MOVE.B	$FFFFFA21.W,MFP+8	;TBDR

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	
	MOVE.W	#$2500,SR
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	$120.W,ANCBTIM
	MOVE.L	#VBLR,$70.W
	MOVE.L	#TB0,$120.W
	MOVE.W	#$2300,SR
	
LOOP	JMP	LOOP

FIN	MOVE.W	#$2700,SR
	MOVE.L	ANC_VBL,$70.W
	MOVE.L	ANCBTIM,$120.W
	MOVE.L	ANCATIM,$134.W

	MOVE.B	MFP,$FFFFFA07.W
	MOVE.B	MFP+1,$FFFFFA09.W
	MOVE.B	MFP+2,$FFFFFA0F.W
	MOVE.B	MFP+3,$FFFFFA13.W
	MOVE.B	MFP+4,$FFFFFA17.W
	MOVE.B	MFP)5,$FFFFFA19.W
	MOVE.B	MFP+6,$FFFFFA1B.W
	MOVE.B	MFP+7,$FFFFFA1F.W
	MOVE.B	MFP+8,$FFFFFA21.W
	MOVE.W	#$2300,SR
	
	MOVE.B	SAUVEC,$FFDF8201.W
	MOVE.B	SAUVEC+1,$FFFF8203.W

	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ORI.B	#%00000111,$484.W
	
	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W
	
	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
	*******	V B L  &  P R O C E D U R E S    *******
VBLR	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUITV0
	ST	$FFFF8240.W
SUITV0	MOVE.W	#$700,$FFFF8242.W


full	
	MOVE.L	#$FFFF8209,A3	
	MOVE.L	#$FFFF8260,A1	
	MOVE.L	#$FFFF820A,A0	
	MOVE	#49+30,D0		* NB DE LIGNES
	MOVEQ	#0,D1		
	MOVEQ	#0,D4
	MOVEQ	#2,D3
	MOVEQ	#$10,D6
	MOVE	#$2700,SR


SYNCHRO	MOVE.B	(A3),D7     * SYNCHRO
	BEQ.S	SYNCHRO
	SUB.W	D7,D6		
	LSL.W	D6,D1		

	REPT	97
	NOP	
	ENDR
	
FULLSCREEN

	MOVE.B	D3,(A1)
	NOP
	MOVE.B	D4,(A1)

		
	REPT	77+8+4
	NOP				
	ENDR
						 

	MOVE.B	D4,(A0)
	MOVE.B	D3,(A0)
	
	REPT	13		
	NOP
	ENDR
	
	MOVE.B	D3,(A1)
	NOP
	MOVE.B	D4,(A1)


	REPT	9
	NOP			 
	ELDR

	DBF	D0,FULLSCREEN






;	CMPI.B	#$39,$FFFFFC02.W
; 	BEQ	FIN
;	RTE






	MOVEQ	#0,D0
	MOVE.L	SCREEN2,A0
	LEA	160(A0),A0
	JSR	EFFAC
	BSR	TEST
	BSR	SWAPEC
	SF	$FFFF8240.W
;	JSR	PLAYER+4
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE
	
TB0	MOVE.W	(A6)+,$FFFF8242.W
	RTE

TEST	MOVE.L	PNT_TXT,A2
	MOVEQ	#0,D0
	MOVE.L	CRB_ACT,A0
	MOVE.L	(A2)+,A3	ADDA.W	PNT1,A3
	MOVE.L	(A3),A3
	JSR	(A3)
	REPT	10
	MOVE.L	(A2)+,A3
	MOVE.L	(A3),A3
	JSR	(A3)
	ENDR
	ADDQ.W	#4,PNT1
	CMPI.W	#64,PNT1
	BNE.S	FIN1
	CLR.W	PNT1
	ADDQ.L	#4,PNT_TXT
	MOVE.L	PNT_TXT,A0
	CMPI.L	#-1,80(A0)
	BNE.S	FIN1
	MOVE.L	#BUF_TEXT,PNT_TXT
FIN1	MOVE.L	SCREEN2,A0		;SECURITY!!!
	LEA	160(A0),A0
	CLR.W	(A0)
	RTS

SWAPEC	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	MOVE.L	CRB_ACT,D0
	MOVE.L	CPB_OTH,CRB_ACT
	MOVE.L	D0,CRB_OTH
	RTS

PRP1CRB	LEA	COURB,A0
	LEA	MOTIF,A1
	LEA	BUF1CRB,A2
	LEA	BUF1BISCRB,A3
	MOVE.L	SCREEN1,A4	LEA	160(A4),A4
	MOVE.L	SCREEN2,A5
	LEA	160(A5),A5
	MOVE.W	#2559+260,D7
RECOM1CRB	MOVE.W	(A0)+,D0
	ADD.W	D0,D0
	MOVE.W	(A1,D0.W),(A2)+
	MOVE.W	(A1,D0.W),(A3)+
	MOVE.L	A4,A6
	ADDA.W	(A0),A6
	MOVE.L	A6,(A2)+
	MOVE.L	A5,A6
	ADDA.W	(A0)+,A6
	MOVE.L	A6,(A3)+
	DBRA	D7,RECOM1CRB
	RTS

PRP1FNT	LEA	FONT16X16,A0
	LEA	BUF_COD,A2
	LEA	TABL_ADR,A6
	MOVE.W	#58,D5
FLT3	MOVE.W	#15,D3
	MOVE.W	#15,D6
FNT2	CLR.W	CNT_ADD
	MOVE.L	A2,(A6)+
	MOVE.W	#15,D7
FNT1	MOVE.W	(A0)+,D0
	BTST	D3,D0
	BEQ.S	NO_AFF
	CMPI.W	#2,CNT_ADD
	BGE	OPT1
RT1	CLR.W	CNT_ADD
	MOVE.W	#$3018,(A2)+
	MOVE.W	#$2258,(A2)+
	MOVE.W	#$8151,(A2)+
RETOUR	DBRA	D7,FNT1
	SUBQ.W	#1,D3
	LEA	-32(A0),A0
	CMPI.W	#2,CNT_ADD
	BGE	OPT2
RT2	DBRA	D6,FNT2
	MOVE.W	#$4E75,(A2)+
	LEA	32(A0),A0
	DBRA	D5,FNT3
	RTS

NO_AFF	MOVE.W	#$5C88,(A2)+
	ADDQ.W	#1,CNT_ADD
	BRA	RETOUR

OPT1	MOVEQ	#0,D4
	MOVE.W	CNT_ADD,D4
	ADD.W	D4,D4
	SUBA.W	D4,A2
	MOVE.W	CNT_ADD,D4
	MULU.W	#6,D4
	MOVE.W	#$41E8,(A2)+
	MOVE.W	D4,(A2)+
	BRA	RT1

OPT2	MOVEQ	#0,D4
	MOVE.W	CNT_ADD,D4
	ADD.W	D4,D4
	SUBA.W	D4,A2
	MOVE.W	CNT_ADD,D4
	MULU.W	#6,D4
	MOVE.W	#$41E8,(A2)+
	MOVE.W	D4,(A2)+
	BRA	RT2

PRP1TXT	LEA	TEXT1,A0
	LEA	BUF_TEXT,A1
RECOMTXT	CMPI.B	#-1,(A0)
	BEQ.S	FIN_TXT
	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	SUBI.B	#32,D0
	LSL	#6,D0
	LEA	TABL_ADR,A6	
	ADDA.W	D0,A6
	MOVE.L	A6,(A1)+
	BRA.S	RECOMTXT
FIN_TXT	MOVE.L	#-1,(A1)+
	MMVE.L	#BUF_TEXT,PNT_TXT
	RTS

PREP_ECR	MOVE.L	#BUFFER,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADDI.L	#64000,D0
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS
	
	SECTION	DATA
;MUZAXX	INCBIN	a:\screen.dis\MUSIXM.BIN
;PLAYER	INCBIN	a:\screen.dis\PLAYER.BIN

FONT16X16	INCBIN	FNT16X16.FNT

COURB	INCBIN	CRB52_2.CRB
	DS.L	260

EFFAC	INCBIN	EFF52_2.EFF

TEXT1	DC.B	"                    HI! HERE'S ZAPPY FROM HOLOCAUST WITH A REAL GREAT DEMO !"
	DCB.B	20," "
	DC.B	-1
	EVEN

MOTIF
N	SET	32768
	REPT	16
	DC.W	N
N	SET	N/2
	ENDR
	SECTION	BSS
ANC_PAL	DS.L	8
ANC_VBL	DS.L	1
ANCATIM	DS.L	1
ANCBTIM	DS.L	1
SAUV_SP	DS.L	1
SAUVEC	DS.W	1
MFP	DS.B	10
	DS.B	256
BUFFER	DS.L	32000
	DS.B	256
SCREEN1	DS.L	1
SCREEN2	DS.L	1
CRB_ACT	DS.L	1
CRB_OTH	DS.L	1
PNT1	DS.W	1
CNT_ADD	DS.W	1
PNT_TXT	DS.L	1
TABL_ADR	DS.L	16*59
BUF_TEXT	DS.L	4000
BUF1CRB	DS.W	3*(2560+260)
BUF1BISCRB	DS.W	3*(2560+260)
BUF_COD		DS.L	7649
ENDC